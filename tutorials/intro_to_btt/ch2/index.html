
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This chapter explains how to extract a Time of Arrival (ToA) from proximity probe signals.">
      
      
      
      
        <link rel="prev" href="../ch1/">
      
      
        <link rel="next" href="../ch3/">
      
      
      <link rel="icon" href="../../../images/fab.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>2. Time of Arrival (ToA) - Bladesight Learning Centre</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M576%2048c0-11.1-5.7-21.4-15.2-27.2s-21.2-6.4-31.1-1.4L413.5%2077.5%20234.1%2017.6c-8.1-2.7-16.8-2.1-24.4%201.7l-128%2064C70.8%2088.8%2064%2099.9%2064%20112v352c0%2011.1%205.7%2021.4%2015.2%2027.2s21.2%206.4%2031.1%201.4l116.1-58.1%20173.3%2057.8c-4.3-6.4-8.5-13.1-12.6-19.9-11-18.3-21.9-39.3-30-61.8l-101.2-33.7V92.4l128%2042.7v99.3c31-35.8%2077-58.4%20128-58.4%2022.6%200%2044.2%204.4%2064%2012.5zM392%20341.9c0%2068.9%2064.1%20150.4%2098.6%20189.3%2011.6%2013%2031.3%2013%2042.9%200%2034.5-38.9%2098.6-120.4%2098.6-189.3%200-65.1-53.7-117.9-120-117.9S392%20276.8%20392%20341.9%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Literata:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Literata";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-6B961HRVZP"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-6B961HRVZP",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-6B961HRVZP",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    

<meta name="keywords" content="Blade Tip Timing, BTT, Non Intrusive Stress Measurement, NSMS, Turbine blade,Mechanical Vibration">


<meta property="og:title" content="Intro to BTT Ch2 - Time of Arrival trigger criteria" />
<meta property="og:description" content="This chapter explains how to extract a Time of Arrival (ToA) from proximity probe signals." />
<meta property="og:image" content="https://intro-to-btt-using-python-assets.s3.amazonaws.com/social_card_source_ch2.png" />
<meta property="og:url" content="https://docs.bladesight.com/intro-to-bttch2/" />
<meta property="og:image:height" content="1362" />
<meta property="og:image:width" content="1970" />


<meta name="twitter:site" content="@bladesight" />
<meta name="twitter:creator" content="@dawiediamond" />

<meta name="twitter:title" content="Intro to BTT Ch2 - Time of Arrival trigger criteria"/>
<meta name="twitter:image" content="https://intro-to-btt-using-python-assets.s3.amazonaws.com/social_card_source_ch2.png"/>
<meta name="twitter:url" content="https://docs.bladesight.com/intro-to-bttch2/"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:description" content="This chapter explains how to extract a Time of Arrival (ToA) from proximity probe signals."/>


<meta name="robots" content="index, follow, Blade Tip Timing, BTT, Non Intrusive Stress Measurement, NSMS, Time of Arrival, Turbine blade,Mechanical Vibration" />
  


  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="bladesight" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#time-of-arrival-toa" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            
            
  A new review has been added to chapters 2 and 3 of the BTT tutorial. Look out for a button üëÄ at the top of the screen to activate it.

          </div>
          
            <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
          
        </aside>
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Bladesight Learning Centre" class="md-header__button md-logo" aria-label="Bladesight Learning Centre" data-md-component="logo">
      
  <img src="../../../assets/horizontal_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Bladesight Learning Centre
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2. Time of Arrival (ToA)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="bladesight" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Bladesight Learning Centre

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ch1/" class="md-tabs__link">
          
  
  
  Introduction to Blade Tip Timing

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../datasets/diamond_et_al_2024_vary_ramp_rates_45" class="md-tabs__link">
          
  
  
  Datasets

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../reference/dataset_handler/" class="md-tabs__link">
          
  
  
  User Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!--
  Copyright (c) 2016-2024 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Determine classes -->


  



<!-- Navigation -->
<nav
  class="md-nav md-nav--primary md-nav--lifted"
  aria-label="Navigation"
  data-md-level="0"
>

  <!-- Site title -->
  <label class="md-nav__title" for="__drawer">
    <a
      href="../../.."
      title="Bladesight Learning Centre"
      class="md-nav__button md-logo"
      aria-label="Bladesight Learning Centre"
      data-md-component="logo"
    >
      
  <img src="../../../assets/horizontal_white.png" alt="logo">

    </a>
    Bladesight Learning Centre
  </label>

  <!-- Repository information -->
  

  <!-- Navigation list -->
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bladesight Learning Centre
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Introduction to Blade Tip Timing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction to Blade Tip Timing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Blade Tip Timing's fundamental principle
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    2. Time of Arrival (ToA)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    2. Time of Arrival (ToA)
    
  </span>
  

      </a>
      
        
  
  <nav class="md-nav md-nav--secondary" aria-label="Table of contents">
    
    
    
      
    
    
<div id="mc_embed_shell">
    <link href="//cdn-images.mailchimp.com/embedcode/classic-061523.css" rel="stylesheet" type="text/css">
<style type="text/css">
      #mc_embed_signup{background:#fff; false;clear:left; font:14px Helvetica,Arial,sans-serif; width: 200px;}
      /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<!-- <div id="mc_embed_signup">
  <form action="https://bladesight.us8.list-manage.com/subscribe/post?u=d61691d2e27bf9fdb772ac2d6&amp;id=5c2250604e&amp;f_id=006109e0f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" style="margin:0px 0px 0px 1rem;">
      <div id="mc_embed_signup_scroll"><h4>Subscribe to Bladesight's newsletterüëá</h4>
          <div class="mc-field-group"><label for="mce-EMAIL">Email Address <span class="asterisk">*</span></label><input type="email" name="EMAIL" class="required email" id="mce-EMAIL" required="" value=""><span id="mce-EMAIL-HELPERTEXT" class="helper_text"></span></div>
      <div id="mce-responses" class="clear foot">
          <div class="response" id="mce-error-response" style="display: none;"></div>
          <div class="response" id="mce-success-response" style="display: none;"></div>
      </div>
  <div aria-hidden="true" style="position: absolute; left: -5000px;">
      /* real people should not fill this in and expect good things - do not remove this or risk form bot signups */
      <input type="text" name="b_d61691d2e27bf9fdb772ac2d6_5c2250604e" tabindex="-1" value="">
  </div>
      <div class="optionalParent">
          <div class="clear foot">
              <input type="submit" name="subscribe" id="mc-embedded-subscribe" class="button" value="Subscribe">
          </div>
      </div>
  </div>
</form>
</div> -->

<script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script></div>

      <label class="md-nav__title" for="__toc">
        <span class="md-nav__icon md-icon"></span>
        Table of contents
      </label>
      <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
        
          <li class="md-nav__item">
  <a href="#trigger-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      Trigger criteria
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constant-threshold-trigger-method" class="md-nav__link">
    <span class="md-ellipsis">
      Constant threshold trigger method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bladesight-package" class="md-nav__link">
    <span class="md-ellipsis">
      Bladesight package
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#follow-along-with-the-worksheet" class="md-nav__link">
    <span class="md-ellipsis">
      Follow along with the worksheet
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Follow along with the worksheet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#google-colab" class="md-nav__link">
    <span class="md-ellipsis">
      Google Colab
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-python-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Local Python installation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Local Python installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python-version" class="md-nav__link">
    <span class="md-ellipsis">
      Python version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-environments" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual environments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vectorized-implementation-of-the-constant-threshold-trigger-method" class="md-nav__link">
    <span class="md-ellipsis">
      Vectorized implementation of the constant threshold trigger method
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vectorized implementation of the constant threshold trigger method">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-load-the-probe-signal" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Load the probe signal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-set-the-threshold-direction-and-value" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Set the threshold direction and value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-determine-when-the-signal-has-crossed-the-threshold" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Determine when the signal has crossed the threshold
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-determine-when-the-indicator-has-changed" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Determine when the indicator has changed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-select-the-toas" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Select the ToAs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequential-implementation-of-the-constant-threshold-trigger-method" class="md-nav__link">
    <span class="md-ellipsis">
      Sequential implementation of the constant threshold trigger method
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sequential implementation of the constant threshold trigger method">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simple-example" class="md-nav__link">
    <span class="md-ellipsis">
      Simple example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interpolate-on-voltage" class="md-nav__link">
    <span class="md-ellipsis">
      Interpolate on voltage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hysteresis" class="md-nav__link">
    <span class="md-ellipsis">
      Hysteresis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-of-sequential-vs-vectorized-implementations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance of sequential vs vectorized implementations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-time-hardware" class="md-nav__link">
    <span class="md-ellipsis">
      Real Time Hardware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acknowledgements" class="md-nav__link">
    <span class="md-ellipsis">
      Acknowledgements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coding-exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Coding exercises
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coding exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-1-automatic-range-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 1: Automatic range detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-2-hysteresis-on-the-falling-edge" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 2: Hysteresis on the falling edge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    
  </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3. Angle of Arrival (AoA)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4. Allocating AoAs to blades
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5. Working with multiple probes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6. Data Zeroing and Filtering
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7. Synchronous Vibration and Sampling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8. Single Degree of Freedom (SDoF) Method
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    9. Circumferential Fourier Fit (CFF) Method
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../afterword/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Afterword
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/diamond_et_al_2024_vary_ramp_rates_45" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Varying ramp rates with 45 degree pipe
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            User Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/dataset_handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dataset handler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    btt
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            btt
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/btt/triggering_criteria/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Triggering criteria
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
  <br/>
  <br/>
  <br/>
  <a
    href="https://www.bladesight.com/"
    target="_blank"
    style="text-align: -webkit-center;"
  >
    <img src="https://intro-to-btt-using-python-assets.s3.amazonaws.com/kraken1.jpeg" 
    alt="Kraken" 
    style="width: 120px; display: flex; padding: 2px 0px; justify-content: center; align-items: center; border: 2px;">
    <p><strong>Unleash the Krakenüêô</strong></p>
    </a>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
  
  <nav class="md-nav md-nav--secondary" aria-label="Table of contents">
    
    
    
      
    
    
<div id="mc_embed_shell">
    <link href="//cdn-images.mailchimp.com/embedcode/classic-061523.css" rel="stylesheet" type="text/css">
<style type="text/css">
      #mc_embed_signup{background:#fff; false;clear:left; font:14px Helvetica,Arial,sans-serif; width: 200px;}
      /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<!-- <div id="mc_embed_signup">
  <form action="https://bladesight.us8.list-manage.com/subscribe/post?u=d61691d2e27bf9fdb772ac2d6&amp;id=5c2250604e&amp;f_id=006109e0f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" style="margin:0px 0px 0px 1rem;">
      <div id="mc_embed_signup_scroll"><h4>Subscribe to Bladesight's newsletterüëá</h4>
          <div class="mc-field-group"><label for="mce-EMAIL">Email Address <span class="asterisk">*</span></label><input type="email" name="EMAIL" class="required email" id="mce-EMAIL" required="" value=""><span id="mce-EMAIL-HELPERTEXT" class="helper_text"></span></div>
      <div id="mce-responses" class="clear foot">
          <div class="response" id="mce-error-response" style="display: none;"></div>
          <div class="response" id="mce-success-response" style="display: none;"></div>
      </div>
  <div aria-hidden="true" style="position: absolute; left: -5000px;">
      /* real people should not fill this in and expect good things - do not remove this or risk form bot signups */
      <input type="text" name="b_d61691d2e27bf9fdb772ac2d6_5c2250604e" tabindex="-1" value="">
  </div>
      <div class="optionalParent">
          <div class="clear foot">
              <input type="submit" name="subscribe" id="mc-embedded-subscribe" class="button" value="Subscribe">
          </div>
      </div>
  </div>
</form>
</div> -->

<script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script></div>

      <label class="md-nav__title" for="__toc">
        <span class="md-nav__icon md-icon"></span>
        Table of contents
      </label>
      <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
        
          <li class="md-nav__item">
  <a href="#trigger-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      Trigger criteria
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constant-threshold-trigger-method" class="md-nav__link">
    <span class="md-ellipsis">
      Constant threshold trigger method
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bladesight-package" class="md-nav__link">
    <span class="md-ellipsis">
      Bladesight package
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#follow-along-with-the-worksheet" class="md-nav__link">
    <span class="md-ellipsis">
      Follow along with the worksheet
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Follow along with the worksheet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#google-colab" class="md-nav__link">
    <span class="md-ellipsis">
      Google Colab
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-python-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Local Python installation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Local Python installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python-version" class="md-nav__link">
    <span class="md-ellipsis">
      Python version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-environments" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual environments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vectorized-implementation-of-the-constant-threshold-trigger-method" class="md-nav__link">
    <span class="md-ellipsis">
      Vectorized implementation of the constant threshold trigger method
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vectorized implementation of the constant threshold trigger method">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-load-the-probe-signal" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Load the probe signal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-set-the-threshold-direction-and-value" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Set the threshold direction and value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-determine-when-the-signal-has-crossed-the-threshold" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Determine when the signal has crossed the threshold
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-determine-when-the-indicator-has-changed" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Determine when the indicator has changed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-select-the-toas" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Select the ToAs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequential-implementation-of-the-constant-threshold-trigger-method" class="md-nav__link">
    <span class="md-ellipsis">
      Sequential implementation of the constant threshold trigger method
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sequential implementation of the constant threshold trigger method">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simple-example" class="md-nav__link">
    <span class="md-ellipsis">
      Simple example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interpolate-on-voltage" class="md-nav__link">
    <span class="md-ellipsis">
      Interpolate on voltage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hysteresis" class="md-nav__link">
    <span class="md-ellipsis">
      Hysteresis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-of-sequential-vs-vectorized-implementations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance of sequential vs vectorized implementations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-time-hardware" class="md-nav__link">
    <span class="md-ellipsis">
      Real Time Hardware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acknowledgements" class="md-nav__link">
    <span class="md-ellipsis">
      Acknowledgements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coding-exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Coding exercises
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coding exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-1-automatic-range-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 1: Automatic range detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-2-hysteresis-on-the-falling-edge" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 2: Hysteresis on the falling edge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    
  </nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  


  <nav class="md-tags" hidden>
    
      
      
      
        <span class="md-tag">BTT</span>
      
    
      
      
      
        <span class="md-tag">Blade Tip Timing</span>
      
    
      
      
      
        <span class="md-tag">Mechanical Vibration</span>
      
    
      
      
      
        <span class="md-tag">NSMS</span>
      
    
      
      
      
        <span class="md-tag">Non Intrusive Stress Measurement</span>
      
    
      
      
      
        <span class="md-tag">Time of Arrival</span>
      
    
      
      
      
        <span class="md-tag">Turbine blade</span>
      
    
  </nav>



<details class="abstract">
<summary>You are here</summary>
<p><figure markdown>
<img alt="BTT Tutorial Roadmap" src="BTT_Tutorial_Outline_Ch2.svg" width="500" />
</figure></p>
</details>
<details class="note">
<summary>Reviews</summary>
<p>Please read through the chapter prior to activating a review as I have kept the chapters deliberately terse. </p>
<p>Click to activate a review üëá for more detailed comments from other experts.</p>
<p><a onclick="toggleBtnClicked('Miros≈Çaw Wito≈õ')" class='md-button md-small review-toggle' data-author="Miros≈Çaw Wito≈õ">
    Miros≈Çaw Wito≈õ
</a></p>
</details>
<h1 id="time-of-arrival-toa">Time of Arrival (ToA)</h1>
<p>In the previous chapter, we've established that blade vibration causes the tips to move relative to the shaft's position. A deflected tip causes a shift in the proximity probe's waveform. The size of the shift is proportional to the deflection.</p>
<p>So, how do we calculate the size of the shift?</p>
<p>To determine this, we need the <em>exact instant</em> a blade moved past a probe. This instant is referred to as the <strong>Time of Arrival</strong> (ToA). Each ToA is the result of applying a <em>trigger criterion</em> to each pulse. Let's consider four trigger criteria.</p>
<div class="admonition question">
<p class="admonition-title">Chapter outcomes</p>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5z"/></svg></span> Understand that we need to implement a trigger criterion to determine the ToA of each pulse.</p>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5z"/></svg></span> Understand the constant-threshold trigger method's principle.</p>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5z"/></svg></span> Understand the detrimental effects of noise on the trigger criterion.</p>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5z"/></svg></span> Understand how to implement hysteresis to prevent multiple trigger events.</p>
</div>
<h2 id="trigger-criteria">Trigger criteria</h2>
<p>Several ToA trigger criteria have been discussed in literature (Zimmer, 2008)<sup id="fnref:Zimmer_2008"><a class="footnote-ref" href="#fn:Zimmer_2008">1</a></sup> (Diamond et al., 2021)<sup id="fnref:diamond2021constant"><a class="footnote-ref" href="#fn:diamond2021constant">2</a></sup>. Four of the most common ones are shown in <a href="#figure_01">Figure 1</a> below.</p>
<figure>
<p><img alt="Different Triggering criteria" src="Ch2_triggering_criteria_illustration.svg" width="750" />
    <figcaption><strong><a name='figure_01'>Figure 1</a></strong>: Four common trigger criteria. They are A) the constant threshold trigger method, B) the maximum-slope method, C) the constant-fraction crossing method, and D) the maximum amplitude method.</figcaption></p>
</figure>
<p>Here's the principle behind each criterion:</p>
<ol type="A">
    <li>
        <strong>The constant threshold trigger method:</strong> A ToA is triggered when the signal crosses a predefined threshold.
    </li>
    <li>
        <strong>The maximum slope method:</strong> A ToA is registered when the pulse's rate of change, or slope, is at its maximum.
    </li>
    <li>
        <strong>The constant-fraction crossing method:</strong> Similar to method A), but the threshold level is calculated as a percentage drop from the pulse's maximum voltage level.
    </li>
    <li>
        <strong>The maximum voltage method:</strong> The ToA occurs when the pulse is at its maximum. 
    </li>
</ol>

<p>We start our journey to convert raw BTT data into blade frequency, amplitude and phase by selecting one of these methods. Based on its simplicity, accuracy (Diamond et al., 2021)<sup id="fnref2:diamond2021constant"><a class="footnote-ref" href="#fn:diamond2021constant">2</a></sup> and widespread adoption, we choose the constant threshold method.</p>
<div class='review' data-author='Miros≈Çaw Wito≈õ' data-innerhtml="<p>Fig 1. shows 4 methods of triggering the TOA timer control signal only  the position sensor (eddy current, capacitive and microwave sensors), not the rate of change (reluctance sensor working with ferromagnetic blades). It is unfortunate that the description of Fig. 1 omits important information about what position the blade tip is in relative to the sensor when the pulse is triggered. What are the advantages and disadvantages of each triggering method?</p>
<p>Before referring to Fig. 1, it is useful to inform the reader about the type of sensor, its working principle and the conversion of the position of the blade tip relative to the sensor into an analog signal after the demodulator (typical characteristics of the effect of air gap, blade material conductivity and blades speed on voltage).</p>
<p>No assumption that there is no overflow of the TOA time counter during measurement.</p><p><strong>Author's note:</strong>My knowledge of sensors' working principles is dangerous at best. I am therefore not going to discuss it. I've added a reference to an article covering the principle behind Inductive Probes in the `How can we set the *ideal* threshold level?`.</p>" >
</div>

<h2 id="constant-threshold-trigger-method">Constant threshold trigger method</h2>
<p>This method continuously compares a probe's signal to a voltage threshold. Each time the threshold is crossed, a ToA is recorded.</p>
<p>An idealized pulse generated by a blade as it passes a probe is shown in <a href="#figure_02">Figure 2</a>. A trigger threshold of 0.4 V has been set. The moment the voltage signal crosses this level, at approximately 40 <span class="arithmatex">\(\mu\)</span>s, the ToA is registered. </p>
<script src="proximity_probe_data.js" > </script>
<div>
    <div>
        <canvas id="ch02_prox_probe_signal"'></canvas>
    </div>
    <script>
        async function render_chart_fig1() {

            const ctx = document.getElementById('ch02_prox_probe_signal');
            // If this is a mobile device, set the canvas height to 400
            if (window.innerWidth < 500) {
                ctx.height = 400;
            }
            while (typeof Chart == "undefined") {
                await new Promise(r => setTimeout(r, 1000));
                console.log("CHECKED FOR CHART")
            }
            Chart.defaults.font.family = "Literata, -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif";
            window.fig1 = new Chart(ctx, window.proximity_probe_data);
            }

        render_chart_fig1();
    </script>
</div>

<figure>
<figcaption><strong><a name='figure_02'>Figure 2</a></strong>: An illustration of the constant threshold method applied to an idealized pulse. A ToA is registered when the signal crosses the 0.4 V threshold level. </figcaption>
</figure>
<p>Before we get into the code, let's get you operational with Python and this tutorial's supplementary material.</p>
<h2 id="bladesight-package"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.922 13.58v3.912L20.55 18.72l-.078.055.052.037 3.45-1.256.026-.036v-3.997l-.053-.036-.025.092zm-.301-7.962-3.04 1.107v3.912l3.339-1.215V5.509zm.299 7.839V9.544l-3.336 1.215v3.913zm-3.45 1.253V10.8l-3.3 1.2v3.913zm-3.436 5.286v-3.912l-3.313 1.206v3.912zm.136-3.939v3.868l3.314-1.206V14.85zm2.093 1.882c-.367.134-.663-.074-.663-.463s.296-.814.663-.947c.365-.133.662.075.662.464s-.297.814-.662.946m-6.038-8.624.365-.132-3.285-1.197-3.323 1.21.102.037 3.184 1.16zm7.282 1.349V6.751L17.17 7.965v3.913zm-3.449 1.254V8.005l-3.302 1.202v3.912zm-3.415-2.672-3.336 1.215v3.913l3.336-1.215zm-6.736 3.919 3.322 1.209v-3.913L6.907 9.252zm3.433-5.292 3.281 1.193V5.198l-3.28-1.193zm10.167-5.158L17.19 3.922v3.913l3.317-1.207zM16.95 3.903 13.724 2.73l-3.269 1.19 3.225 1.174zm-1.585.703-1.624.592v3.868l3.317-1.207V3.991zm-.391 2.778c-.367.134-.662-.074-.662-.464s.295-.813.662-.946c.366-.133.663.074.663.464s-.297.813-.663.946M10.229 18.41v-3.914l-3.322-1.209V17.2zm3.449-1.228v-3.913l-3.371 1.227v3.913zm.078-.028 3.3-1.2V12.04l-3.3 1.2zm-.078 4.063-3.371 1.227v-3.912h-.078v3.912l-3.322-1.209v-3.913l-.053-.058-.025-.06-3.336-1.21v-3.948l.034.013 3.287 1.196.015-.078-3.261-1.187 3.26-1.187v-.109L3.876 9.62l-.307-.112 3.26-1.188v.877l.079-.055V6.769l3.257 1.185.058-.061L7.084 6.75l-.102-.037 3.24-1.179v-.083L6.854 6.677v.018l-.025.018v1.523L3.44 9.47v.02l-.025.017v4.007l-3.39 1.233v.019L0 14.784v3.995l.025.037 3.4 1.237.008-.006.007.01 3.4 1.238.008-.006.006.01 3.4 1.237.014-.009.012.01 3.45-1.256.026-.037zM3.493 9.563l3.257 1.185-3.257 1.187V9.562zM3.4 19.96.078 18.752v-3.913l2.361.86.96.349zm.015-3.99-3.08-1.12-.182-.066 3.262-1.187zm3.399 5.231-3.321-1.209V16.08l3.321 1.209zM23.791 5.434l-3.21-1.17v2.338zm-3.404-2.791-3.24-1.18-3.27 1.19 3.247 1.182z"/></svg></span> Bladesight package</h2>
<p>I have released a  <code>pip</code> installable package, called <code>bladesight</code>, you can use to access this tutorial's datasets and functions.</p>
<p>The Pypi package can be found here: <a href="https://pypi.org/project/bladesight/" target="_blank">https://pypi.org/project/bladesight/</a>. The Github repo can be found here: <a href="https://github.com/Bladesight/Bladesight" target="_blank">https://github.com/Bladesight/Bladesight</a>.</p>
<h2 id="follow-along-with-the-worksheet"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.157 22.201A1.784 1.799 0 0 1 5.374 24a1.784 1.799 0 0 1-1.784-1.799 1.784 1.799 0 0 1 1.784-1.799 1.784 1.799 0 0 1 1.783 1.799M20.582 1.427a1.415 1.427 0 0 1-1.415 1.428 1.415 1.427 0 0 1-1.416-1.428A1.415 1.427 0 0 1 19.167 0a1.415 1.427 0 0 1 1.415 1.427M4.992 3.336A1.047 1.056 0 0 1 3.946 4.39a1.047 1.056 0 0 1-1.047-1.055A1.047 1.056 0 0 1 3.946 2.28a1.047 1.056 0 0 1 1.046 1.056m7.336 1.517c3.769 0 7.06 1.38 8.768 3.424a9.36 9.36 0 0 0-3.393-4.547 9.24 9.24 0 0 0-5.377-1.728A9.24 9.24 0 0 0 6.95 3.73a9.36 9.36 0 0 0-3.394 4.547c1.713-2.04 5.004-3.424 8.772-3.424m.001 13.295c-3.768 0-7.06-1.381-8.768-3.425a9.36 9.36 0 0 0 3.394 4.547A9.24 9.24 0 0 0 12.33 21a9.24 9.24 0 0 0 5.377-1.729 9.36 9.36 0 0 0 3.393-4.547c-1.712 2.044-5.003 3.425-8.772 3.425Z"/></svg></span> Follow along with the worksheet</h2>
<p>This BTT tutorial is code-centric. </p>
<p>The concepts are explained with reproducible code. I've collected the code examples for each chapter into its own Jupyter worksheet. The worksheets can be accessed at this Github repo:</p>
<p><a href=https://github.com/Bladesight/bladesight-worksheets target="_blank">
    https://github.com/Bladesight/bladesight-worksheets
</a></p>
<p>Please resist the urge to skip the worksheets. The biggest stumbling block to learning BTT (and many subjects for that matter) is not the theory. It's to understand how the theory is implemented. Getting into the code will pay off in the long run.</p>
<p>You can execute the worksheets in two environments:</p>
<ol>
<li>Google Colab, and </li>
<li>a local installation</li>
</ol>
<h3 id="google-colab"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.941 4.976a7.03 7.03 0 0 0-4.93 2.064 7.033 7.033 0 0 0-.124 9.807l2.395-2.395a3.646 3.646 0 0 1 5.15-5.148l2.397-2.399a7.03 7.03 0 0 0-4.888-1.93m-9.871.01a7.03 7.03 0 0 0-4.888 1.931l2.391 2.391a3.643 3.643 0 0 1 5.023.127l1.734-2.973-.1-.08a7.03 7.03 0 0 0-4.16-1.396m15.01 2.172-2.39 2.39a3.646 3.646 0 0 1-5.15 5.15l-2.406 2.407a7.036 7.036 0 0 0 9.945-9.947m-20.148.01a7.033 7.033 0 0 0-.002 9.681l2.397-2.397a3.643 3.643 0 0 1-.004-4.892zm7.664 7.423a3.635 3.635 0 0 1-5.017.113L2.182 17.1a7.03 7.03 0 0 0 9.007.546l.137-.112z"/></svg></span> Google Colab</h3>
<p>Google Colab allows you to run Jupyter notebooks in the cloud. You can open the Google Colab notebook for this chapter by clicking on the link below:</p>
<p><a href="https://colab.research.google.com/github/Bladesight/bladesight-worksheets/blob/master/intro_to_btt/ch_02_worksheet.ipynb" target="_blank"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<p>You need a Google account to use Colab. If you don't have one, you can create one for free <a href="https://accounts.google.com/signup/v2/createaccount?theme=glif&flowName=GlifWebSignIn&flowEntry=SignUp" target="_blank">here</a>.</p>
<h3 id="local-python-installation"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 6h16v10H4m16 2a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H4c-1.11 0-2 .89-2 2v10a2 2 0 0 0 2 2H0v2h24v-2z"/></svg></span> Local Python installation</h3>
<p>At some stage you'll want to set up your local environment to do your own development. I'll guide you through the process. If you can already set up a local Python environment, skip this section.</p>
<h4 id="python-version">Python version</h4>
<p>Here is an excellent (and entertaining) <a href="https://youtu.be/YKSpANU8jPE?feature=shared" target="_blank"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2z"/></svg></span> video</a> on how to install Python on Windows. <em>Please note:</em> the <code>bladesight</code> package only works on Python 3.9, 3.10 and 3.11. It does not yet work on versions 3.12 and 3.13. If you do not have a compatible version of Python installed, you can download it <a href="https://www.python.org/downloads/release/python-3117/" target="_blank">here</a>.</p>
<h4 id="virtual-environments">Virtual environments</h4>
<p>Virtual environments are an excellent way to isolate different Python projects from one another. I highly recommend setting one up. </p>
<p>On Windows, you can use these steps to set up a virtual environment:</p>
<ol>
<li>
<p>Go to the directory where you want to create the virtual environment. In my case it is <code>"C:\Users\Dawie Diamond\intro_to_btt\"</code>. </p>
</li>
<li>
<p>Open a command prompt in the directory. In Windows 11, this can be achieved in one of two ways: </p>
<ol>
<li>
<p>Type <code>cmd</code> in the address bar of the directory:</p>
<p><img alt="Open command prompt 1" src="open_cmd_1.png" width="500" /></p>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2zm0 2h16v10H4zm1 1v2h2V8zm3 0v2h2V8zm3 0v2h2V8zm3 0v2h2V8zm3 0v2h2V8zM5 11v2h2v-2zm3 0v2h2v-2zm3 0v2h2v-2zm3 0v2h2v-2zm3 0v2h2v-2zm-9 3v2h8v-2z"/></svg></span> Press enter after typing <code>cmd</code>. </p>
<p>A command prompt should open.</p>
</li>
<li>
<p>You can also right click in the directory and select "Open in Terminal":</p>
<p><img alt="Open command prompt 2" src="open_cmd_2.png" width="500" /></p>
</li>
</ol>
</li>
<li>
<p>Type the following command into the command prompt to create a virtual environment called <code>venv</code>:
    <div class="language-console highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="go">python -m venv venv</span>
</span></code></pre></div></p>
</li>
<li>
<p>Run the below command to activate the virtual environment:
    <div class="language-console highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="go">venv\Scripts\activate</span>
</span></code></pre></div></p>
</li>
<li>
<p>Execute the below instruction to install the bladesight package:
    <div class="language-console highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="go">pip install bladesight</span>
</span></code></pre></div></p>
</li>
<li>
<p>Install Jupyter:
    <div class="language-console highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="go">pip install jupyter</span>
</span></code></pre></div></p>
</li>
<li>
<p>We make extensive use of <code>plotly</code> for plotting:
    <div class="language-console highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="go">pip install plotly</span>
</span></code></pre></div></p>
</li>
<li>
<p>Now you can launch Jupyter:
    <div class="language-console highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="go">jupyter notebook</span>
</span></code></pre></div></p>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>One of the first people to test drive this tutorial told me he almost punched a hole through his screen when trying to set up the virtual environment.</p>
<p>I understand this. Setting up a virtual environment is often the most difficult part of starting with a new project.</p>
<p>Please reach out to me at <a href="mailto:dawie.diamond@bladesight.com">dawie.diamond@bladesight.com</a> and I'd be happy to help you get set up.</p>
</div>
<p>If you're on a different platform, here's an excellent <a href="https://youtu.be/kz4gbWNO1cw?si=uFBotRmhP1oTp8K8" target="_blank"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2z"/></svg></span> video</a> on how to set up virtual environments. The video covers different kinds of operating systems. I've created links for each operating system below:</p>
<ul>
<li><a href="https://youtu.be/kz4gbWNO1cw?feature=shared&t=371" target="_blank"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 12V6.75l6-1.32v6.48zm17-9v8.75l-10 .15V5.21zM3 13l6 .09v6.81l-6-1.15zm17 .25V22l-10-1.91V13.1z"/></svg></span> Windows</a></li>
<li><a href="https://youtu.be/kz4gbWNO1cw?feature=shared&t=45" target="_blank"> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11"/></svg></span> Mac</a></li>
<li><a href="https://youtu.be/kz4gbWNO1cw?feature=shared&t=243" target="_blank"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M220.9 123.3c1 .5 1.8 1.7 3 1.7 1.1 0 2.8-.4 2.9-1.5.2-1.4-1.9-2.3-3.2-2.9-1.7-.7-3.9-1-5.5-.1-.4.2-.8.7-.6 1.1.3 1.3 2.3 1.1 3.4 1.7M199 125c1.2 0 2-1.2 3-1.7 1.1-.6 3.1-.4 3.5-1.6.2-.4-.2-.9-.6-1.1-1.6-.9-3.8-.6-5.5.1-1.3.6-3.4 1.5-3.2 2.9.1 1 1.8 1.5 2.8 1.4m221 278.8c-3.6-4-5.3-11.6-7.2-19.7-1.8-8.1-3.9-16.8-10.5-22.4-1.3-1.1-2.6-2.1-4-2.9-1.3-.8-2.7-1.5-4.1-2 9.2-27.3 5.6-54.5-3.7-79.1-11.4-30.1-31.3-56.4-46.5-74.4-17.1-21.5-33.7-41.9-33.4-72C311.1 85.4 315.7.1 234.8 0 132.4-.2 158 103.4 156.9 135.2c-1.7 23.4-6.4 41.8-22.5 64.7-18.9 22.5-45.5 58.8-58.1 96.7-6 17.9-8.8 36.1-6.2 53.3-6.5 5.8-11.4 14.7-16.6 20.2-4.2 4.3-10.3 5.9-17 8.3s-14 6-18.5 14.5c-2.1 3.9-2.8 8.1-2.8 12.4 0 3.9.6 7.9 1.2 11.8 1.2 8.1 2.5 15.7.8 20.8-5.2 14.4-5.9 24.4-2.2 31.7 3.8 7.3 11.4 10.5 20.1 12.3 17.3 3.6 40.8 2.7 59.3 12.5 19.8 10.4 39.9 14.1 55.9 10.4 11.6-2.6 21.1-9.6 25.9-20.2 12.5-.1 26.3-5.4 48.3-6.6 14.9-1.2 33.6 5.3 55.1 4.1.6 2.3 1.4 4.6 2.5 6.7v.1c8.3 16.7 23.8 24.3 40.3 23 16.6-1.3 34.1-11 48.3-27.9 13.6-16.4 36-23.2 50.9-32.2 7.4-4.5 13.4-10.1 13.9-18.3.4-8.2-4.4-17.3-15.5-29.7M223.8 87.3c9.8-22.2 34.2-21.8 44-.4 6.5 14.2 3.6 30.9-4.3 40.4-1.6-.8-5.9-2.6-12.6-4.9 1.1-1.2 3.1-2.7 3.9-4.6 4.8-11.8-.2-27-9.1-27.3-7.3-.5-13.9 10.8-11.8 23-4.1-2-9.4-3.5-13-4.4-1-6.9-.3-14.6 2.9-21.8m-40.7-11.5c10.1 0 20.8 14.2 19.1 33.5-3.5 1-7.1 2.5-10.2 4.6 1.2-8.9-3.3-20.1-9.6-19.6-8.4.7-9.8 21.2-1.8 28.1 1 .8 1.9-.2-5.9 5.5-15.6-14.6-10.5-52.1 8.4-52.1m-13.6 60.7c6.2-4.6 13.6-10 14.1-10.5 4.7-4.4 13.5-14.2 27.9-14.2 7.1 0 15.6 2.3 25.9 8.9 6.3 4.1 11.3 4.4 22.6 9.3 8.4 3.5 13.7 9.7 10.5 18.2-2.6 7.1-11 14.4-22.7 18.1-11.1 3.6-19.8 16-38.2 14.9-3.9-.2-7-1-9.6-2.1-8-3.5-12.2-10.4-20-15-8.6-4.8-13.2-10.4-14.7-15.3q-2.1-7.35 4.2-12.3m3.3 334c-2.7 35.1-43.9 34.4-75.3 18-29.9-15.8-68.6-6.5-76.5-21.9-2.4-4.7-2.4-12.7 2.6-26.4v-.2c2.4-7.6.6-16-.6-23.9-1.2-7.8-1.8-15 .9-20 3.5-6.7 8.5-9.1 14.8-11.3 10.3-3.7 11.8-3.4 19.6-9.9 5.5-5.7 9.5-12.9 14.3-18 5.1-5.5 10-8.1 17.7-6.9 8.1 1.2 15.1 6.8 21.9 16l19.6 35.6c9.5 19.9 43.1 48.4 41 68.9m-1.4-25.9c-4.1-6.6-9.6-13.6-14.4-19.6 7.1 0 14.2-2.2 16.7-8.9 2.3-6.2 0-14.9-7.4-24.9-13.5-18.2-38.3-32.5-38.3-32.5-13.5-8.4-21.1-18.7-24.6-29.9s-3-23.3-.3-35.2c5.2-22.9 18.6-45.2 27.2-59.2 2.3-1.7.8 3.2-8.7 20.8-8.5 16.1-24.4 53.3-2.6 82.4.6-20.7 5.5-41.8 13.8-61.5 12-27.4 37.3-74.9 39.3-112.7 1.1.8 4.6 3.2 6.2 4.1 4.6 2.7 8.1 6.7 12.6 10.3 12.4 10 28.5 9.2 42.4 1.2 6.2-3.5 11.2-7.5 15.9-9 9.9-3.1 17.8-8.6 22.3-15 7.7 30.4 25.7 74.3 37.2 95.7 6.1 11.4 18.3 35.5 23.6 64.6 3.3-.1 7 .4 10.9 1.4 13.8-35.7-11.7-74.2-23.3-84.9-4.7-4.6-4.9-6.6-2.6-6.5 12.6 11.2 29.2 33.7 35.2 59 2.8 11.6 3.3 23.7.4 35.7 16.4 6.8 35.9 17.9 30.7 34.8-2.2-.1-3.2 0-4.2 0 3.2-10.1-3.9-17.6-22.8-26.1-19.6-8.6-36-8.6-38.3 12.5-12.1 4.2-18.3 14.7-21.4 27.3-2.8 11.2-3.6 24.7-4.4 39.9-.5 7.7-3.6 18-6.8 29-32.1 22.9-76.7 32.9-114.3 7.2m257.4-11.5c-.9 16.8-41.2 19.9-63.2 46.5-13.2 15.7-29.4 24.4-43.6 25.5s-26.5-4.8-33.7-19.3c-4.7-11.1-2.4-23.1 1.1-36.3 3.7-14.2 9.2-28.8 9.9-40.6.8-15.2 1.7-28.5 4.2-38.7 2.6-10.3 6.6-17.2 13.7-21.1.3-.2.7-.3 1-.5.8 13.2 7.3 26.6 18.8 29.5 12.6 3.3 30.7-7.5 38.4-16.3 9-.3 15.7-.9 22.6 5.1 9.9 8.5 7.1 30.3 17.1 41.6 10.6 11.6 14 19.5 13.7 24.6M173.4 148.7c2 1.9 4.7 4.5 8 7.1 6.6 5.2 15.8 10.6 27.3 10.6 11.6 0 22.5-5.9 31.8-10.8 4.9-2.6 10.9-7 14.8-10.4s5.9-6.3 3.1-6.6-2.6 2.6-6 5.1c-4.4 3.2-9.7 7.4-13.9 9.8-7.4 4.2-19.5 10.2-29.9 10.2s-18.7-4.8-24.9-9.7c-3.1-2.5-5.7-5-7.7-6.9-1.5-1.4-1.9-4.6-4.3-4.9-1.4-.1-1.8 3.7 1.7 6.5"/></svg></span> Linux</a></li>
</ul>
<h2 id="vectorized-implementation-of-the-constant-threshold-trigger-method">Vectorized implementation of the constant threshold trigger method</h2>
<p>Here's an artificial signal that contains three pulses: </p>
<script src="three_pulses.js" > </script>
<div>
    <div>
        <canvas id="ch02_three_pulses_canvas"'></canvas>
    </div>
    <script>
        async function render_chart() {

            const ctx = document.getElementById('ch02_three_pulses_canvas');
            // If this is a mobile device, set the canvas height to 400
            if (window.innerWidth < 500) {
                ctx.height = 400;
            }
            while (typeof Chart == "undefined") {
                await new Promise(r => setTimeout(r, 1000));
                console.log("CHECKED FOR CHART")
            }
            Chart.defaults.font.family = "Literata, -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif";
            new Chart(ctx, window.three_pulses);
        }
        render_chart();
    </script>
</div>
<figure>
<figcaption><strong><a name='figure_03'>Figure 3</a></strong>: A signal that contains three pulses. </figcaption>
</figure>
<p>Let's extract the ToAs.</p>
<div class="admonition note">
<p class="admonition-title">How the code is presented</p>
<p>These are the tutorial's first code examples. I therefore <strong><em>repeatedly display</em></strong> the complete code. Different lines are highlighted and discussed each time.</p>
</div>
<h3 id="step-1-load-the-probe-signal">Step 1: Load the probe signal</h3>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="hll"><span class="kn">from</span><span class="w"> </span><span class="nn">bladesight</span><span class="w"> </span><span class="kn">import</span> <span class="n">Datasets</span>
</span></span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="hll"><span class="n">ds_ch2</span> <span class="o">=</span> <span class="n">Datasets</span><span class="p">[</span><span class="s2">&quot;data/intro_to_btt/intro_to_btt_ch02&quot;</span><span class="p">]</span>
</span></span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="hll"><span class="n">df_proximity_probe</span> <span class="o">=</span> <span class="n">ds_ch2</span><span class="p">[</span><span class="s2">&quot;table/three_generated_pulses&quot;</span><span class="p">]</span> <span class="c1"># (1)!</span>
</span></span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="n">TRIGGER_ON_RISING_EDGE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="n">THRESHOLD_LEVEL</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1"># Volts</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="k">if</span> <span class="n">TRIGGER_ON_RISING_EDGE</span><span class="p">:</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11"></a>    <span class="n">sr_threshold_over</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12"></a>        <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">THRESHOLD_LEVEL</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13"></a>    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15"></a>    <span class="n">sr_threshold_over</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16"></a>        <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">THRESHOLD_LEVEL</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17"></a>    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18"></a>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="n">diff_sr_threshold</span> <span class="o">=</span> <span class="n">sr_threshold_over</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20"></a>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="n">diff_sr_threshold</span> <span class="o">=</span> <span class="n">diff_sr_threshold</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22"></a>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="n">sr_threshold_change</span> <span class="o">=</span> <span class="n">diff_sr_threshold</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24"></a>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="n">sr_toas</span> <span class="o">=</span> <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">sr_threshold_change</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>This line loads the table into memory. It returns a <code>Pandas DataFrame</code>. We will be making extensive use of Pandas DataFrames throughout this tutorial. Its documentation can be found here: <a target="_blank" href="https://pandas.pydata.org/docs/" >https://pandas.pydata.org/docs/</a></li>
</ol>
<p>On Line 1, we import the <code>bladesight</code> package. In addition to hosting the functions developed in this tutorial, the package makes it simple to download and open the datasets.</p>
<p>On lines 3 and 5, we download this chapter's dataset and read the <code>three_generated_pulses</code> table. The first ten rows of the table are shown below:</p>
<table>
<thead>
<tr>
<th style="text-align: right;">time</th>
<th style="text-align: right;">data</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-0.000594587</td>
</tr>
<tr>
<td style="text-align: right;">0.0333444</td>
<td style="text-align: right;">0.00106139</td>
</tr>
<tr>
<td style="text-align: right;">0.0666889</td>
<td style="text-align: right;">2.60792e-05</td>
</tr>
<tr>
<td style="text-align: right;">0.100033</td>
<td style="text-align: right;">-0.00232804</td>
</tr>
<tr>
<td style="text-align: right;">0.133378</td>
<td style="text-align: right;">-0.00056633</td>
</tr>
<tr>
<td style="text-align: right;">0.166722</td>
<td style="text-align: right;">0.00040294</td>
</tr>
<tr>
<td style="text-align: right;">0.200067</td>
<td style="text-align: right;">-0.000591657</td>
</tr>
<tr>
<td style="text-align: right;">0.233411</td>
<td style="text-align: right;">-0.000962895</td>
</tr>
<tr>
<td style="text-align: right;">0.266756</td>
<td style="text-align: right;">0.000452657</td>
</tr>
<tr>
<td style="text-align: right;">0.3001</td>
<td style="text-align: right;">-8.50727e-05</td>
</tr>
</tbody>
</table>
<details class="note">
<summary>Units</summary>
<table>
<thead>
<tr>
<th>Column</th>
<th>Units</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>time</code></td>
<td>seconds</td>
</tr>
<tr>
<td><code>data</code></td>
<td>Volt</td>
</tr>
</tbody>
</table>
</details>
<p>The DataFrame has 2 columns: <code>time</code> and <code>data</code>. The <code>time</code> column contains each data value's timestamp. </p>
<h3 id="step-2-set-the-threshold-direction-and-value">Step 2: Set the threshold direction and value</h3>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">bladesight</span><span class="w"> </span><span class="kn">import</span> <span class="n">Datasets</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="n">ds_ch2</span> <span class="o">=</span> <span class="n">Datasets</span><span class="p">[</span><span class="s2">&quot;data/intro_to_btt/intro_to_btt_ch02&quot;</span><span class="p">]</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="n">df_proximity_probe</span> <span class="o">=</span> <span class="n">ds_ch2</span><span class="p">[</span><span class="s2">&quot;table/three_generated_pulses&quot;</span><span class="p">]</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="hll"><span class="n">TRIGGER_ON_RISING_EDGE</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="hll"><span class="n">THRESHOLD_LEVEL</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1"># Volts</span>
</span></span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="k">if</span> <span class="n">TRIGGER_ON_RISING_EDGE</span><span class="p">:</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a>    <span class="n">sr_threshold_over</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12"></a>        <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">THRESHOLD_LEVEL</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13"></a>    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15"></a>    <span class="n">sr_threshold_over</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16"></a>        <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">THRESHOLD_LEVEL</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17"></a>    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18"></a>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="n">diff_sr_threshold</span> <span class="o">=</span> <span class="n">sr_threshold_over</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20"></a>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="n">diff_sr_threshold</span> <span class="o">=</span> <span class="n">diff_sr_threshold</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22"></a>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="n">sr_threshold_change</span> <span class="o">=</span> <span class="n">diff_sr_threshold</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24"></a>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="n">sr_toas</span> <span class="o">=</span> <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">sr_threshold_change</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<p>In Line 7, we specify the direction of the trigger. If <code>TRIGGER_ON_RISING_EDGE</code> is <code>True</code>, we trigger when the signal crosses the threshold on the rising edge. If <code>TRIGGER_ON_RISING_EDGE</code> is <code>False</code>, we trigger when the signal crosses the threshold on the falling edge.</p>
<p>In Line 8 we set the threshold level to 0.4 Volt.</p>
<h3 id="step-3-determine-when-the-signal-has-crossed-the-threshold">Step 3: Determine when the signal has crossed the threshold</h3>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">bladesight</span><span class="w"> </span><span class="kn">import</span> <span class="n">Datasets</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="n">ds_ch2</span> <span class="o">=</span> <span class="n">Datasets</span><span class="p">[</span><span class="s2">&quot;data/intro_to_btt/intro_to_btt_ch02&quot;</span><span class="p">]</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="n">df_proximity_probe</span> <span class="o">=</span> <span class="n">ds_ch2</span><span class="p">[</span><span class="s2">&quot;table/three_generated_pulses&quot;</span><span class="p">]</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="n">TRIGGER_ON_RISING_EDGE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="n">THRESHOLD_LEVEL</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1"># Volts</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="hll"><span class="k">if</span> <span class="n">TRIGGER_ON_RISING_EDGE</span><span class="p">:</span>
</span></span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="hll">    <span class="n">sr_threshold_over</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="hll">        <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">THRESHOLD_LEVEL</span>
</span></span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="hll">    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># (1)!</span>
</span></span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="hll"><span class="k">else</span><span class="p">:</span>
</span></span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15"></a><span class="hll">    <span class="n">sr_threshold_over</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="hll">        <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">THRESHOLD_LEVEL</span>
</span></span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="hll">    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18"></a>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="n">diff_sr_threshold</span> <span class="o">=</span> <span class="n">sr_threshold_over</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20"></a>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="n">diff_sr_threshold</span> <span class="o">=</span> <span class="n">diff_sr_threshold</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22"></a>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="n">sr_threshold_change</span> <span class="o">=</span> <span class="n">diff_sr_threshold</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24"></a>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="n">sr_toas</span> <span class="o">=</span> <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">sr_threshold_change</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>We use the method <code>.astype(int)</code> at the end of this line because, by default, comparison operators such as <code>&gt;=</code> and <code>&lt;=</code> result in boolean values. We need an integer column for the steps that follow.</li>
</ol>
<p>In lines 10 - 17, we determine when the signal is "over" the threshold level. The definition of "over" depends on the direction of the trigger. If we trigger on a rising edge, the signal is "over" when it is larger than the threshold. If we trigger on a falling edge, the signal is "over" when it is smaller than the threshold.</p>
<p>The variable <code>sr_threshold_over</code> contains an array of ones and zeros that indicate whether the signal is above or below the threshold. This variable is shown on top of the original signal in <a href="#figure_04">Figure 4</a> below:</p>
<script src="over_under_indicator.js" > </script>
<div>
    <div>
        <canvas id="ch03_three_pulses_canvas"'></canvas>
    </div>
    <script>
        async function render_chart() {

            const ctx = document.getElementById('ch03_three_pulses_canvas');
            // If this is a mobile device, set the canvas height to 400
            if (window.innerWidth < 500) {
                ctx.height = 400;
            }
            while (typeof Chart == "undefined") {
                await new Promise(r => setTimeout(r, 1000));
                console.log("CHECKED FOR CHART")
            }
            Chart.defaults.font.family = "Literata, -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif";
            new Chart(ctx, window.over_under_indicator);
        }
        render_chart();
    </script>
</div>
<figure>
<figcaption><strong><a name='figure_04'>Figure 4</a></strong>: The over/under indicator overlayed on the original signal. The indicator goes to 1 (boolean True) when the signal is larger than the threshold and stays 0 otherwise.</figcaption>
</figure>
<h3 id="step-4-determine-when-the-indicator-has-changed">Step 4: Determine when the indicator has changed</h3>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span>
<span class="normal"><a href="#__codelineno-9-18">18</a></span>
<span class="normal"><a href="#__codelineno-9-19">19</a></span>
<span class="normal"><a href="#__codelineno-9-20">20</a></span>
<span class="normal"><a href="#__codelineno-9-21">21</a></span>
<span class="normal"><a href="#__codelineno-9-22">22</a></span>
<span class="normal"><a href="#__codelineno-9-23">23</a></span>
<span class="normal"><a href="#__codelineno-9-24">24</a></span>
<span class="normal"><a href="#__codelineno-9-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">bladesight</span><span class="w"> </span><span class="kn">import</span> <span class="n">Datasets</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="n">ds_ch2</span> <span class="o">=</span> <span class="n">Datasets</span><span class="p">[</span><span class="s2">&quot;data/intro_to_btt/intro_to_btt_ch02&quot;</span><span class="p">]</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="n">df_proximity_probe</span> <span class="o">=</span> <span class="n">ds_ch2</span><span class="p">[</span><span class="s2">&quot;table/three_generated_pulses&quot;</span><span class="p">]</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="n">TRIGGER_ON_RISING_EDGE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="n">THRESHOLD_LEVEL</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1"># Volts</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9"></a>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="k">if</span> <span class="n">TRIGGER_ON_RISING_EDGE</span><span class="p">:</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11"></a>    <span class="n">sr_threshold_over</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12"></a>        <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">THRESHOLD_LEVEL</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13"></a>    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15"></a>    <span class="n">sr_threshold_over</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16"></a>        <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">THRESHOLD_LEVEL</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17"></a>    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18"></a>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19"></a><span class="hll"><span class="n">diff_sr_threshold</span> <span class="o">=</span> <span class="n">sr_threshold_over</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</span></span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20"></a>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="hll"><span class="n">diff_sr_threshold</span> <span class="o">=</span> <span class="n">diff_sr_threshold</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span> <span class="c1"># (1)!</span>
</span></span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22"></a>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23"></a><span class="hll"><span class="n">sr_threshold_change</span> <span class="o">=</span> <span class="n">diff_sr_threshold</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span></span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24"></a>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25"></a><span class="n">sr_toas</span> <span class="o">=</span> <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">sr_threshold_change</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>The <code>bfill</code> method is used to backward fill any missing values in a pandas Series. We do this because the first value of <code>diff_sr_threshold</code> is <code>NaN</code>. Why is it <code>NaN</code>? Because the first value, by definition, has no prior value to be compared with. We use <code>bfill</code> here to force the first value equal to the second value. </li>
</ol>
<p>Since we are interested in the <em>exact instant</em> the signal crosses the threshold, we calculate the <em>change</em> in <code>sr_threshold_over</code>. In Line 19, the <code>diff</code> method calculates the consecutive differences between adjacent measurements. In Line 23, the <code>&gt;</code> operator is used to find where the indicator has changed from zero to one. </p>
<p>The result of this operation is shown in <a href="#figure_05">Figure 5</a> below:</p>
<script src="change_in_over_under_indicator.js" > </script>
<div>
    <div>
        <canvas id="ch04_change_in_over_under_indicator"'></canvas>
    </div>
    <script>
        async function render_chart() {

            const ctx = document.getElementById('ch04_change_in_over_under_indicator');
            // If this is a mobile device, set the canvas height to 400
            if (window.innerWidth < 500) {
                ctx.height = 400;
            }
            while (typeof Chart == "undefined") {
                await new Promise(r => setTimeout(r, 1000));
                console.log("CHECKED FOR CHART")
            }
            Chart.defaults.font.family = "Literata, -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif";
            new Chart(ctx, window.change_in_over_under_indicator);
        }
        render_chart();
    </script>
</div>
<figure>
<figcaption><strong><a name='figure_05'>Figure 5</a></strong>: The original signal, along with the change in over/under indicator. The change indicator is 1 when the threshold is crossed, and -1 when the signal falls below the threshold again.
  </figcaption>
</figure>
<h3 id="step-5-select-the-toas">Step 5: Select the ToAs</h3>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span>
<span class="normal"><a href="#__codelineno-10-21">21</a></span>
<span class="normal"><a href="#__codelineno-10-22">22</a></span>
<span class="normal"><a href="#__codelineno-10-23">23</a></span>
<span class="normal"><a href="#__codelineno-10-24">24</a></span>
<span class="normal"><a href="#__codelineno-10-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">bladesight</span><span class="w"> </span><span class="kn">import</span> <span class="n">Datasets</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="n">ds_ch2</span> <span class="o">=</span> <span class="n">Datasets</span><span class="p">[</span><span class="s2">&quot;data/intro_to_btt/intro_to_btt_ch02&quot;</span><span class="p">]</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="n">df_proximity_probe</span> <span class="o">=</span> <span class="n">ds_ch2</span><span class="p">[</span><span class="s2">&quot;table/three_generated_pulses&quot;</span><span class="p">]</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="n">TRIGGER_ON_RISING_EDGE</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="n">THRESHOLD_LEVEL</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1"># Volts</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="k">if</span> <span class="n">TRIGGER_ON_RISING_EDGE</span><span class="p">:</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11"></a>    <span class="n">sr_threshold_over</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12"></a>        <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">THRESHOLD_LEVEL</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13"></a>    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15"></a>    <span class="n">sr_threshold_over</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16"></a>        <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">THRESHOLD_LEVEL</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17"></a>    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18"></a>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="n">diff_sr_threshold</span> <span class="o">=</span> <span class="n">sr_threshold_over</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20"></a>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21"></a><span class="n">diff_sr_threshold</span> <span class="o">=</span> <span class="n">diff_sr_threshold</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span> <span class="c1"># (1)!</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22"></a>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="n">sr_threshold_change</span> <span class="o">=</span> <span class="n">diff_sr_threshold</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24"></a>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="hll"><span class="n">sr_toas</span> <span class="o">=</span> <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">sr_threshold_change</span><span class="p">]</span>
</span></span></code></pre></div></td></tr></table></div>
<p>Line 25 is the culmination of our algorithm. We select only the time stamps where our over/under indicator has changed from zero to one. <em>These time stamps are our ToAs.</em> </p>
<p>These are the values in <code>sr_toas</code>:</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">sr_toas</span><span class="p">)</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="p">[</span><span class="mf">27.44248083</span><span class="p">,</span> <span class="mf">52.45081694</span><span class="p">,</span> <span class="mf">77.45915305</span><span class="p">]</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">How can we set the <em>ideal</em> threshold level?</p>
<p>I don't have a one-size-fits-all answer. Here are some general guidelines I use:</p>
<ol>
<li>
<p>The threshold level must intersect the pulse where its slope is steep. Do not set the threshold near a turning point. You can read about it in my paper (Diamond et al., 2021)<sup id="fnref3:diamond2021constant"><a class="footnote-ref" href="#fn:diamond2021constant">2</a></sup>.</p>
<p><img alt="Threshold Select Slope Large " src="ch_2_threshold_select_large_slope.jpeg" width="500" /></p>
</li>
<li>
<p>The blades on your rotor have different lengths. The pulse shape depends on how far the tip is from the probe. Some pulses are noticeably shorter than others. The threshold level must be set to enable the maximum number of blades to be "seen".</p>
<p><img alt="Threshold Select All Blades " src="ch_2_threshold_select_all_blades.jpeg" width="500" /></p>
</li>
<li>
<p>Many BTT probes produce a first-derivative shaped signal, such as the one described in (Rokicki et al., 2021)<sup id="fnref:rokicki2021high"><a class="footnote-ref" href="#fn:rokicki2021high">3</a></sup>. In other words, each pulse:</p>
<ol>
<li>
<p>starts at zero</p>
</li>
<li>
<p>increases in the positive direction</p>
</li>
<li>
<p>rapidly dips through zero again</p>
</li>
<li>
<p>extends into the negative direction</p>
</li>
<li>
<p>returns back to zero</p>
</li>
</ol>
<p>It is tempting to set the threshold level at zero, because you want to capture the ToA when the signal dips through zero in the middle. However, this is a bad idea. You are almost guaranteed of spurious ToAs because of noise around zero before and after the pulse settles.</p>
<p><img alt="Threshold Select All Blades " src="ch_2_threshold_select_careful_zero_crossing.jpeg" width="500" /></p>
<p>If you do want to set the threshold level at zero in the  middle of the pulse, you should implement hysteresis. We discuss hysteresis later in this chapter.</p>
</li>
</ol>
</div>
<h2 id="sequential-implementation-of-the-constant-threshold-trigger-method">Sequential implementation of the constant threshold trigger method</h2>
<p>The vectorized implementation shown above is great... but we can do better. We now implement a <em>sequential version</em> of the constant threshold trigger method.</p>
<p>The sequential implementation is the preferred one for two reasons:</p>
<ol>
<li>Contrary to how many people (...I'm referring to myself here) have been trained to think, it is faster than the vectorized implementation.</li>
<li>It is simpler to understand.</li>
</ol>
<p>How can a sequential, for-loop based approach be faster than the vectorized method? Python is frequently regarded as a slow language. This is false. It is only slow if you use it like nobody ever intended for it to be used.</p>
<p>Many approaches exist to enhance its speed. One can often achieve performance levels comparable to compiled languages.</p>
<p>We use Numba. Numba is a powerful Just-In-Time (JIT) compiler for Python, compiling portions of your code into machine code at runtime. This often leads to blistering fast functions. Numba is a dependency of the bladesight package, so its already installed if you've followed the installation instructions at the start of this chapter.</p>
<p>To use Numba, we import the <code>njit</code> decorator from the package, and wrap our function in it.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">numba</span><span class="w"> </span><span class="kn">import</span> <span class="n">njit</span>
</span></code></pre></div>
<h3 id="simple-example">Simple example</h3>
<p>The simplest implementation of a sequential algorithm involves a <code>for</code> loop to monitor when the signal passes a constant threshold.</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span>
<span class="normal"><a href="#__codelineno-13-21">21</a></span>
<span class="normal"><a href="#__codelineno-13-22">22</a></span>
<span class="normal"><a href="#__codelineno-13-23">23</a></span>
<span class="normal"><a href="#__codelineno-13-24">24</a></span>
<span class="normal"><a href="#__codelineno-13-25">25</a></span>
<span class="normal"><a href="#__codelineno-13-26">26</a></span>
<span class="normal"><a href="#__codelineno-13-27">27</a></span>
<span class="normal"><a href="#__codelineno-13-28">28</a></span>
<span class="normal"><a href="#__codelineno-13-29">29</a></span>
<span class="normal"><a href="#__codelineno-13-30">30</a></span>
<span class="normal"><a href="#__codelineno-13-31">31</a></span>
<span class="normal"><a href="#__codelineno-13-32">32</a></span>
<span class="normal"><a href="#__codelineno-13-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="nd">@njit</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">seq_simple_threshold_crossing</span><span class="p">(</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3"></a>    <span class="n">arr_t</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="c1">#(1)!</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4"></a>    <span class="n">arr_s</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="c1">#(2)!</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5"></a>    <span class="n">threshold</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="c1">#(3)!</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6"></a>    <span class="n">n_est</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="c1">#(4)!</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7"></a>    <span class="n">trigger_on_rising_edge</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="c1">#(5)!</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span> <span class="c1">#(6)!   </span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9"></a>    <span class="k">if</span> <span class="n">n_est</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10"></a>        <span class="n">arr_toa</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">arr_t</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12"></a>        <span class="n">arr_toa</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_est</span><span class="p">)</span><span class="c1">#(7)!</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13"></a>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14"></a>    <span class="n">i_toa</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">#(8)!</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15"></a>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16"></a>    <span class="n">prev_sample</span> <span class="o">=</span> <span class="n">arr_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="c1">#(9)!</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17"></a>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18"></a>    <span class="k">for</span> <span class="n">i_sample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">arr_s</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span><span class="c1">#(10)!</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19"></a>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20"></a>        <span class="n">curr_sample</span> <span class="o">=</span> <span class="n">arr_s</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21"></a>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22"></a>        <span class="k">if</span> <span class="n">trigger_on_rising_edge</span><span class="p">:</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">prev_sample</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">curr_sample</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">):</span><span class="c1">#(11)!</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24"></a>                <span class="n">arr_toa</span><span class="p">[</span><span class="n">i_toa</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr_t</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span><span class="c1">#(12)!</span>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25"></a>                <span class="n">i_toa</span> <span class="o">+=</span> <span class="mi">1</span><span class="c1">#(13)!</span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">prev_sample</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">curr_sample</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">):</span><span class="c1">#(14)!</span>
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28"></a>                <span class="n">arr_toa</span><span class="p">[</span><span class="n">i_toa</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr_t</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span>
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29"></a>                <span class="n">i_toa</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30"></a>
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31"></a>        <span class="n">prev_sample</span> <span class="o">=</span> <span class="n">curr_sample</span><span class="c1">#(15)!</span>
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32"></a>
</span><span id="__span-13-33"><a id="__codelineno-13-33" name="__codelineno-13-33"></a>    <span class="k">return</span> <span class="n">arr_toa</span><span class="p">[:</span><span class="n">i_toa</span><span class="p">]</span><span class="c1">#(16)!</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>The array of time values. Must be a Numpy array.</li>
<li>The array of voltage values. Must be a Numpy array.</li>
<li>The threshold value. Must be a float.</li>
<li>The estimated number of ToAs in this signal. Defaults to None. This number is used to pre-allocate the array of ToAs. If this number is not provided, the array will be pre-allocated as the same dimension as arr_t and arr_s. You should specify this value for large signals.</li>
<li>Whether to trigger ToAs on the rising or falling edge. Defaults to True. If True, the ToA is triggered on the rising edge.</li>
<li>This type annotation <code>-&gt; np.ndarray</code> indicates the return value of the function is a Numpy array.</li>
<li>We pre-allocate the array of ToAs. This is a performance optimization. If we don't pre-allocate the array, the function will have to resize the array each time a ToA is found. It's easy to estimate the expected number of ToAs in the signal, and should be done for any real signal.</li>
<li>Initialize the number of ToAs found in this signal. <code>i_toa</code> will increase by one each time a ToA has been found.</li>
<li>The sequential approach compares each sample to the previous sample. Here, we initialize the <code>prev_sample</code> value to the first value in the array.</li>
<li>We loop through the entire signal and compare each sample to its predecessor.</li>
<li>Here, we check if the threshold has been crossed. If so, we store the ToA in the <code>arr_toa</code> array. This if-clause is executed for a rising edge trigger.</li>
<li>If the threshold has been crossed, we store the ToA in the <code>arr_toa</code> array.</li>
<li>Increment the <code>i_toa</code> value by one.</li>
<li>The check for a falling edge trigger.</li>
<li>We're done with this sample. This command prepares us for the comparison in the next loop pass.</li>
<li>Return only the ToAs that have been registered. The rest of the array is filled with -1 values.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Type annotations in Python</p>
<p>Throughout this tutorial, you'll notice in many of the functions, the function arguments are accompanied by <em>type annotations</em>. In the first argument above, <code>arr_t : np.ndarray</code>, <code>arr_t</code> is the variable name and <code>: np.ndarray</code> is the type annotation . These type annotations specify the expected data types of the arguments.</p>
<p>It's important to note Python itself does not enforce these type annotations. They are primarily utilized by type checkers and serve as a helpful guide for users of the function.</p>
<p>We often need to import annotations from the <code>typing</code> library. In the example above, we need to import the <code>Optional</code> type with the statement <code>from typing import Optional</code>.</p>
</div>
<p>If we pass our three pulses signal through this function, we get the same result as the vectorized implementation:</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">toas</span> <span class="o">=</span> <span class="n">seq_simple_threshold_crossing</span><span class="p">(</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="c1">#(1)!</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.4</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="p">)</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">toas</span><span class="p">)</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="p">[</span><span class="mf">27.44248083</span> <span class="mf">52.45081694</span> <span class="mf">77.45915305</span><span class="p">]</span>
</span></code></pre></div>
<ol>
<li>Note how we use the <code>.values</code> attribute of the Pandas object. This returns a Numpy array, which is required by the function.</li>
</ol>
<h3 id="interpolate-on-voltage">Interpolate on voltage</h3>
<p>Our signals are <em>sampled</em> by a data acquisition system (DAQ). Suppose the DAQ's sampling rate is 100 kHz. This means one sample is acquired every 10 <span class="arithmatex">\(\mu\)</span>s. What happens if the threshold is crossed <em>between two samples</em>? The methods derived up to this point will miss the exact ToA. The ToA will only be triggered at the first available sample <em>after</em> the threshold has been crossed.</p>
<p>If we have the raw analogue signal stored on disk, it's wise to capitalize on the continuous nature of the signal.</p>
<p>To improve the accuracy of ToA determination, we employ interpolation between the two nearest samples when the threshold is crossed.</p>
<p>The below function adds interpolation to the trigger algorithm. It is a modified version of the previous function. The only difference is the interpolation step, marked with a comment <code>(+)</code>:</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span>
<span class="normal"><a href="#__codelineno-15-28">28</a></span>
<span class="normal"><a href="#__codelineno-15-29">29</a></span>
<span class="normal"><a href="#__codelineno-15-30">30</a></span>
<span class="normal"><a href="#__codelineno-15-31">31</a></span>
<span class="normal"><a href="#__codelineno-15-32">32</a></span>
<span class="normal"><a href="#__codelineno-15-33">33</a></span>
<span class="normal"><a href="#__codelineno-15-34">34</a></span>
<span class="normal"><a href="#__codelineno-15-35">35</a></span>
<span class="normal"><a href="#__codelineno-15-36">36</a></span>
<span class="normal"><a href="#__codelineno-15-37">37</a></span>
<span class="normal"><a href="#__codelineno-15-38">38</a></span>
<span class="normal"><a href="#__codelineno-15-39">39</a></span>
<span class="normal"><a href="#__codelineno-15-40">40</a></span>
<span class="normal"><a href="#__codelineno-15-41">41</a></span>
<span class="normal"><a href="#__codelineno-15-42">42</a></span>
<span class="normal"><a href="#__codelineno-15-43">43</a></span>
<span class="normal"><a href="#__codelineno-15-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="nd">@njit</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">seq_threshold_crossing_interp</span><span class="p">(</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3"></a>    <span class="n">arr_t</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4"></a>    <span class="n">arr_s</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5"></a>    <span class="n">threshold</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6"></a>    <span class="n">n_est</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7"></a>    <span class="n">trigger_on_rising_edge</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9"></a>    <span class="k">if</span> <span class="n">n_est</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10"></a>        <span class="n">arr_toa</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">arr_t</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12"></a>        <span class="n">arr_toa</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_est</span><span class="p">)</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13"></a>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14"></a>    <span class="n">i_toa</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15"></a>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16"></a>    <span class="n">prev_sample</span> <span class="o">=</span> <span class="n">arr_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17"></a>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18"></a>    <span class="k">for</span> <span class="n">i_sample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">arr_s</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19"></a>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20"></a>        <span class="n">curr_sample</span> <span class="o">=</span> <span class="n">arr_s</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21"></a>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22"></a>        <span class="k">if</span> <span class="n">trigger_on_rising_edge</span><span class="p">:</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">prev_sample</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">curr_sample</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">):</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24"></a>                <span class="c1"># Interpolate the ToA</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25"></a>                <span class="n">arr_toa</span><span class="p">[</span><span class="n">i_toa</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26"></a>                    <span class="n">arr_t</span><span class="p">[</span><span class="n">i_sample</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> 
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">arr_t</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span> <span class="o">-</span> <span class="n">arr_t</span><span class="p">[</span><span class="n">i_sample</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> 
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28"></a>                    <span class="o">*</span> <span class="p">(</span><span class="n">threshold</span> <span class="o">-</span> <span class="n">prev_sample</span><span class="p">)</span> 
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29"></a>                    <span class="o">/</span> <span class="p">(</span><span class="n">curr_sample</span> <span class="o">-</span> <span class="n">prev_sample</span><span class="p">)</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30"></a>                <span class="p">)</span> <span class="c1"># (1)!</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31"></a>                <span class="n">i_toa</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">prev_sample</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">curr_sample</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">):</span>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34"></a>                <span class="n">arr_toa</span><span class="p">[</span><span class="n">i_toa</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35"></a>                    <span class="n">arr_t</span><span class="p">[</span><span class="n">i_sample</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> 
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">arr_t</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span> <span class="o">-</span> <span class="n">arr_t</span><span class="p">[</span><span class="n">i_sample</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> 
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37"></a>                    <span class="o">*</span> <span class="p">(</span><span class="n">threshold</span> <span class="o">-</span> <span class="n">prev_sample</span><span class="p">)</span> 
</span><span id="__span-15-38"><a id="__codelineno-15-38" name="__codelineno-15-38"></a>                    <span class="o">/</span> <span class="p">(</span><span class="n">curr_sample</span> <span class="o">-</span> <span class="n">prev_sample</span><span class="p">)</span>
</span><span id="__span-15-39"><a id="__codelineno-15-39" name="__codelineno-15-39"></a>                <span class="p">)</span>
</span><span id="__span-15-40"><a id="__codelineno-15-40" name="__codelineno-15-40"></a>                <span class="n">i_toa</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-15-41"><a id="__codelineno-15-41" name="__codelineno-15-41"></a>
</span><span id="__span-15-42"><a id="__codelineno-15-42" name="__codelineno-15-42"></a>        <span class="n">prev_sample</span> <span class="o">=</span> <span class="n">curr_sample</span>
</span><span id="__span-15-43"><a id="__codelineno-15-43" name="__codelineno-15-43"></a>
</span><span id="__span-15-44"><a id="__codelineno-15-44" name="__codelineno-15-44"></a>    <span class="k">return</span> <span class="n">arr_toa</span><span class="p">[:</span><span class="n">i_toa</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>This part performs linear interpolation between the two samples either side of the threshold. It is the only difference between this function and the previous one.</li>
</ol>
<details class="note">
<summary>Why use linear interpolation?</summary>
<p>Linear interpolation is the simplest form of interpolation. It is also the fastest. In my experience, the accuracy gain from a higher order interpolation method is marginal. It's not worth the additional code complexity.</p>
</details>
<p>Let's use this function on the same signal:</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">toas</span> <span class="o">=</span> <span class="n">seq_threshold_crossing_interp</span><span class="p">(</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>    <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.4</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="p">)</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">toas</span><span class="p">)</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="p">[</span><span class="mf">27.42940329</span> <span class="mf">52.44126697</span> <span class="mf">77.45548277</span><span class="p">]</span>
</span></code></pre></div>
<p>These values are slightly different than the previous ones ( the previous ones are <code>[27.44248083 52.45081694 77.45915305]</code> ). The new values are more accurate than the old ones.</p>
<h3 id="hysteresis">Hysteresis</h3>
<p>The signals we've used so far contain minimal noise. In the absence of noise, the ToAs are easily extracted. However, in real-world scenarios, signals contain non-negligible noise components. </p>
<p>Sometimes, excessive noise is consistently present throughout the signal. Other times it appears in short, sporadic bursts. </p>
<p>To illustrate this point vividly, I've generated a noisy signal that contains three pulses, shown in <a href="#figure_06">Figure 6</a> below: </p>
<div class="admonition note">
<p class="admonition-title">Zoom</p>
<p>If there is a "Reset zoom" button on the bottom of the figure, you can zoom and pan on the plot. Drag across the screen to <strong>zoom</strong> , hold <code>ctrl</code> and drag across the screen to <strong>pan</strong>.</p>
</div>
<script src="three_pulses_noisy.js" > </script>
<div>
    <div>
        <canvas id="ch02_three_pulses_noisy"'></canvas>
    </div>
    <script>
        async function render_chart_three_pulses_noisy() {
            const ctx = document.getElementById('ch02_three_pulses_noisy');
            // If this is a mobile device, set the canvas height to 400
            if (window.innerWidth < 500) {
                ctx.height = 400;
            }
            while (typeof Chart == "undefined") {
                await new Promise(r => setTimeout(r, 1000));
                console.log("CHECKED FOR CHART")
            }
            Chart.defaults.font.family = "Literata, -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif";
            window.fig_three_pulses_noisy = new Chart(ctx, window.three_pulses_noisy);
            window.fig_three_pulses_noisy_reset = function resetZoomFig1() {
                    window.fig_three_pulses_noisy.resetZoom();
                }
            }
        render_chart_three_pulses_noisy();
    </script>
    <a onclick="window.fig_three_pulses_noisy_reset()" class='md-button'>Reset Zoom</a>
</div>
<figure>
<figcaption><strong><a name='figure_06'>Figure 6</a></strong>: A noisy signal that contains three pulses. Zoom into the areas around 0.4 V to observe the signal crosses the threshold multiple times.
  </figcaption>
</figure>
<p>If you zoom into each pulse around 0.4 V, you'll observe the signal crosses the threshold multiple times. Let's apply our trigger algorithm to this signal. We first need to load the noisy signal dataframe:</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">df_proximity_probe</span> <span class="o">=</span> <span class="n">ds_ch2</span><span class="p">[</span><span class="s2">&quot;table/three_generated_pulses_noisy&quot;</span><span class="p">]</span>
</span></code></pre></div>
<p>Having applied our algorithm to the noisy signal, these are the ToAs: </p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="go">[27.20280579, 27.26724046, 27.45521975, 27.54516822, 32.4110573,  32.48523812,</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="go"> 32.59630977, 32.73320484, 52.10882236, 52.46204252, 52.59380688, 57.42079388,</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="go"> 57.64309888, 57.69638523, 57.78086048, 57.87833845, 77.46723661, 77.66015932,</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="go"> 78.09842428, 82.3623517,  82.50989437, 82.74746473]</span>
</span></code></pre></div>
<p>Our algorithm incorrectly returns many ToAs around the 0.4 V level.</p>
<p>We can implement <em>hysteresis</em> to solve the issue. Hysteresis introduces a <em>second threshold</em> and a <em>state variable</em> to our algorithm. The algorithm therefore uses a <em>lower</em> and an <em>upper</em> threshold. The state can only change based on certain rules. The rules are:</p>
<ol>
<li>If the state is <em>low</em> and the current sample is <em>above</em> the upper threshold, the state becomes high. A ToA is triggered when the state moves from low to high.</li>
<li>If the state is <em>high</em> and the current sample falls <em>below</em> the lower threshold, the state becomes low.</li>
<li>Otherwise, the state is maintained.</li>
</ol>
<p><a href="#figure_07">Figure 7</a> below illustrates the state variable and ToA trigger events for a (absurdly) noisy signal. </p>
<figure>
<p><img alt="Different Triggering criteria" src="ch2_hysteresis_illustrate.svg" width="750" />
    <figcaption><strong><a name='figure_07'>Figure 7</a></strong>: An illustration of hysteresis in our trigger criterion.</figcaption></p>
</figure>
<p>The below algorithm implements hysteresis to determine the ToAs on the rising edge:</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span>
<span class="normal"><a href="#__codelineno-19-22">22</a></span>
<span class="normal"><a href="#__codelineno-19-23">23</a></span>
<span class="normal"><a href="#__codelineno-19-24">24</a></span>
<span class="normal"><a href="#__codelineno-19-25">25</a></span>
<span class="normal"><a href="#__codelineno-19-26">26</a></span>
<span class="normal"><a href="#__codelineno-19-27">27</a></span>
<span class="normal"><a href="#__codelineno-19-28">28</a></span>
<span class="normal"><a href="#__codelineno-19-29">29</a></span>
<span class="normal"><a href="#__codelineno-19-30">30</a></span>
<span class="normal"><a href="#__codelineno-19-31">31</a></span>
<span class="normal"><a href="#__codelineno-19-32">32</a></span>
<span class="normal"><a href="#__codelineno-19-33">33</a></span>
<span class="normal"><a href="#__codelineno-19-34">34</a></span>
<span class="normal"><a href="#__codelineno-19-35">35</a></span>
<span class="normal"><a href="#__codelineno-19-36">36</a></span>
<span class="normal"><a href="#__codelineno-19-37">37</a></span>
<span class="normal"><a href="#__codelineno-19-38">38</a></span>
<span class="normal"><a href="#__codelineno-19-39">39</a></span>
<span class="normal"><a href="#__codelineno-19-40">40</a></span>
<span class="normal"><a href="#__codelineno-19-41">41</a></span>
<span class="normal"><a href="#__codelineno-19-42">42</a></span>
<span class="normal"><a href="#__codelineno-19-43">43</a></span>
<span class="normal"><a href="#__codelineno-19-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="nd">@njit</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">seq_threshold_crossing_hysteresis_rising</span><span class="p">(</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a>    <span class="n">arr_t</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4"></a>    <span class="n">arr_s</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5"></a>    <span class="n">threshold</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6"></a>    <span class="n">hysteresis_height</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="c1">#(1)!</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7"></a>    <span class="n">n_est</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9"></a>    <span class="n">threshold_lower</span> <span class="o">=</span> <span class="n">threshold</span> <span class="o">-</span> <span class="n">hysteresis_height</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10"></a>    <span class="n">trigger_state</span> <span class="o">=</span> <span class="p">(</span> <span class="c1"># (2)!</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11"></a>        <span class="kc">True</span> 
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12"></a>        <span class="k">if</span> <span class="n">arr_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold_lower</span> 
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13"></a>        <span class="k">else</span> <span class="kc">False</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14"></a>    <span class="p">)</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15"></a>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16"></a>    <span class="k">if</span> <span class="n">n_est</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17"></a>        <span class="n">arr_toa</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">arr_t</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19"></a>        <span class="n">arr_toa</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_est</span><span class="p">)</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20"></a>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21"></a>    <span class="n">i_toa</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22"></a>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23"></a>    <span class="n">prev_sample</span> <span class="o">=</span> <span class="n">arr_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24"></a>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25"></a>    <span class="k">for</span> <span class="n">i_sample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">arr_s</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26"></a>        <span class="n">curr_sample</span> <span class="o">=</span> <span class="n">arr_s</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27"></a>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28"></a>        <span class="k">if</span> <span class="n">trigger_state</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29"></a>            <span class="k">if</span> <span class="n">curr_sample</span> <span class="o">&lt;=</span> <span class="n">threshold_lower</span><span class="p">:</span> <span class="c1">#(3)!</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30"></a>                <span class="n">trigger_state</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32"></a>            <span class="k">if</span> <span class="n">curr_sample</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span><span class="c1">#(4)!</span>
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33"></a>                <span class="n">trigger_state</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-19-34"><a id="__codelineno-19-34" name="__codelineno-19-34"></a>                <span class="n">arr_toa</span><span class="p">[</span><span class="n">i_toa</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-19-35"><a id="__codelineno-19-35" name="__codelineno-19-35"></a>                    <span class="n">arr_t</span><span class="p">[</span><span class="n">i_sample</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> 
</span><span id="__span-19-36"><a id="__codelineno-19-36" name="__codelineno-19-36"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">arr_t</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span> <span class="o">-</span> <span class="n">arr_t</span><span class="p">[</span><span class="n">i_sample</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> 
</span><span id="__span-19-37"><a id="__codelineno-19-37" name="__codelineno-19-37"></a>                    <span class="o">*</span> <span class="p">(</span><span class="n">threshold</span> <span class="o">-</span> <span class="n">prev_sample</span><span class="p">)</span> 
</span><span id="__span-19-38"><a id="__codelineno-19-38" name="__codelineno-19-38"></a>                    <span class="o">/</span> <span class="p">(</span><span class="n">curr_sample</span> <span class="o">-</span> <span class="n">prev_sample</span><span class="p">)</span>
</span><span id="__span-19-39"><a id="__codelineno-19-39" name="__codelineno-19-39"></a>                <span class="p">)</span>
</span><span id="__span-19-40"><a id="__codelineno-19-40" name="__codelineno-19-40"></a>                <span class="n">i_toa</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-19-41"><a id="__codelineno-19-41" name="__codelineno-19-41"></a>
</span><span id="__span-19-42"><a id="__codelineno-19-42" name="__codelineno-19-42"></a>        <span class="n">prev_sample</span> <span class="o">=</span> <span class="n">curr_sample</span>
</span><span id="__span-19-43"><a id="__codelineno-19-43" name="__codelineno-19-43"></a>
</span><span id="__span-19-44"><a id="__codelineno-19-44" name="__codelineno-19-44"></a>    <span class="k">return</span> <span class="n">arr_toa</span><span class="p">[:</span><span class="n">i_toa</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>The height of the hysteresis. It has the same units as the signal. This value is used to calculate the lower threshold.</li>
<li>The trigger state is a boolean value indicating whether the trigger is currently <em>high</em> or <em>low</em>. We initialize it to True if the first sample is above the lower threshold, and False otherwise.</li>
<li>If the trigger state is True, we check if the current sample is below the lower threshold. If it is, we set the trigger state to False.</li>
<li>If the trigger state is False, we check if the current sample is above the upper threshold. If it is, we set the trigger state to True and calculate the ToA using interpolation.</li>
</ol>
<p>We can use this function to extract the ToAs from the noisy signal:</p>
<p><div class="language-py highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">toas</span> <span class="o">=</span> <span class="n">seq_threshold_crossing_hysteresis_rising</span><span class="p">(</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>    <span class="n">df_proximity_probe_noisy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>    <span class="n">df_proximity_probe_noisy</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> 
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    <span class="n">hysteresis_height</span><span class="o">=</span><span class="mf">0.2</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="p">)</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">taos</span><span class="p">)</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="p">[</span><span class="mf">27.20280579</span> <span class="mf">52.10882236</span> <span class="mf">77.46723661</span><span class="p">]</span>
</span></code></pre></div>
Implementation of hysteresis stops multiple trigger events. It does not, however, guarantee accurate ToAs for noisy signals. We might end up with the <em>correct number</em> of ToAs, but each ToA will be the <em>first</em> one where the signal crosses the upper threshold. This may not be the best ToA. It may therefore be beneficial to incorporate a filter into the algorithm. We don't cover filters in this chapter.</p>
<details class="note">
<summary>How to select <code>hysteresis height</code> and <code>n_est</code></summary>
<ol>
<li>
<p>The hysteresis height should be at least twice as large as the noise. A sufficient estimate can usually be made by observing the largest noise spikes.</p>
</li>
<li>
<p>The <code>n_est</code> value should be larger than the number of pulses in the signal. I use this calculation:</p>
</li>
</ol>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">n_est</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>    <span class="n">MAX_SHAFT_SPEED_IN_HZ</span> 
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>    <span class="o">*</span> <span class="n">NUMBER_OF_BLADES_ON_ROTOR</span> 
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>    <span class="o">*</span> <span class="n">TIME_IN_SECONDS_OF_MEASUREMENT</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
</span></code></pre></div>
<p>The <code>*2</code> at the end of the equation doubles the pre-allocated array length. We can therefore be sure there's enough space for all the ToAs.</p>
</details>
<h2 id="performance-of-sequential-vs-vectorized-implementations">Performance of sequential vs vectorized implementations</h2>
<p>We've now implemented <em>vectorized</em> and <em>sequential</em> algorithms to extract the ToAs. Which one is faster? Let's use both approaches on a real signal.</p>
<p>The dataset used here contains a signal acquired from an eddy current probe. It is stored in the table <code>table/aluminium_blisk_1200_rpm</code>. The signal was acquired for a five blade rotor running at 1200 RPM. The acquisition was performed at a sampling rate of 2 MHz. The signal is shown in <a href="#figure_08">Figure 8</a> below:</p>
<script src="eddy_current_probe_raw.js" > </script>
<div>
    <div>
        <canvas id="ch02_eddy_current_probe_raw"'></canvas>
    </div>
    <script>
        async function render_chart_fig_eddy_current_raw() {
            const ctx = document.getElementById('ch02_eddy_current_probe_raw');
            // If this is a mobile device, set the canvas height to 400
            if (window.innerWidth < 500) {
                ctx.height = 400;
            }
            while (typeof Chart == "undefined") {
                await new Promise(r => setTimeout(r, 1000));
                console.log("CHECKED FOR CHART")
            }
            Chart.defaults.font.family = "Literata, -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif";
            window.fig_eddy_current_raw = new Chart(ctx, window.eddy_current_probe_raw);
            window.fig_eddy_current_raw_reset = function resetZoomFig2() {
                    window.fig_eddy_current_raw.resetZoom();
                }
            }
        render_chart_fig_eddy_current_raw();
    </script>
    <a onclick="window.fig_eddy_current_raw_reset()" class='md-button'>Reset Zoom</a>
</div>
<figure>
<figcaption><strong><a name='figure_08'>Figure 8</a></strong>: An eddy current probe signal acquired for a five blade aluminium rotor rotating at 1200 RPM. The sampling rate of the DAQ was 2 MHz. For this figure, the data points are heavily decimated.</figcaption>
</figure>
<p>We can use the Jupyter <code>%%timeit</code> magic method to time a piece of code. Here's the result:</p>
<table>
<thead>
<tr>
<th>Vectorized</th>
<th>Sequential</th>
</tr>
</thead>
<tbody>
<tr>
<td>301 ms</td>
<td>18 ms</td>
</tr>
</tbody>
</table>
<p>The sequential approach is almost 20 times faster than the vectorized method. The sequential algorithm also contains hysteresis and interpolation that the vectorized function does not.</p>
<h2 id="real-time-hardware">Real Time Hardware</h2>
<p>This chapter assumes you can store large analogue signals on your disk. If your rotor is small and turns slowly, this method is suitable.</p>
<p>When your blades are large or your rotor spins fast, you'll need to determine the ToAs in real-time. This typically requires custom hardware. Here are some providers of BTT hardware:</p>
<ul>
<li><a target='_blank' href="https://www.bladesight.com"> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2z"/></svg></span> Bladesight</a></li>
<li><a target='_blank' href="https://emtd-measurement.com/"> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2z"/></svg></span> EMTD Measurement</a></li>
<li><a target='_blank' href="https://hoodtech.com/bvm/"> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2z"/></svg></span> Hood Technologies</a></li>
<li><a target='_blank' href="https://agilis.com/"> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2z"/></svg></span> Agilis</a></li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>Congratulations, you've completed the second chapter of this tutorial. You're approximately 30% of the way through. You've now learned how ToA extraction works. </p>
<p>In my experience, getting your Python version set up is a massive challenge. From here, we can churn out code to our heart's content.</p>
<p>Lets push on...</p>
<div class="admonition question">
<p class="admonition-title">Chapter outcomes</p>
<p><span class="twemoji checkbox-success heart"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10 17-5-5 1.41-1.42L10 14.17l7.59-7.59L19 8m0-5H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"/></svg></span> Understand that we need to implement a trigger criterion to determine the ToA of each pulse.</p>
<p><span class="twemoji checkbox-success heart"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10 17-5-5 1.41-1.42L10 14.17l7.59-7.59L19 8m0-5H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"/></svg></span> Understand the constant-threshold trigger method's principle.</p>
<p><span class="twemoji checkbox-success heart"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10 17-5-5 1.41-1.42L10 14.17l7.59-7.59L19 8m0-5H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"/></svg></span> Understand the detrimental effects of noise on the trigger criterion.</p>
<p><span class="twemoji checkbox-success heart"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10 17-5-5 1.41-1.42L10 14.17l7.59-7.59L19 8m0-5H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"/></svg></span> Understand how to implement hysteresis to prevent multiple trigger events.</p>
</div>
<h2 id="acknowledgements">Acknowledgements</h2>
<p>Thanks to <a href="https://www.linkedin.com/in/justin-s-507338116/" target="_blank">Justin Smith</a> and <a href="https://www.linkedin.com/in/alex-brocco-70218b25b/" target="_blank">Alex Brocco</a> for reviewing this chapter and providing feedback.</p>
<p>A special thanks to <a href="https://www.researchgate.net/profile/Miroslaw-Witos-2" target="_blank">Miros≈Çaw Wito≈õ</a> for his detailed review of this chapter.</p>
<div style='display:flex'>
    <div>
        <a target="_blank" href="https://www.bladesight.com" class="" title="Dawie Diamond" style="border-radius:100%;"> 
            <img src="https://github.com/Bladesight.png?size=300" alt="Dawie Diamond" style="
            border-radius: 100%;
            width: 4.0rem;
        ">
        </a>
    </div>
    <div style='margin-left:2rem'>
        <p>
            <strong>Dawie Diamond</strong>
        </p>
        <p>
            <span class="md-icon blog-timestamp-span" title="Created"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>2024-02-06</span>

            <span class="md-icon blog-timestamp-span" title="Last update"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>2025-02-17
            </span>
        </p>
    </div>
</div>

<h2 id="coding-exercises"><span class="twemoji checkbox-success"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 5c-1.11 0-2 .89-2 2s.89 2 2 2 2-.89 2-2-.89-2-2-2m10-4v5h-2V4H4v2H2V1h2v2h16V1zm-7 10.26V23h-2v-5h-2v5H9V11.26C6.93 10.17 5.5 8 5.5 5.5V5h2v.5C7.5 8 9.5 10 12 10s4.5-2 4.5-4.5V5h2v.5c0 2.5-1.43 4.67-3.5 5.76"/></svg></span> Coding exercises</h2>
<p>Here are two coding exercises to solidify your understanding of the material covered in this chapter. Please attempt them before you expand the solution bar.</p>
<h3 id="problem-1-automatic-range-detection">Problem 1: Automatic range detection <img alt="ü•±" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f971.svg" title=":yawning_face:" /></h3>
<p>So far, the threshold level has been set manually from eyeballing the signal. This is often fine, but we can do better...</p>
<mark class="critic block">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.1 9 .9.9L5.9 19H5v-.9zm3.6-6c-.2 0-.5.1-.7.3l-1.8 1.8 3.7 3.8L20.7 7c.4-.4.4-1 0-1.4l-2.3-2.3c-.2-.2-.5-.3-.7-.3m-3.6 3.2L3 17.2V21h3.8l11-11.1zM7 2v3h3v2H7v3H5V7H2V5h3V2z"/></svg></span> Write a new function, called <code>determine_threshold_level</code>, that receives the signal and the % of the range to use as the threshold level. The function should return the threshold level. </p>
</mark>
<details class="example">
<summary>Reveal answer (Please try it yourself before peeking)</summary>
<p><div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span>
<span class="normal"><a href="#__codelineno-22-22">22</a></span>
<span class="normal"><a href="#__codelineno-22-23">23</a></span>
<span class="normal"><a href="#__codelineno-22-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">determine_threshold_level</span><span class="p">(</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2"></a>    <span class="n">arr_s</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3"></a>    <span class="n">threshold_percent</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">50</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; This function determines the threshold level to use for the</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="sd">    constant threshold trigger method. The threshold level is</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="sd">    determined as a percentage between the maximum and minimum</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="sd">    value of the signal.</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9"></a>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="sd">    Args:</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="sd">        arr_s (np.ndarray): The signal to determine the threshold</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="sd">            level for.</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="sd">        threshold_percent (float): The percentage of the maximum</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="sd">            value to use as the threshold level. Must be a number</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="sd">            between 0 and 100.</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16"></a>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18"></a>    <span class="k">if</span> <span class="n">threshold_percent</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">threshold_percent</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;threshold_percent must be between 0 and 100&quot;</span><span class="p">)</span>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20"></a>    <span class="n">min_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">arr_s</span><span class="p">)</span>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21"></a>    <span class="n">max_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">arr_s</span><span class="p">)</span>
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22"></a>    <span class="n">signal_range</span> <span class="o">=</span> <span class="n">max_value</span> <span class="o">-</span> <span class="n">min_value</span>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23"></a>    <span class="n">threshold_level</span> <span class="o">=</span> <span class="n">min_value</span> <span class="o">+</span> <span class="n">signal_range</span> <span class="o">*</span> <span class="n">threshold_percent</span><span class="o">/</span><span class="mi">100</span>
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24"></a>    <span class="k">return</span> <span class="n">threshold_level</span>
</span></code></pre></div></td></tr></table></div>
Example usage:
<div class="language-py highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">threshold_level</span> <span class="o">=</span> <span class="n">determine_threshold_level</span><span class="p">(</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>    <span class="n">df_proximity_probe</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>    <span class="n">threshold_percent</span><span class="o">=</span><span class="mi">30</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="p">)</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">threshold_level</span><span class="p">)</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="mf">0.3</span>
</span></code></pre></div></p>
</details>
<h3 id="problem-2-hysteresis-on-the-falling-edge">Problem 2: Hysteresis on the falling edge <img alt="üòê" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f610.svg" title=":neutral_face:" /></h3>
<p>We've showcased how a trigger criterion with hysteresis works on the rising edge. Implement a trigger criterion that uses hysteresis on the falling edge.</p>
<mark class="critic block">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.1 9 .9.9L5.9 19H5v-.9zm3.6-6c-.2 0-.5.1-.7.3l-1.8 1.8 3.7 3.8L20.7 7c.4-.4.4-1 0-1.4l-2.3-2.3c-.2-.2-.5-.3-.7-.3m-3.6 3.2L3 17.2V21h3.8l11-11.1zM7 2v3h3v2H7v3H5V7H2V5h3V2z"/></svg></span> Write a new function, called <code>seq_threshold_crossing_hysteresis_falling</code>, that extracts the ToAs on the falling edge using hysteresis.</p>
</mark>
<details class="example">
<summary>Reveal answer (Please try it yourself before peeking)</summary>
<p><div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span>
<span class="normal"><a href="#__codelineno-24-17">17</a></span>
<span class="normal"><a href="#__codelineno-24-18">18</a></span>
<span class="normal"><a href="#__codelineno-24-19">19</a></span>
<span class="normal"><a href="#__codelineno-24-20">20</a></span>
<span class="normal"><a href="#__codelineno-24-21">21</a></span>
<span class="normal"><a href="#__codelineno-24-22">22</a></span>
<span class="normal"><a href="#__codelineno-24-23">23</a></span>
<span class="normal"><a href="#__codelineno-24-24">24</a></span>
<span class="normal"><a href="#__codelineno-24-25">25</a></span>
<span class="normal"><a href="#__codelineno-24-26">26</a></span>
<span class="normal"><a href="#__codelineno-24-27">27</a></span>
<span class="normal"><a href="#__codelineno-24-28">28</a></span>
<span class="normal"><a href="#__codelineno-24-29">29</a></span>
<span class="normal"><a href="#__codelineno-24-30">30</a></span>
<span class="normal"><a href="#__codelineno-24-31">31</a></span>
<span class="normal"><a href="#__codelineno-24-32">32</a></span>
<span class="normal"><a href="#__codelineno-24-33">33</a></span>
<span class="normal"><a href="#__codelineno-24-34">34</a></span>
<span class="normal"><a href="#__codelineno-24-35">35</a></span>
<span class="normal"><a href="#__codelineno-24-36">36</a></span>
<span class="normal"><a href="#__codelineno-24-37">37</a></span>
<span class="normal"><a href="#__codelineno-24-38">38</a></span>
<span class="normal"><a href="#__codelineno-24-39">39</a></span>
<span class="normal"><a href="#__codelineno-24-40">40</a></span>
<span class="normal"><a href="#__codelineno-24-41">41</a></span>
<span class="normal"><a href="#__codelineno-24-42">42</a></span>
<span class="normal"><a href="#__codelineno-24-43">43</a></span>
<span class="normal"><a href="#__codelineno-24-44">44</a></span>
<span class="normal"><a href="#__codelineno-24-45">45</a></span>
<span class="normal"><a href="#__codelineno-24-46">46</a></span>
<span class="normal"><a href="#__codelineno-24-47">47</a></span>
<span class="normal"><a href="#__codelineno-24-48">48</a></span>
<span class="normal"><a href="#__codelineno-24-49">49</a></span>
<span class="normal"><a href="#__codelineno-24-50">50</a></span>
<span class="normal"><a href="#__codelineno-24-51">51</a></span>
<span class="normal"><a href="#__codelineno-24-52">52</a></span>
<span class="normal"><a href="#__codelineno-24-53">53</a></span>
<span class="normal"><a href="#__codelineno-24-54">54</a></span>
<span class="normal"><a href="#__codelineno-24-55">55</a></span>
<span class="normal"><a href="#__codelineno-24-56">56</a></span>
<span class="normal"><a href="#__codelineno-24-57">57</a></span>
<span class="normal"><a href="#__codelineno-24-58">58</a></span>
<span class="normal"><a href="#__codelineno-24-59">59</a></span>
<span class="normal"><a href="#__codelineno-24-60">60</a></span>
<span class="normal"><a href="#__codelineno-24-61">61</a></span>
<span class="normal"><a href="#__codelineno-24-62">62</a></span>
<span class="normal"><a href="#__codelineno-24-63">63</a></span>
<span class="normal"><a href="#__codelineno-24-64">64</a></span>
<span class="normal"><a href="#__codelineno-24-65">65</a></span>
<span class="normal"><a href="#__codelineno-24-66">66</a></span>
<span class="normal"><a href="#__codelineno-24-67">67</a></span>
<span class="normal"><a href="#__codelineno-24-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="nd">@njit</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">seq_threshold_crossing_hysteresis_falling</span><span class="p">(</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3"></a>    <span class="n">arr_t</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4"></a>    <span class="n">arr_s</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5"></a>    <span class="n">threshold</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6"></a>    <span class="n">hysteresis_height</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7"></a>    <span class="n">n_est</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; This function implements the constant threshold trigger</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="sd">    method with hysteresis on the falling edge. The hysteresis</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="sd">    height is specified in voltage.</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12"></a>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="sd">    Args:</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="sd">        arr_t (np.ndarray): The time values of the signal.</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15"></a><span class="sd">        arr_s (np.ndarray): The signal to determine the threshold</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16"></a><span class="sd">            level for.</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17"></a><span class="sd">        threshold (float): The threshold level to use for the</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18"></a><span class="sd">            constant threshold trigger method.</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19"></a><span class="sd">        hysteresis_height (float): The height of the hysteresis.</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20"></a><span class="sd">            It has the same units as the signal.</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21"></a><span class="sd">        n_est (Optional[float]): The estimated number of ToAs in</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22"></a><span class="sd">            this signal. Defaults to None. This number is used to</span>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23"></a><span class="sd">            pre-allocate the array containing the ToAs. If this</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24"></a><span class="sd">            number is not provided, the array will be pre-allocated</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25"></a><span class="sd">            as the same dimension as arr_t and arr_s. You should</span>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26"></a><span class="sd">            specify this value for large signals.</span>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28"></a>    <span class="n">threshold_upper</span> <span class="o">=</span> <span class="n">threshold</span> <span class="o">+</span> <span class="n">hysteresis_height</span>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29"></a>    <span class="n">trigger_state</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">arr_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">threshold_upper</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30"></a>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31"></a>    <span class="c1"># Pre-allocate the array containing the ToAs</span>
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32"></a>    <span class="k">if</span> <span class="n">n_est</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33"></a>        <span class="n">arr_toa</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">arr_t</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35"></a>        <span class="n">arr_toa</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_est</span><span class="p">)</span>
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36"></a>
</span><span id="__span-24-37"><a id="__codelineno-24-37" name="__codelineno-24-37"></a>    <span class="c1"># Initialise the index of the ToA array</span>
</span><span id="__span-24-38"><a id="__codelineno-24-38" name="__codelineno-24-38"></a>    <span class="n">i_toa</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-24-39"><a id="__codelineno-24-39" name="__codelineno-24-39"></a>
</span><span id="__span-24-40"><a id="__codelineno-24-40" name="__codelineno-24-40"></a>    <span class="c1"># Initialise the previous sample value</span>
</span><span id="__span-24-41"><a id="__codelineno-24-41" name="__codelineno-24-41"></a>    <span class="n">prev_sample</span> <span class="o">=</span> <span class="n">arr_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-24-42"><a id="__codelineno-24-42" name="__codelineno-24-42"></a>
</span><span id="__span-24-43"><a id="__codelineno-24-43" name="__codelineno-24-43"></a>    <span class="c1"># Loop through all the samples</span>
</span><span id="__span-24-44"><a id="__codelineno-24-44" name="__codelineno-24-44"></a>    <span class="k">for</span> <span class="n">i_sample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">arr_s</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-24-45"><a id="__codelineno-24-45" name="__codelineno-24-45"></a>        <span class="c1"># Get the current sample value</span>
</span><span id="__span-24-46"><a id="__codelineno-24-46" name="__codelineno-24-46"></a>        <span class="n">curr_sample</span> <span class="o">=</span> <span class="n">arr_s</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span>
</span><span id="__span-24-47"><a id="__codelineno-24-47" name="__codelineno-24-47"></a>
</span><span id="__span-24-48"><a id="__codelineno-24-48" name="__codelineno-24-48"></a>        <span class="c1"># Check if the threshold is crossed</span>
</span><span id="__span-24-49"><a id="__codelineno-24-49" name="__codelineno-24-49"></a>        <span class="k">if</span> <span class="n">trigger_state</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-24-50"><a id="__codelineno-24-50" name="__codelineno-24-50"></a>            <span class="k">if</span> <span class="n">curr_sample</span> <span class="o">&gt;=</span> <span class="n">threshold_upper</span><span class="p">:</span>
</span><span id="__span-24-51"><a id="__codelineno-24-51" name="__codelineno-24-51"></a>                <span class="n">trigger_state</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-24-52"><a id="__codelineno-24-52" name="__codelineno-24-52"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-24-53"><a id="__codelineno-24-53" name="__codelineno-24-53"></a>            <span class="k">if</span> <span class="n">curr_sample</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">:</span>
</span><span id="__span-24-54"><a id="__codelineno-24-54" name="__codelineno-24-54"></a>                <span class="n">trigger_state</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-24-55"><a id="__codelineno-24-55" name="__codelineno-24-55"></a>                <span class="c1"># Interpolate the ToA</span>
</span><span id="__span-24-56"><a id="__codelineno-24-56" name="__codelineno-24-56"></a>                <span class="n">arr_toa</span><span class="p">[</span><span class="n">i_toa</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-24-57"><a id="__codelineno-24-57" name="__codelineno-24-57"></a>                    <span class="n">arr_t</span><span class="p">[</span><span class="n">i_sample</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> 
</span><span id="__span-24-58"><a id="__codelineno-24-58" name="__codelineno-24-58"></a>                    <span class="o">+</span> <span class="p">(</span><span class="n">arr_t</span><span class="p">[</span><span class="n">i_sample</span><span class="p">]</span> <span class="o">-</span> <span class="n">arr_t</span><span class="p">[</span><span class="n">i_sample</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> 
</span><span id="__span-24-59"><a id="__codelineno-24-59" name="__codelineno-24-59"></a>                    <span class="o">*</span> <span class="p">(</span><span class="n">threshold</span> <span class="o">-</span> <span class="n">prev_sample</span><span class="p">)</span> 
</span><span id="__span-24-60"><a id="__codelineno-24-60" name="__codelineno-24-60"></a>                    <span class="o">/</span> <span class="p">(</span><span class="n">curr_sample</span> <span class="o">-</span> <span class="n">prev_sample</span><span class="p">)</span>
</span><span id="__span-24-61"><a id="__codelineno-24-61" name="__codelineno-24-61"></a>                <span class="p">)</span>
</span><span id="__span-24-62"><a id="__codelineno-24-62" name="__codelineno-24-62"></a>                <span class="n">i_toa</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-24-63"><a id="__codelineno-24-63" name="__codelineno-24-63"></a>
</span><span id="__span-24-64"><a id="__codelineno-24-64" name="__codelineno-24-64"></a>        <span class="c1"># Update the previous sample value</span>
</span><span id="__span-24-65"><a id="__codelineno-24-65" name="__codelineno-24-65"></a>        <span class="n">prev_sample</span> <span class="o">=</span> <span class="n">curr_sample</span>
</span><span id="__span-24-66"><a id="__codelineno-24-66" name="__codelineno-24-66"></a>
</span><span id="__span-24-67"><a id="__codelineno-24-67" name="__codelineno-24-67"></a>    <span class="c1"># Return the array containing the ToAs</span>
</span><span id="__span-24-68"><a id="__codelineno-24-68" name="__codelineno-24-68"></a>    <span class="k">return</span> <span class="n">arr_toa</span><span class="p">[:</span><span class="n">i_toa</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
Example usage:
<div class="language-py highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">toas</span> <span class="o">=</span> <span class="n">seq_threshold_crossing_hysteresis_falling</span><span class="p">(</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>    <span class="n">df_proximity_probe_noisy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>    <span class="n">df_proximity_probe_noisy</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> 
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    <span class="n">hysteresis_height</span><span class="o">=</span><span class="mf">0.1</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="p">)</span>
</span></code></pre></div></p>
</details>
<div class="footnote">
<hr />
<ol>
<li id="fn:Zimmer_2008">
<p>Zimmer, A.K., 2008. Investigation of the impact of turbine blade geometry on near-field microwave blade tip time of arrival measurements (PhD thesis).&#160;<a class="footnote-backref" href="#fnref:Zimmer_2008" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:diamond2021constant">
<p>Diamond, D., Heyns, P.S., Oberholster, A., 2021. Constant speed tip deflection determination using the instantaneous phase of blade tip timing data. Mechanical Systems and Signal Processing 150, 107151.&#160;<a class="footnote-backref" href="#fnref:diamond2021constant" title="Jump back to footnote 2 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:diamond2021constant" title="Jump back to footnote 2 in the text">&#8617;</a><a class="footnote-backref" href="#fnref3:diamond2021constant" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:rokicki2021high">
<p>Rokicki, E., Przysowa, R., Kotkowski, J., Majewski, P., 2021. High temperature magnetic sensors. Preprints (DOI:10.20944/preprints202107.0077.v1 ).&#160;<a class="footnote-backref" href="#fnref:rokicki2021high" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
</ol>
</div>







  
  



  


  



                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../ch1/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 1. Blade Tip Timing&#39;s fundamental principle">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                1. Blade Tip Timing's fundamental principle
              </div>
            </div>
          </a>
        
        
          
          <a href="../ch3/" class="md-footer__link md-footer__link--next" aria-label="Next: 3. Angle of Arrival (AoA)">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                3. Angle of Arrival (AoA)
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Bladesight
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://twitter.com/DawieDiamond" target="_blank" rel="noopener" title="Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/Bladesight" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linkedin.com/in/dawie-diamond-51089676/" target="_blank" rel="noopener" title="LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.researchgate.net/profile/Dawie-Diamond-2" target="_blank" rel="noopener" title="ResearchGate" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M0 32v448h448V32zm262.2 334.4c-6.6 3-33.2 6-50-14.2-9.2-10.6-25.3-33.3-42.2-63.6-8.9 0-14.7 0-21.4-.6v46.4c0 23.5 6 21.2 25.8 23.9v8.1c-6.9-.3-23.1-.8-35.6-.8-13.1 0-26.1.6-33.6.8v-8.1c15.5-2.9 22-1.3 22-23.9V225c0-22.6-6.4-21-22-23.9V193c25.8 1 53.1-.6 70.9-.6 31.7 0 55.9 14.4 55.9 45.6 0 21.1-16.7 42.2-39.2 47.5 13.6 24.2 30 45.6 42.2 58.9 7.2 7.8 17.2 14.7 27.2 14.7zm22.9-135c-23.3 0-32.2-15.7-32.2-32.2V167c0-12.2 8.8-30.4 34-30.4s30.4 17.9 30.4 17.9l-10.7 7.2s-5.5-12.5-19.7-12.5c-7.9 0-19.7 7.3-19.7 19.7v26.8c0 13.4 6.6 23.3 17.9 23.3 14.1 0 21.5-10.9 21.5-26.8h-17.9v-10.7h30.4c0 20.5 4.7 49.9-34 49.9m-116.5 44.7c-9.4 0-13.6-.3-20-.8v-69.7c6.4-.6 15-.6 22.5-.6 23.3 0 37.2 12.2 37.2 34.5 0 21.9-15 36.6-39.7 36.6"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
    
      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tracking", "navigation.instant", "navigation.path", "navigation.footer", "content.code.copy", "content.code.select", "content.code.annotate", "content.tabs.link", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="../../../javascripts/reviews.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
      
    
  </body>
</html>