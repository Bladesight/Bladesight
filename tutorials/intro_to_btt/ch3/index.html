
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This chapter explains how to convert the Time of Arrival (ToA) values into Angle of Arrival (AoA) values.">
      
      
      
      
        <link rel="prev" href="../ch2/">
      
      
        <link rel="next" href="../ch4/">
      
      
      <link rel="icon" href="../../../images/fab.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>3. Angle of Arrival (AoA) - Bladesight Learning Centre</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M576%2048c0-11.1-5.7-21.4-15.2-27.2s-21.2-6.4-31.1-1.4L413.5%2077.5%20234.1%2017.6c-8.1-2.7-16.8-2.1-24.4%201.7l-128%2064C70.8%2088.8%2064%2099.9%2064%20112v352c0%2011.1%205.7%2021.4%2015.2%2027.2s21.2%206.4%2031.1%201.4l116.1-58.1%20173.3%2057.8c-4.3-6.4-8.5-13.1-12.6-19.9-11-18.3-21.9-39.3-30-61.8l-101.2-33.7V92.4l128%2042.7v99.3c31-35.8%2077-58.4%20128-58.4%2022.6%200%2044.2%204.4%2064%2012.5zM392%20341.9c0%2068.9%2064.1%20150.4%2098.6%20189.3%2011.6%2013%2031.3%2013%2042.9%200%2034.5-38.9%2098.6-120.4%2098.6-189.3%200-65.1-53.7-117.9-120-117.9S392%20276.8%20392%20341.9%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Literata:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Literata";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-6B961HRVZP"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-6B961HRVZP",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-6B961HRVZP",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    

<meta name="keywords" content="Blade Tip Timing, BTT, Non Intrusive Stress Measurement, NSMS, Turbine blade,Mechanical Vibration">


<meta property="og:title" content="Intro to BTT Ch3 - Angle of Arrival" />
<meta property="og:description" content="This chapter explains how to convert the Time of Arrival (ToA) values into Angle of Arrival (AoA) values." />
<meta property="og:image" content="https://intro-to-btt-using-python-assets.s3.amazonaws.com/social_card_source_ch3.png" />
<meta property="og:url" content="https://docs.bladesight.com/intro-to-bttch3/" />
<meta property="og:image:height" content="1362" />
<meta property="og:image:width" content="1970" />


<meta name="twitter:site" content="@bladesight" />
<meta name="twitter:creator" content="@dawiediamond" />

<meta name="twitter:title" content="Intro to BTT Ch3 - Angle of Arrival"/>
<meta name="twitter:image" content="https://intro-to-btt-using-python-assets.s3.amazonaws.com/social_card_source_ch3.png"/>
<meta name="twitter:url" content="https://docs.bladesight.com/intro-to-bttch3/"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:description" content="This chapter explains how to convert the Time of Arrival (ToA) values into Angle of Arrival (AoA) values."/>


<meta name="robots" content="index, follow, Blade Tip Timing, BTT, Non Intrusive Stress Measurement, NSMS, Time of Arrival, Turbine blade,Mechanical Vibration" />
  


  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="bladesight" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#angle-of-arrival-aoa" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            
            
  A new review has been added to chapters 2 and 3 of the BTT tutorial. Look out for a button 👀 at the top of the screen to activate it.

          </div>
          
            <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
          
        </aside>
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Bladesight Learning Centre" class="md-header__button md-logo" aria-label="Bladesight Learning Centre" data-md-component="logo">
      
  <img src="../../../assets/horizontal_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Bladesight Learning Centre
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3. Angle of Arrival (AoA)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="bladesight" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Bladesight Learning Centre

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ch1/" class="md-tabs__link">
          
  
  
  Introduction to Blade Tip Timing

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../datasets/diamond_et_al_2024_vary_ramp_rates_45" class="md-tabs__link">
          
  
  
  Datasets

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../reference/dataset_handler/" class="md-tabs__link">
          
  
  
  User Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!--
  Copyright (c) 2016-2024 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Determine classes -->


  



<!-- Navigation -->
<nav
  class="md-nav md-nav--primary md-nav--lifted"
  aria-label="Navigation"
  data-md-level="0"
>

  <!-- Site title -->
  <label class="md-nav__title" for="__drawer">
    <a
      href="../../.."
      title="Bladesight Learning Centre"
      class="md-nav__button md-logo"
      aria-label="Bladesight Learning Centre"
      data-md-component="logo"
    >
      
  <img src="../../../assets/horizontal_white.png" alt="logo">

    </a>
    Bladesight Learning Centre
  </label>

  <!-- Repository information -->
  

  <!-- Navigation list -->
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bladesight Learning Centre
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Introduction to Blade Tip Timing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction to Blade Tip Timing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Blade Tip Timing's fundamental principle
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2. Time of Arrival (ToA)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    3. Angle of Arrival (AoA)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    3. Angle of Arrival (AoA)
    
  </span>
  

      </a>
      
        
  
  <nav class="md-nav md-nav--secondary" aria-label="Table of contents">
    
    
    
      
    
    
<div id="mc_embed_shell">
    <link href="//cdn-images.mailchimp.com/embedcode/classic-061523.css" rel="stylesheet" type="text/css">
<style type="text/css">
      #mc_embed_signup{background:#fff; false;clear:left; font:14px Helvetica,Arial,sans-serif; width: 200px;}
      /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<!-- <div id="mc_embed_signup">
  <form action="https://bladesight.us8.list-manage.com/subscribe/post?u=d61691d2e27bf9fdb772ac2d6&amp;id=5c2250604e&amp;f_id=006109e0f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" style="margin:0px 0px 0px 1rem;">
      <div id="mc_embed_signup_scroll"><h4>Subscribe to Bladesight's newsletter👇</h4>
          <div class="mc-field-group"><label for="mce-EMAIL">Email Address <span class="asterisk">*</span></label><input type="email" name="EMAIL" class="required email" id="mce-EMAIL" required="" value=""><span id="mce-EMAIL-HELPERTEXT" class="helper_text"></span></div>
      <div id="mce-responses" class="clear foot">
          <div class="response" id="mce-error-response" style="display: none;"></div>
          <div class="response" id="mce-success-response" style="display: none;"></div>
      </div>
  <div aria-hidden="true" style="position: absolute; left: -5000px;">
      /* real people should not fill this in and expect good things - do not remove this or risk form bot signups */
      <input type="text" name="b_d61691d2e27bf9fdb772ac2d6_5c2250604e" tabindex="-1" value="">
  </div>
      <div class="optionalParent">
          <div class="clear foot">
              <input type="submit" name="subscribe" id="mc-embedded-subscribe" class="button" value="Subscribe">
          </div>
      </div>
  </div>
</form>
</div> -->

<script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script></div>

      <label class="md-nav__title" for="__toc">
        <span class="md-nav__icon md-icon"></span>
        Table of contents
      </label>
      <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
        
          <li class="md-nav__item">
  <a href="#shaft-encoder" class="md-nav__link">
    <span class="md-ellipsis">
      Shaft encoder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#angle-of-arrival-aoa_1" class="md-nav__link">
    <span class="md-ellipsis">
      Angle of Arrival (AoA)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#following-along" class="md-nav__link">
    <span class="md-ellipsis">
      Following along
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Example usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discussion" class="md-nav__link">
    <span class="md-ellipsis">
      Discussion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Discussion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sensor-limited-bandwidth-noise" class="md-nav__link">
    <span class="md-ellipsis">
      Sensor limited bandwidth noise
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blade-vibration" class="md-nav__link">
    <span class="md-ellipsis">
      Blade vibration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#high-frequency-noise" class="md-nav__link">
    <span class="md-ellipsis">
      High frequency noise
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-constant-shaft-speed" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Constant shaft speed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#untwist-and-centrifugal-stiffening" class="md-nav__link">
    <span class="md-ellipsis">
      Untwist and centrifugal stiffening
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#increased-pressure-on-blades" class="md-nav__link">
    <span class="md-ellipsis">
      Increased pressure on blades
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acknowledgements" class="md-nav__link">
    <span class="md-ellipsis">
      Acknowledgements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coding-exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Coding Exercises
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coding Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-1" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-2" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-3" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    
  </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4. Allocating AoAs to blades
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5. Working with multiple probes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6. Data Zeroing and Filtering
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7. Synchronous Vibration and Sampling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8. Single Degree of Freedom (SDoF) Method
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    9. Circumferential Fourier Fit (CFF) Method
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../afterword/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Afterword
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/diamond_et_al_2024_vary_ramp_rates_45" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Varying ramp rates with 45 degree pipe
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            User Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/dataset_handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dataset handler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    btt
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            btt
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/btt/triggering_criteria/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Triggering criteria
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
  <br/>
  <br/>
  <br/>
  <a
    href="https://www.bladesight.com/"
    target="_blank"
    style="text-align: -webkit-center;"
  >
    <img src="https://intro-to-btt-using-python-assets.s3.amazonaws.com/kraken1.jpeg" 
    alt="Kraken" 
    style="width: 120px; display: flex; padding: 2px 0px; justify-content: center; align-items: center; border: 2px;">
    <p><strong>Unleash the Kraken🐙</strong></p>
    </a>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
  
  <nav class="md-nav md-nav--secondary" aria-label="Table of contents">
    
    
    
      
    
    
<div id="mc_embed_shell">
    <link href="//cdn-images.mailchimp.com/embedcode/classic-061523.css" rel="stylesheet" type="text/css">
<style type="text/css">
      #mc_embed_signup{background:#fff; false;clear:left; font:14px Helvetica,Arial,sans-serif; width: 200px;}
      /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<!-- <div id="mc_embed_signup">
  <form action="https://bladesight.us8.list-manage.com/subscribe/post?u=d61691d2e27bf9fdb772ac2d6&amp;id=5c2250604e&amp;f_id=006109e0f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" style="margin:0px 0px 0px 1rem;">
      <div id="mc_embed_signup_scroll"><h4>Subscribe to Bladesight's newsletter👇</h4>
          <div class="mc-field-group"><label for="mce-EMAIL">Email Address <span class="asterisk">*</span></label><input type="email" name="EMAIL" class="required email" id="mce-EMAIL" required="" value=""><span id="mce-EMAIL-HELPERTEXT" class="helper_text"></span></div>
      <div id="mce-responses" class="clear foot">
          <div class="response" id="mce-error-response" style="display: none;"></div>
          <div class="response" id="mce-success-response" style="display: none;"></div>
      </div>
  <div aria-hidden="true" style="position: absolute; left: -5000px;">
      /* real people should not fill this in and expect good things - do not remove this or risk form bot signups */
      <input type="text" name="b_d61691d2e27bf9fdb772ac2d6_5c2250604e" tabindex="-1" value="">
  </div>
      <div class="optionalParent">
          <div class="clear foot">
              <input type="submit" name="subscribe" id="mc-embedded-subscribe" class="button" value="Subscribe">
          </div>
      </div>
  </div>
</form>
</div> -->

<script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script></div>

      <label class="md-nav__title" for="__toc">
        <span class="md-nav__icon md-icon"></span>
        Table of contents
      </label>
      <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
        
          <li class="md-nav__item">
  <a href="#shaft-encoder" class="md-nav__link">
    <span class="md-ellipsis">
      Shaft encoder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#angle-of-arrival-aoa_1" class="md-nav__link">
    <span class="md-ellipsis">
      Angle of Arrival (AoA)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#following-along" class="md-nav__link">
    <span class="md-ellipsis">
      Following along
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Example usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#discussion" class="md-nav__link">
    <span class="md-ellipsis">
      Discussion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Discussion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sensor-limited-bandwidth-noise" class="md-nav__link">
    <span class="md-ellipsis">
      Sensor limited bandwidth noise
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blade-vibration" class="md-nav__link">
    <span class="md-ellipsis">
      Blade vibration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#high-frequency-noise" class="md-nav__link">
    <span class="md-ellipsis">
      High frequency noise
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-constant-shaft-speed" class="md-nav__link">
    <span class="md-ellipsis">
      Non-Constant shaft speed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#untwist-and-centrifugal-stiffening" class="md-nav__link">
    <span class="md-ellipsis">
      Untwist and centrifugal stiffening
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#increased-pressure-on-blades" class="md-nav__link">
    <span class="md-ellipsis">
      Increased pressure on blades
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acknowledgements" class="md-nav__link">
    <span class="md-ellipsis">
      Acknowledgements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coding-exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Coding Exercises
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coding Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-1" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-2" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problem-3" class="md-nav__link">
    <span class="md-ellipsis">
      Problem 3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    
  </nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  


  <nav class="md-tags" hidden>
    
      
      
      
        <span class="md-tag">BTT</span>
      
    
      
      
      
        <span class="md-tag">Blade Tip Timing</span>
      
    
      
      
      
        <span class="md-tag">Mechanical Vibration</span>
      
    
      
      
      
        <span class="md-tag">NSMS</span>
      
    
      
      
      
        <span class="md-tag">Non Intrusive Stress Measurement</span>
      
    
      
      
      
        <span class="md-tag">Time of Arrival</span>
      
    
      
      
      
        <span class="md-tag">Turbine blade</span>
      
    
  </nav>



<details class="abstract">
<summary>You are here</summary>
<p><figure markdown>
<img alt="BTT Tutorial Roadmap" src="BTT_Tutorial_Outline_Ch3.svg" width="500" />
</figure></p>
</details>
<details class="note">
<summary>Reviews</summary>
<p>Please read through the chapter prior to activating a review as I have kept the chapters deliberately terse. </p>
<p>Click to activate a review 👇 for more detailed comments from other experts.</p>
<p><a onclick="toggleBtnClicked('Mirosław Witoś')" class='md-button md-small review-toggle' data-author="Mirosław Witoś">
    Mirosław Witoś
</a></p>
</details>
<style>
:root {
  --md-tooltip-width: 600px;
}

.blog-timestamp-span {
    display : flex; 
}

.blog-timestamp-span > svg {
    margin-right: 5px;
}

</style>

<h1 id="angle-of-arrival-aoa">Angle of Arrival (AoA)</h1>
<p>We are 30% through the tutorial. At this stage, we've learned how to process the raw analogue waveforms into a vector of <em>Time of Arrivals</em> (ToAs). We've said that, at the end of this tutorial, we will be able to infer vibration characteristics of each blade's <em>tip deflections</em>. This presents an interesting challenge.</p>
<p>Tip deflections are entities of <em>distance</em>.</p>
<p>ToAs represent <em>time</em>.</p>
<p>The two quantities are in different domains.</p>
<p>We therefore need to convert from <em>time</em> to <em>distance</em>. How on earth will we do this? You may as well open a file full of accelerometer measurements and attempt to infer the temperature of the instrumented structure.</p>
<figure>
<p><img alt="Different domains" src="time_to_distance.jpg" width="700" />
    <figcaption><strong><a name='figure_01'>Figure 1</a></strong>: We need to convert our ToAs from seconds into some unit of distance. </figcaption></p>
</figure>
<p>Fortunately, a fundamental mathematical property of bodies that rotate about an axis is known to us. A body that rotates an entire circle has traveled 360 degrees, or <span class="arithmatex">\(2\pi\)</span> radians. </p>
<p>Radians may not yet be in units of mm or meters. It does, however, transport us into the distance domain.</p>
<p>To perform this conversion, we use a <em>shaft encoder</em>.</p>
<div class="admonition question">
<p class="admonition-title">Outcomes</p>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5z"/></svg></span> Understand we use a shaft encoder to calculate the shaft speed, <span class="arithmatex">\(\Omega\)</span>, and the start and end of each revolution. </p>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5z"/></svg></span> Understand we need to find the shaft revolution in which each ToA occurs.</p>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5z"/></svg></span> Understand each ToA is used to calculate the precise shaft circumferential displacement in said revolution. This is the AoA of each ToA.</p>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5z"/></svg></span> Write a function that calculates a matrix of AoAs from the shaft encoder zero-crossing times and the ToAs.</p>
</div>
<h2 id="shaft-encoder">Shaft encoder</h2>
<p>Most BTT systems rely on a shaft encoder installed on the rotor. A shaft encoder produces a pulse train, similar to the proximity probes discussed in the last chapter.</p>
<p>A typical shaft encoder is shown in <a href="#figure_02">Figure 2</a> below. It consists of a rotating shaft with a key and a stationary sensor mounted next to the key.</p>
<figure>
<p><img alt="Shaft encoder illustration" src="ch3_shaft_encoder_illustration.svg" width="750" />
    <figcaption><strong><a name='figure_02'>Figure 2</a></strong>: A shaft encoder consists of a rotating shaft with a key and a stationary sensor mounted next to the key. The sensor "picks up" the presence of the key as it rotates by. A voltage pulse train is produced that is processed to find the zero-crossing times. </figcaption></p>
</figure>
<div class='review' data-author='Mirosław Witoś' data-innerhtml="<p>The introduction of zc variables only in Figure 2 (the values of the times of occurrence of the trigger pulse) deteriorates the clarity of the subsequent message, including formula (1). </p><p>It is advisable to introduce the zc variable in the text, and preferably use the typical time designations (t with subscript)</p><p><strong>Author's note:</strong> I've changed the notation to t_zc_i." >
</div>

<p>The sensor in this case produces One Pulse per Revolution (OPR). Some shaft encoders produce Multiple Pulses per Revolution (MPR). This tutorial considers the OPR case. OPR encoders are more prevalent than their MPR counterparts.</p>
<p>We extract the ToAs from the OPR signal with a trigger criteria, just like we used for the blade ToAs in the previous chapter. The OPR timestamps are often referred to as <em>zero-crossing</em> times. This terminology creates the impression they are registered only when the signal crosses 0 V. Though this is often the case, these timestamps can be extracted using any trigger criteria. Each timestamp therefore corresponds to the start of a new shaft revolution.</p>
<div class="admonition note">
<p class="admonition-title">Zero-crossing times</p>
<p>A zero-crossing time is the exact timestamp a revolution starts. The next timestamp is, by definition, the exact time the revolution ends and the next one starts.</p>
<p>Do not confuse zero-crossing times and ToAs:</p>
<ol>
<li>
<p><strong>Zero-crossing times</strong> refer to timestamps captured by the shaft encoder. They are the start of each revolution. I've added the subscript <span class="arithmatex">\(\mathbf{\textrm{zc}}\)</span> to all zero-crossing times to differentiate them from the ToAs.</p>
</li>
<li>
<p><strong>ToAs</strong> refer to the timestamps captured by the proximity probes in the casing. They are the times the blades passed the probes.</p>
</li>
</ol>
</div>
<p>After processing the shaft encoder's analogue waveform, we have a vector of zero-crossing times. The shaft speed between them can be calculated from <a href="#equation_01">Equation 1</a> below.</p>
<div class="arithmatex">\[\begin{equation}
\Omega_n = \frac{2 \pi}{t_{\textrm{zc}_{n+1}} - t_{\textrm{zc}_{n}}}
\end{equation}\]</div>
<p><span id="equation_01"></span></p>
<div class='review' data-author='Mirosław Witoś' data-innerhtml="<p>Formula (1) describes the average shaft speed, with a sampling rate of 1x per revolution. The use of this speed is justified only if there is no skewness or misalignment of the shaft. Otherwise, the determined AoA(TOA) will contain additional error.</p>" >
</div>

<details class="info">
<summary>Symbols</summary>
<table>
<thead>
<tr>
<th style="text-align: center;">Symbol</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(\Omega_n\)</span></td>
<td style="text-align: left;">Shaft speed in the <span class="arithmatex">\(n\)</span>th revolution</td>
</tr>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(n\)</span></td>
<td style="text-align: left;">The revolution number</td>
</tr>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(t_{\textrm{zc}_{n}}\)</span></td>
<td style="text-align: left;">The <span class="arithmatex">\(n\)</span>th zero-crossing time</td>
</tr>
</tbody>
</table>
</details>
<p>An example of the shaft speed calculated from <a href="#equation_01">Equation 1</a> is presented in <a href="#figure_03">Figure 3</a> below.</p>
<script src="shaft_run_up_and_down.js" > </script>
<div>
    <div>
        <canvas id="ch03_shaft_run_up_and_down"'></canvas>
    </div>
    <script>
        async function render_chart_shaft_run_up_and_down() {
            const ctx = document.getElementById('ch03_shaft_run_up_and_down');
            // If this is a mobile device, set the canvas height to 400
            if (window.innerWidth < 500) {
                ctx.height = 400;
            }
            while (typeof Chart == "undefined") {
                await new Promise(r => setTimeout(r, 1000));
                console.log("CHECKED FOR CHART")
            }
            Chart.defaults.font.family = "Literata, -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif";
            window.fig_shaft_run_up_and_down = new Chart(ctx, window.shaft_run_up_and_down);
            window.fig_shaft_run_up_and_down_reset = function resetZoomFig1() {
                    window.fig_shaft_run_up_and_down.resetZoom();
                }
            }
        render_chart_shaft_run_up_and_down();
    </script>
    <a onclick="window.fig_shaft_run_up_and_down_reset()" class='md-button'>Reset Zoom</a>
</div>
<figure>
<figcaption><strong><a name='figure_03'>Figure 3</a></strong>: A shaft accelerating from 950 RPM to 1325 RPM and back again over a time of 41 seconds. </figcaption>
</figure>
<p>The figure above presents the run-up and run-down of a shaft between 950 RPM and 1325 RPM over approximately 41 seconds.</p>
<details class="info">
<summary>Encoder-less techniques</summary>
<p>Some publications refer to <em>encoder-less</em> BTT systems. These are advanced techniques normally used when there's no encoder. The techniques are beyond the scope of this tutorial. </p>
</details>
<details class="info">
<summary>Which probes can you use for the shaft encoder?</summary>
<p>You can use any probe capable of responding to the presence of a discontinuity on the shaft. I often use eddy current probes or optical pickups. </p>
</details>
<details class="info">
<summary>At which circumferential position should the probe be installed?</summary>
<p>It makes no difference where the probe is installed. The only requirement is the probe must be able to detect the presence of the shaft's discontinuity.</p>
</details>
<h2 id="angle-of-arrival-aoa_1">Angle of Arrival (AoA)</h2>
<p>The shaft's circumferential position when the ToA is registered is referred to as the Angle of Arrival (AoA). It is calculated with respect to the revolution in which it occurs. In other words, it is always a quantity between 0 and <span class="arithmatex">\(2 \pi\)</span> within each revolution. </p>
<p>We use <a href="#equation_02">Equation 2</a> below to calculate the AoA.</p>
<div class="arithmatex">\[\begin{equation}
\textrm{AoA} (\textrm{ToA}) = \Omega_n \times (\textrm{ToA} - t_{\textrm{zc}_{n}})
\end{equation}\]</div>
<p><span id="equation_02"></span></p>
<details class="info">
<summary>Symbols</summary>
<table>
<thead>
<tr>
<th style="text-align: center;">Symbol</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(\textrm{AoA} (\textrm{ToA})\)</span></td>
<td style="text-align: left;">The AoA corresponding to the ToA</td>
</tr>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(n\)</span></td>
<td style="text-align: left;">The revolution number in which the ToA occurs</td>
</tr>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(\textrm{ToA}\)</span></td>
<td style="text-align: left;">The ToA. It must occur within revolution <span class="arithmatex">\(n\)</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(\Omega_n\)</span></td>
<td style="text-align: left;">The shaft speed in the <span class="arithmatex">\(n\)</span>th revolution</td>
</tr>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(t_{\text{zc}_{n}}\)</span></td>
<td style="text-align: left;">The zero-crossing time at the start of the <span class="arithmatex">\(n\)</span>th revolution</td>
</tr>
</tbody>
</table>
</details>
<p>Our algorithm must perform two cardinal tasks to calculate AoAs from ToAs:</p>
<ol>
<li>
<p>Determine the revolution number in which each ToA occurs.</p>
</li>
<li>
<p>Calculate the AoA of each ToA within its revolution.</p>
</li>
</ol>
<p>This two-step process can be performed with a single function. In this chapter, we write a function receiving a vector of ToAs and a vector of zero-crossing times as inputs. It returns a matrix of values that includes the AoAs and identified revolution numbers. We will, once again, use Numba to speed things up. Learning how to leverage Numba gives you a skill with applications in most code-centric industries.</p>
<h2 id="following-along">Following along</h2>
<p>The worksheet for this chapter can be downloaded here <a href="https://github.com/Bladesight/bladesight-worksheets/blob/master/intro_to_btt/ch_03_worksheet.ipynb" target="_blank"><img src="https://img.shields.io/badge/GitHub-100000?style=for-the-badge&logo=github&logoColor=white" alt="Open In Github"/></a>.</p>
<p>You can open a Google Colab session of the worksheet here: <a href="https://colab.research.google.com/github/Bladesight/bladesight-worksheets/blob/master/intro_to_btt/ch_03_worksheet.ipynb" target="_blank"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a>.</p>
<p>You need to use one of these Python versions to run the worksheet:
<img src="https://img.shields.io/badge/python-3.9-blue.svg">
<img src="https://img.shields.io/badge/python-3.10-blue.svg">
<img src="https://img.shields.io/badge/python-3.11-blue.svg">
.</p>
<h2 id="algorithm">Algorithm</h2>
<p>To perform this conversion from time to angle, our algorithm calculates several quantities for each ToA:</p>
<ol>
<li>
<p>The revolution number, <span class="arithmatex">\(n\)</span>, in which the ToA occurs.</p>
</li>
<li>
<p>The zero-crossing times at the start and end of the ToA's revolution, referred to as <span class="arithmatex">\(zc_n\)</span> and <span class="arithmatex">\(zc_{n+1}\)</span> respectively.</p>
</li>
<li>
<p>The angular velocity of the shaft in the revolution, <span class="arithmatex">\(\Omega_n\)</span>.</p>
</li>
<li>
<p>The shaft's angular position when the ToA was triggered. This is referred to as the AoA of the ToA. Each ToA therefore has one AoA.</p>
</li>
</ol>
<p>Let's consider a simple example. We have measured 6 ToAs and 3 zero-crossing times:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">ToAs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">1.3</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.7</span><span class="p">]</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">t_zc_times</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]</span>
</span></code></pre></div>
<p>We place the ToAs and the zero-crossing times on a horizontal axis. This makes it simpler to visualize.</p>
<p>The clickable tabs below present the calculations for each ToA.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:6"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><input id="__tabbed_1_4" name="__tabbed_1" type="radio" /><input id="__tabbed_1_5" name="__tabbed_1" type="radio" /><input id="__tabbed_1_6" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">ToA no 1</label><label for="__tabbed_1_2">ToA no 2</label><label for="__tabbed_1_3">ToA no 3</label><label for="__tabbed_1_4">ToA no 4</label><label for="__tabbed_1_5">ToA no 5</label><label for="__tabbed_1_6">ToA no 6</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-console highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="go">ToAs           = [       0.3     0.5     0.7            1.3     1.5     1.7         ]</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="go">                          |</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="go">                          | </span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="go">                          ↓ </span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="go">                 __|_______________________________|______________________________|__</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="go">t_zc_times     = [0.0                             1.0                            2.0]</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="go">revolution_no  = [0                               1                              2  ]</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="go">Calculated values:</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="go">current_revolution = 0</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="go">t_zc_start         = 0.0</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="go">t_zc_end           = 1.0</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="go">Omega              = 2 π / (t_zc_end - t_zc_start) = 2 π / 1.0       = 2.0 π</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="go">AoA                = Omega * (ToA - t_zc_start)  = 2 π * (0.3 - 0.0) = 0.6 π</span>
</span></code></pre></div>
<p>The allocated values after the first ToA is shown below 👇.</p>
<table>
<thead>
<tr>
<th>n</th>
<th>n_start_time</th>
<th>n_end_time</th>
<th>Omega</th>
<th>ToA</th>
<th>AoA</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.3</td>
<td>0.6 π</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-console highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="go">ToAs           = [       0.3     0.5     0.7            1.3     1.5     1.7         ]</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="go">                                  |</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="go">                                  | </span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="go">                                  ↓ </span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="go">                 __|_______________________________|______________________________|__</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="go">t_zc_times     = [0.0                             1.0                            2.0]</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="go">revolution_no  = [0                               1                              2  ]</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="go">Calculated values:</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="go">current_revolution = 0</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="go">t_zc_start         = 0.0</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="go">t_zc_end           = 1.0</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="go">Omega              = 2 π / (t_zc_end - t_zc_start) = 2 π / 1.0       = 2.0 π</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="go">AoA                = Omega * (ToA - t_zc_start)  = 2 π * (0.5 - 0.0) = 1.0 π</span>
</span></code></pre></div>
<p>The allocated values after the second ToA is shown below 👇.</p>
<table>
<thead>
<tr>
<th>n</th>
<th>n_start_time</th>
<th>n_end_time</th>
<th>Omega</th>
<th>ToA</th>
<th>AoA</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.3</td>
<td>0.6 π</td>
</tr>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.5</td>
<td>1.0 π</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-console highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="go">ToAs           = [       0.3     0.5     0.7            1.3     1.5     1.7         ]</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="go">                                          |</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="go">                                          | </span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="go">                                          ↓ </span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="go">                 __|_______________________________|______________________________|__</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="go">t_zc_times     = [0.0                             1.0                            2.0]</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="go">revolution_no  = [0                               1                              2  ]</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="go">Calculated values:</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="go">current_revolution = 0</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="go">t_zc_start         = 0.0</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="go">t_zc_end           = 1.0</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="go">Omega              = 2 π / (t_zc_end - t_zc_start) = 2 π / 1.0       = 2.0 π</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="go">AoA                = Omega * (ToA - t_zc_start)  = 2 π * (0.7 - 0.0) = 1.4 π</span>
</span></code></pre></div>
<p>The allocated values after the third ToA is shown below 👇.</p>
<table>
<thead>
<tr>
<th>n</th>
<th>n_start_time</th>
<th>n_end_time</th>
<th>Omega</th>
<th>ToA</th>
<th>AoA</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.3</td>
<td>0.6 π</td>
</tr>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.5</td>
<td>1.0 π</td>
</tr>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.7</td>
<td>1.4 π</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-console highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="go">ToAs           = [       0.3     0.5     0.7            1.3     1.5     1.7         ]</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="go">                                                         |</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="go">                                                         | </span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="go">                                                         ↓ </span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="go">                 __|_______________________________|______________________________|__</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="go">t_zc_times     = [0.0                             1.0                            2.0]</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="go">revolution_no  = [0                               1                              2  ]</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="go">Calculated values:</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="go">current_revolution = 1</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="go">t_zc_start         = 1.0</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="go">t_zc_end           = 2.0</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="go">Omega              = 2 π / (t_zc_end - t_zc_start) = 2 π / 1.0       = 2.0 π</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="go">AoA                = Omega * (ToA - t_zc_start)  = 2 π * (1.3 - 1.0) = 0.6 π</span>
</span></code></pre></div>
<p>The allocated values after the fourth ToA is shown below 👇.</p>
<table>
<thead>
<tr>
<th>n</th>
<th>n_start_time</th>
<th>n_end_time</th>
<th>Omega</th>
<th>ToA</th>
<th>AoA</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.3</td>
<td>0.6 π</td>
</tr>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.5</td>
<td>1.0 π</td>
</tr>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.7</td>
<td>1.4 π</td>
</tr>
<tr>
<td>1</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0π</td>
<td>1.3</td>
<td>0.6 π</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-console highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="go">ToAs           = [       0.3     0.5     0.7            1.3     1.5     1.7         ]</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="go">                                                                 |</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="go">                                                                 | </span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="go">                                                                 ↓ </span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="go">                 __|_______________________________|______________________________|__</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="go">t_zc_times     = [0.0                             1.0                            2.0]</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="go">revolution_no  = [0                               1                              2  ]</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="go">Calculated values:</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="go">current_revolution = 1</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="go">t_zc_start         = 1.0</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="go">t_zc_end           = 2.0</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="go">Omega              = 2 π / (t_zc_end - t_zc_start) = 2 π / 1.0       = 2.0 π</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="go">AoA                = Omega * (ToA - t_zc_start)  = 2 π * (1.5 - 1.0) = 1.0 π</span>
</span></code></pre></div>
<p>The allocated values after the fifth ToA is shown below 👇.</p>
<table>
<thead>
<tr>
<th>n</th>
<th>n_start_time</th>
<th>n_end_time</th>
<th>Omega</th>
<th>ToA</th>
<th>AoA</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.3</td>
<td>0.6 π</td>
</tr>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.5</td>
<td>1.0 π</td>
</tr>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.7</td>
<td>1.4 π</td>
</tr>
<tr>
<td>1</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0π</td>
<td>1.3</td>
<td>0.6 π</td>
</tr>
<tr>
<td>1</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0π</td>
<td>1.5</td>
<td>1.0 π</td>
</tr>
<tr>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-console highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="go">ToAs           = [       0.3     0.5     0.7            1.3     1.5     1.7         ]</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="go">                                                                         |</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="go">                                                                         | </span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="go">                                                                         ↓ </span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="go">                 __|_______________________________|______________________________|__</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="go">t_zc_times     = [0.0                             1.0                            2.0]</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="go">revolution_no  = [0                               1                              2  ]</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="go">Calculated values:</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="go">current_revolution = 1</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="go">t_zc_start         = 1.0</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="go">t_zc_end           = 2.0</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="go">Omega              = 2 π / (t_zc_end - t_zc_start) = 2 π / 1.0       = 2.0 π</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="go">AoA                = Omega * (ToA - t_zc_start)  = 2 π * (1.7 - 1.0) = 1.4 π</span>
</span></code></pre></div>
<p>The allocated values after the sixth ToA is shown below 👇.</p>
<table>
<thead>
<tr>
<th>n</th>
<th>n_start_time</th>
<th>n_end_time</th>
<th>Omega</th>
<th>ToA</th>
<th>AoA</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.3</td>
<td>0.6 π</td>
</tr>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.5</td>
<td>1.0 π</td>
</tr>
<tr>
<td>0</td>
<td>0.0</td>
<td>1.0</td>
<td>2.0π</td>
<td>0.7</td>
<td>1.4 π</td>
</tr>
<tr>
<td>1</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0π</td>
<td>1.3</td>
<td>0.6 π</td>
</tr>
<tr>
<td>1</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0π</td>
<td>1.5</td>
<td>1.0 π</td>
</tr>
<tr>
<td>1</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0π</td>
<td>1.7</td>
<td>1.4 π</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Each calculation is performed sequentially. The results of each calculation are appended to the output matrix.</p>
<div class="admonition tip">
<p class="admonition-title">The blade count is unknown</p>
<p>You'll notice I have not stated how many blades are on the rotor for this simple example. This was by choice. At this stage of analysis, we do not need to incorporate the number of blades. We simply need to determine the revolution in which a ToA occurs and the corresponding AoA.</p>
<p>You may be able to guess there are 3 blades. You should, however, not adapt your algorithm to <em>expect</em> a specific number of them. The reason for this is there can be missing or double ToAs and zero-crossing times. If you expect a certain number of time stamps but the measurement does not contain exactly what you require, your analysis will be corrupted.</p>
<p>The algorithm presented in this chapter may be more complex than slicing the ToAs equally into bins, but it will save you from a lot of headaches in the future.</p>
</div>
<p>Based on the above example, we can write the code to calculate the AoA of each ToA. I have included comments that can be opened by clicking on the <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 13h-4v4h-2v-4H7v-2h4V7h2v4h4m-5-9A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2"/></svg></span> symbols. </p>
<p>If these symbols are not visible, refresh the page. If they're still not visible, download Google Chrome and try again 😁.</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span>
<span class="normal"><a href="#__codelineno-7-33">33</a></span>
<span class="normal"><a href="#__codelineno-7-34">34</a></span>
<span class="normal"><a href="#__codelineno-7-35">35</a></span>
<span class="normal"><a href="#__codelineno-7-36">36</a></span>
<span class="normal"><a href="#__codelineno-7-37">37</a></span>
<span class="normal"><a href="#__codelineno-7-38">38</a></span>
<span class="normal"><a href="#__codelineno-7-39">39</a></span>
<span class="normal"><a href="#__codelineno-7-40">40</a></span>
<span class="normal"><a href="#__codelineno-7-41">41</a></span>
<span class="normal"><a href="#__codelineno-7-42">42</a></span>
<span class="normal"><a href="#__codelineno-7-43">43</a></span>
<span class="normal"><a href="#__codelineno-7-44">44</a></span>
<span class="normal"><a href="#__codelineno-7-45">45</a></span>
<span class="normal"><a href="#__codelineno-7-46">46</a></span>
<span class="normal"><a href="#__codelineno-7-47">47</a></span>
<span class="normal"><a href="#__codelineno-7-48">48</a></span>
<span class="normal"><a href="#__codelineno-7-49">49</a></span>
<span class="normal"><a href="#__codelineno-7-50">50</a></span>
<span class="normal"><a href="#__codelineno-7-51">51</a></span>
<span class="normal"><a href="#__codelineno-7-52">52</a></span>
<span class="normal"><a href="#__codelineno-7-53">53</a></span>
<span class="normal"><a href="#__codelineno-7-54">54</a></span>
<span class="normal"><a href="#__codelineno-7-55">55</a></span>
<span class="normal"><a href="#__codelineno-7-56">56</a></span>
<span class="normal"><a href="#__codelineno-7-57">57</a></span>
<span class="normal"><a href="#__codelineno-7-58">58</a></span>
<span class="normal"><a href="#__codelineno-7-59">59</a></span>
<span class="normal"><a href="#__codelineno-7-60">60</a></span>
<span class="normal"><a href="#__codelineno-7-61">61</a></span>
<span class="normal"><a href="#__codelineno-7-62">62</a></span>
<span class="normal"><a href="#__codelineno-7-63">63</a></span>
<span class="normal"><a href="#__codelineno-7-64">64</a></span>
<span class="normal"><a href="#__codelineno-7-65">65</a></span>
<span class="normal"><a href="#__codelineno-7-66">66</a></span>
<span class="normal"><a href="#__codelineno-7-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">numba</span><span class="w"> </span><span class="kn">import</span> <span class="n">njit</span> <span class="c1">#(1)!</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="nd">@njit</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_aoa</span><span class="p">(</span><span class="c1">#(2)!</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a>    <span class="n">arr_opr_zero_crossing</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a>    <span class="n">arr_probe_toas</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="p">):</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="sd">    This function calculates the angle of arrival of </span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="sd">    each ToA value relative to the revolution in </span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="sd">    which it occurs.</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13"></a>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="sd">    Args:</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="sd">        arr_opr_zero_crossing (np.array): An array of </span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="sd">            OPR zero-crossing times. </span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="sd">        arr_probe_toas (np.array): An array of </span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="sd">            ToA values.</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19"></a>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="sd">    Returns:</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="sd">        np.array: A matrix of AoA values. Each row in the </span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="sd">            matrix corresponds to a ToA value. The columns </span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="sd">            are:</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="sd">            0: The revolution number</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="sd">            1: The zero-crossing time at the start of the revolution</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="sd">            2: The zero-crossing time at the end of the revolution</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="sd">            3: The angular velocity of the revolution</span>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="sd">            4: The ToA</span>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29"></a><span class="sd">            5: The AoA of the ToA value</span>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31"></a>    <span class="n">num_toas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr_probe_toas</span><span class="p">)</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32"></a>    <span class="n">AoA_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">num_toas</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33"></a>    <span class="c1">#(3)!</span>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34"></a>    <span class="n">AoA_matrix</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35"></a>
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36"></a>    <span class="n">current_revolution_start_time</span> <span class="o">=</span> <span class="n">arr_opr_zero_crossing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37"></a>    <span class="n">current_revolution_end_time</span> <span class="o">=</span> <span class="n">arr_opr_zero_crossing</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38"></a>    <span class="n">current_n</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-7-39"><a id="__codelineno-7-39" name="__codelineno-7-39"></a>    <span class="c1">#(4)!</span>
</span><span id="__span-7-40"><a id="__codelineno-7-40" name="__codelineno-7-40"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">toa</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arr_probe_toas</span><span class="p">):</span>
</span><span id="__span-7-41"><a id="__codelineno-7-41" name="__codelineno-7-41"></a>        <span class="c1">#(5)!</span>
</span><span id="__span-7-42"><a id="__codelineno-7-42" name="__codelineno-7-42"></a>        <span class="k">while</span> <span class="n">toa</span> <span class="o">&gt;</span> <span class="n">current_revolution_end_time</span><span class="p">:</span>
</span><span id="__span-7-43"><a id="__codelineno-7-43" name="__codelineno-7-43"></a>            <span class="n">current_n</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-7-44"><a id="__codelineno-7-44" name="__codelineno-7-44"></a>            <span class="k">if</span> <span class="n">current_n</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_opr_zero_crossing</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="__span-7-45"><a id="__codelineno-7-45" name="__codelineno-7-45"></a>                <span class="k">break</span>
</span><span id="__span-7-46"><a id="__codelineno-7-46" name="__codelineno-7-46"></a>            <span class="n">current_revolution_start_time</span> <span class="o">=</span> <span class="n">arr_opr_zero_crossing</span><span class="p">[</span><span class="n">current_n</span><span class="p">]</span>
</span><span id="__span-7-47"><a id="__codelineno-7-47" name="__codelineno-7-47"></a>            <span class="n">current_revolution_end_time</span> <span class="o">=</span> <span class="n">arr_opr_zero_crossing</span><span class="p">[</span><span class="n">current_n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-7-48"><a id="__codelineno-7-48" name="__codelineno-7-48"></a>
</span><span id="__span-7-49"><a id="__codelineno-7-49" name="__codelineno-7-49"></a>        <span class="k">if</span> <span class="n">current_n</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_opr_zero_crossing</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="__span-7-50"><a id="__codelineno-7-50" name="__codelineno-7-50"></a>            <span class="k">break</span>
</span><span id="__span-7-51"><a id="__codelineno-7-51" name="__codelineno-7-51"></a>        <span class="c1">#(6)!</span>
</span><span id="__span-7-52"><a id="__codelineno-7-52" name="__codelineno-7-52"></a>        <span class="k">if</span> <span class="n">toa</span> <span class="o">&gt;</span> <span class="n">current_revolution_start_time</span><span class="p">:</span>
</span><span id="__span-7-53"><a id="__codelineno-7-53" name="__codelineno-7-53"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_n</span>
</span><span id="__span-7-54"><a id="__codelineno-7-54" name="__codelineno-7-54"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_revolution_start_time</span>
</span><span id="__span-7-55"><a id="__codelineno-7-55" name="__codelineno-7-55"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_revolution_end_time</span>
</span><span id="__span-7-56"><a id="__codelineno-7-56" name="__codelineno-7-56"></a>            <span class="n">Omega</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="__span-7-57"><a id="__codelineno-7-57" name="__codelineno-7-57"></a>                <span class="n">current_revolution_end_time</span> 
</span><span id="__span-7-58"><a id="__codelineno-7-58" name="__codelineno-7-58"></a>                <span class="o">-</span> <span class="n">current_revolution_start_time</span>
</span><span id="__span-7-59"><a id="__codelineno-7-59" name="__codelineno-7-59"></a>            <span class="p">)</span>
</span><span id="__span-7-60"><a id="__codelineno-7-60" name="__codelineno-7-60"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Omega</span>
</span><span id="__span-7-61"><a id="__codelineno-7-61" name="__codelineno-7-61"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">toa</span>
</span><span id="__span-7-62"><a id="__codelineno-7-62" name="__codelineno-7-62"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">Omega</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="__span-7-63"><a id="__codelineno-7-63" name="__codelineno-7-63"></a>                <span class="n">toa</span> 
</span><span id="__span-7-64"><a id="__codelineno-7-64" name="__codelineno-7-64"></a>                <span class="o">-</span> <span class="n">current_revolution_start_time</span>
</span><span id="__span-7-65"><a id="__codelineno-7-65" name="__codelineno-7-65"></a>            <span class="p">)</span>
</span><span id="__span-7-66"><a id="__codelineno-7-66" name="__codelineno-7-66"></a>    <span class="c1">#(7)!</span>
</span><span id="__span-7-67"><a id="__codelineno-7-67" name="__codelineno-7-67"></a>    <span class="k">return</span> <span class="n">AoA_matrix</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>
<p><h3> Imports </h3></p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">numba</span><span class="w"> </span><span class="kn">import</span> <span class="n">njit</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span></code></pre></div></td></tr></table></div>
<p>There are two imports:</p>
<ol>
<li>
<p><code>njit</code> from the <code>numba</code> library. <code>njit</code> instructs <code>numba</code> to compile the function to machine code.</p>
</li>
<li>
<p><code>numpy</code>. We rename as <code>np</code>. This means we can access the Numpy library through <code>np</code>. This is a common convention. Numpy is a numerical computation library. </p>
</li>
</ol>
</li>
<li>
<p><h3> Function definition </h3></p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span>
<span class="normal"><a href="#__codelineno-9-7">7</a></span>
<span class="normal"><a href="#__codelineno-9-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="nd">@njit</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_aoa</span><span class="p">(</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a>    <span class="n">arr_opr_zero_crossing</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7"></a>    <span class="n">arr_probe_toas</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="p">):</span>
</span></code></pre></div></td></tr></table></div>
<p>In Python, you define a function with the <code>def</code> keyword. We define a function called <code>calculate_aoa</code> in Line 5. This function has two arguments (an argument is a fancy word for an input):</p>
<ol>
<li>
<p><code>arr_opr_zero_crossing</code> : the array of OPR zero-crossing times.</p>
</li>
<li>
<p><code>arr_probe_toas</code>: the array of ToAs from a single probe.</p>
</li>
</ol>
</li>
<li>
<p><h3> Initialize the AoA matrix and other variables </h3> 
    <div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-31">31</a></span>
<span class="normal"><a href="#__codelineno-10-32">32</a></span>
<span class="normal"><a href="#__codelineno-10-33">33</a></span>
<span class="normal"><a href="#__codelineno-10-34">34</a></span>
<span class="normal"><a href="#__codelineno-10-35">35</a></span>
<span class="normal"><a href="#__codelineno-10-36">36</a></span>
<span class="normal"><a href="#__codelineno-10-37">37</a></span>
<span class="normal"><a href="#__codelineno-10-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31"></a><span class="n">num_toas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr_probe_toas</span><span class="p">)</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32"></a><span class="n">AoA_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">num_toas</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="p">)</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33"></a>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34"></a><span class="n">AoA_matrix</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35"></a>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36"></a><span class="n">current_revolution_start_time</span> <span class="o">=</span> <span class="n">arr_opr_zero_crossing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37"></a><span class="n">current_revolution_end_time</span> <span class="o">=</span> <span class="n">arr_opr_zero_crossing</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38"></a><span class="n">current_n</span> <span class="o">=</span> <span class="mi">0</span>
</span></code></pre></div></td></tr></table></div></p>
<p>Here we initialize constants and variables required in the rest of the function: </p>
<ul>
<li>
<p>In Line 31, we calculate the number of ToAs in <code>arr_probe_toas</code>. We need this length to initialize the output matrix. </p>
</li>
<li>
<p>In Line 32 we instantiate the output matrix. The output matrix will contain the algorithm's results. This matrix is called <code>AoA_matrix</code>. The AoA matrix is a (<code>num_toas</code> <span class="arithmatex">\(\times\)</span> 6) matrix. Its columns represent:</p>
<ul>
<li><strong>column 1</strong>: The revolution number within which each ToA falls</li>
<li><strong>column 2</strong>: The start time of the revolution</li>
<li><strong>column 3</strong>: The end time of the revolution</li>
<li><strong>column 4</strong>: The angular velocity of the shaft within the revolution</li>
<li><strong>column 5</strong>: The ToA</li>
<li><strong>column 6</strong>: The AoA of the ToA</li>
</ul>
</li>
<li>
<p>In Line 34 we set the entire revolution number column to -1. We use -1 to flag the ToAs that could not be converted to AoAs.</p>
</li>
<li>
<p>In Line 36-38 we introduce the concept of the <em>current revolution</em>. Since this is a sequential function, we process each shaft revolution in turn. <code>current_n</code> is the revolution number the ToAs are currently in, <code>current_revolution_start_time</code> and <code>current_revolution_end_time</code>  is the start and end zero-crossing times of the current revolution. </p>
</li>
</ul>
<p>These "current" values are updated as we iterate through the ToAs.</p>
</li>
<li>
<p><h3> Master loop </h3></p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40"></a><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">toa</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arr_probe_toas</span><span class="p">):</span>
</span></code></pre></div></td></tr></table></div>
<p>This <code>for</code> loop iterates through each ToA in <code>arr_probe_toas</code>. The counter, <code>i</code>, starts at <code>0</code>- corresponding to the first ToA value - and increments after each iteration. The variable <code>toa</code> is the current ToA value being considered.</p>
</li>
<li>
<p><h3> Search for the correct shaft revolution </h3></p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-42">42</a></span>
<span class="normal"><a href="#__codelineno-12-43">43</a></span>
<span class="normal"><a href="#__codelineno-12-44">44</a></span>
<span class="normal"><a href="#__codelineno-12-45">45</a></span>
<span class="normal"><a href="#__codelineno-12-46">46</a></span>
<span class="normal"><a href="#__codelineno-12-47">47</a></span>
<span class="normal"><a href="#__codelineno-12-48">48</a></span>
<span class="normal"><a href="#__codelineno-12-49">49</a></span>
<span class="normal"><a href="#__codelineno-12-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42"></a><span class="k">while</span> <span class="n">toa</span> <span class="o">&gt;</span> <span class="n">current_revolution_end_time</span><span class="p">:</span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43"></a>    <span class="n">current_n</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44"></a>    <span class="k">if</span> <span class="n">current_n</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_opr_zero_crossing</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45"></a>        <span class="k">break</span>
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46"></a>    <span class="n">current_revolution_start_time</span> <span class="o">=</span> <span class="n">arr_opr_zero_crossing</span><span class="p">[</span><span class="n">current_n</span><span class="p">]</span>
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47"></a>    <span class="n">current_revolution_end_time</span> <span class="o">=</span> <span class="n">arr_opr_zero_crossing</span><span class="p">[</span><span class="n">current_n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48"></a>
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49"></a><span class="k">if</span> <span class="n">current_n</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_opr_zero_crossing</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50"></a>    <span class="k">break</span>
</span></code></pre></div></td></tr></table></div>
<p>Here we find the shaft revolution within which the current ToA occurs. It repeatedly checks, in Line 42, if the current ToA is larger than the current revolution's end time. If it is, the shaft has completed a revolution since the previous ToA. We therefore increment the current revolution (<code>current_n</code>) variable. We also update the current revolution's start and end times in lines 46 and 47.</p>
<p>The statements in Lines 44 and 49 checks whether we have iterated over all the zero-crossing times. If this happens, our algorithm cannot perform any more comparisons. We therefore break out of the loop.</p>
</li>
<li>
<p><h3> Calculate the AoA matrix values for each ToA </h3></p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-52">52</a></span>
<span class="normal"><a href="#__codelineno-13-53">53</a></span>
<span class="normal"><a href="#__codelineno-13-54">54</a></span>
<span class="normal"><a href="#__codelineno-13-55">55</a></span>
<span class="normal"><a href="#__codelineno-13-56">56</a></span>
<span class="normal"><a href="#__codelineno-13-57">57</a></span>
<span class="normal"><a href="#__codelineno-13-58">58</a></span>
<span class="normal"><a href="#__codelineno-13-59">59</a></span>
<span class="normal"><a href="#__codelineno-13-60">60</a></span>
<span class="normal"><a href="#__codelineno-13-61">61</a></span>
<span class="normal"><a href="#__codelineno-13-62">62</a></span>
<span class="normal"><a href="#__codelineno-13-63">63</a></span>
<span class="normal"><a href="#__codelineno-13-64">64</a></span>
<span class="normal"><a href="#__codelineno-13-65">65</a></span>
<span class="normal"><a href="#__codelineno-13-66">66</a></span>
<span class="normal"><a href="#__codelineno-13-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-52"><a id="__codelineno-13-52" name="__codelineno-13-52"></a><span class="k">if</span> <span class="n">toa</span> <span class="o">&gt;</span> <span class="n">current_revolution_start_time</span><span class="p">:</span>
</span><span id="__span-13-53"><a id="__codelineno-13-53" name="__codelineno-13-53"></a>    <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_n</span>
</span><span id="__span-13-54"><a id="__codelineno-13-54" name="__codelineno-13-54"></a>    <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_revolution_start_time</span>
</span><span id="__span-13-55"><a id="__codelineno-13-55" name="__codelineno-13-55"></a>    <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_revolution_end_time</span>
</span><span id="__span-13-56"><a id="__codelineno-13-56" name="__codelineno-13-56"></a>    <span class="n">Omega</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="__span-13-57"><a id="__codelineno-13-57" name="__codelineno-13-57"></a>        <span class="n">current_revolution_end_time</span> 
</span><span id="__span-13-58"><a id="__codelineno-13-58" name="__codelineno-13-58"></a>        <span class="o">-</span> <span class="n">current_revolution_start_time</span>
</span><span id="__span-13-59"><a id="__codelineno-13-59" name="__codelineno-13-59"></a>    <span class="p">)</span>
</span><span id="__span-13-60"><a id="__codelineno-13-60" name="__codelineno-13-60"></a>    <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Omega</span>
</span><span id="__span-13-61"><a id="__codelineno-13-61" name="__codelineno-13-61"></a>    <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">toa</span>
</span><span id="__span-13-62"><a id="__codelineno-13-62" name="__codelineno-13-62"></a>    <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">Omega</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="__span-13-63"><a id="__codelineno-13-63" name="__codelineno-13-63"></a>        <span class="n">toa</span> 
</span><span id="__span-13-64"><a id="__codelineno-13-64" name="__codelineno-13-64"></a>        <span class="o">-</span> <span class="n">current_revolution_start_time</span>
</span><span id="__span-13-65"><a id="__codelineno-13-65" name="__codelineno-13-65"></a>    <span class="p">)</span>
</span><span id="__span-13-66"><a id="__codelineno-13-66" name="__codelineno-13-66"></a>
</span><span id="__span-13-67"><a id="__codelineno-13-67" name="__codelineno-13-67"></a><span class="k">return</span> <span class="n">AoA_matrix</span>
</span></code></pre></div></td></tr></table></div>
<p>This is where we calculate the AoAs. In Line 52 we check whether the current ToA is larger than the current revolution's start time. If this test is passed, it means this ToA falls within the <code>current_n</code>th revolution. We assign the current revolution's start and end time to the AoA matrix in lines 53 - 55.</p>
<p>In lines 56 - 65 the shaft speed and AoA as defined in <a href="#equation_01">Equation 1</a> and <a href="#equation_02">Equation 2</a> are calculated.</p>
</li>
<li>
<p>When we reach Line 67, it means we have either iterated over all ToAs, or we have reached the end of the encoder's timestamps. </p>
<p>The output matrix is returned.</p>
</li>
</ol>
<h2 id="example-usage">Example usage</h2>
<p>We'll use some real experimental data to test this function. We use a shaft run-up and run-down from Du Toit et al. (Du Toit et al., 2019)<sup id="fnref:du2019stochastic"><a class="footnote-ref" href="#fn:du2019stochastic">1</a></sup>. In the experiment, a five blade rotor was run-up and run-down, as already indicated in <a href="#figure_03">Figure 3</a>. Four eddy current probes were used to measure the ToAs. </p>
<p>The ToAs have already been extracted in this dataset. </p>
<p>We use only one probe's data for this example:</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="n">dataset</span> <span class="o">=</span> <span class="n">Datasets</span><span class="p">[</span><span class="s2">&quot;data/intro_to_btt/intro_to_btt_ch03&quot;</span><span class="p">]</span> <span class="c1">#(1)!</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="n">df_opr_zero_crossings</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3"></a>    <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;table/du_toit_2017_test_1_opr_zero_crossings&#39;</span><span class="p">]</span> <span class="c1">#(2)!</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="p">)</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5"></a>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="n">df_probe_toas</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;table/du_toit_2017_test_1_prox_1_toas&#39;</span><span class="p">]</span> <span class="c1">#(3)!</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="n">AoA_matrix</span> <span class="o">=</span> <span class="n">calculate_aoa</span><span class="p">(</span><span class="c1">#(4)!</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8"></a>    <span class="n">df_opr_zero_crossings</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9"></a>    <span class="n">df_probe_toas</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="p">)</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="n">df_AoA</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="c1">#(5)!</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12"></a>    <span class="n">AoA_matrix</span><span class="p">,</span> 
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13"></a>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14"></a>        <span class="s2">&quot;n&quot;</span><span class="p">,</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15"></a>        <span class="s2">&quot;n_start_time&quot;</span><span class="p">,</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16"></a>        <span class="s2">&quot;n_end_time&quot;</span><span class="p">,</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17"></a>        <span class="s2">&quot;Omega&quot;</span><span class="p">,</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18"></a>        <span class="s2">&quot;ToA&quot;</span><span class="p">,</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19"></a>        <span class="s2">&quot;AoA&quot;</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20"></a>    <span class="p">]</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>Download the data from Bladesight's repository. The dataset comprises 6 measurements. Each test has one set of OPR zero-crossing times and four sets of ToAs. There is also a set of MPR values not used in this chapter.</li>
<li>Load the OPR zero-crossing times from Test 1 as a Pandas DataFrame.</li>
<li>Load the first proximity probe's ToAs from Test 1 as a Pandas DataFrame.</li>
<li>Call the <code>calculate_aoa</code> function with the OPR zero-crossing times and the ToAs as inputs. Note we convert the Pandas columns to Numpy arrays with <code>.to_numpy()</code></li>
<li>The algorithm returns a matrix. Numpy matrices and arrays do not have column names. Here we convert the matrix into a DataFrame. DataFrames are much simpler to work with.</li>
</ol>
<p>The first 10 rows of the AoA DataFrame are presented in <a href="#table_01">Table 1</a> below.</p>
<figure>
<figcaption><strong><a name='table_01'>Table 1</a></strong>: The first 10 rows of the AoA DataFrame. </figcaption>
</figure>
<table>
<thead>
<tr>
<th style="text-align: right;">n</th>
<th style="text-align: right;">n_start_time</th>
<th style="text-align: right;">n_end_time</th>
<th style="text-align: right;">Omega</th>
<th style="text-align: right;">ToA</th>
<th style="text-align: right;">AoA</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0269571</td>
<td style="text-align: right;">0.0897037</td>
<td style="text-align: right;">100.136</td>
<td style="text-align: right;">0.0297463</td>
<td style="text-align: right;">0.279297</td>
</tr>
<tr>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0269571</td>
<td style="text-align: right;">0.0897037</td>
<td style="text-align: right;">100.136</td>
<td style="text-align: right;">0.042336</td>
<td style="text-align: right;">1.53997</td>
</tr>
<tr>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0269571</td>
<td style="text-align: right;">0.0897037</td>
<td style="text-align: right;">100.136</td>
<td style="text-align: right;">0.05479</td>
<td style="text-align: right;">2.78707</td>
</tr>
<tr>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0269571</td>
<td style="text-align: right;">0.0897037</td>
<td style="text-align: right;">100.136</td>
<td style="text-align: right;">0.0673586</td>
<td style="text-align: right;">4.04564</td>
</tr>
<tr>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0269571</td>
<td style="text-align: right;">0.0897037</td>
<td style="text-align: right;">100.136</td>
<td style="text-align: right;">0.079938</td>
<td style="text-align: right;">5.30528</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0897037</td>
<td style="text-align: right;">0.152247</td>
<td style="text-align: right;">100.462</td>
<td style="text-align: right;">0.0924866</td>
<td style="text-align: right;">0.279575</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0897037</td>
<td style="text-align: right;">0.152247</td>
<td style="text-align: right;">100.462</td>
<td style="text-align: right;">0.105059</td>
<td style="text-align: right;">1.54262</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0897037</td>
<td style="text-align: right;">0.152247</td>
<td style="text-align: right;">100.462</td>
<td style="text-align: right;">0.117489</td>
<td style="text-align: right;">2.79133</td>
</tr>
</tbody>
</table>
<div class='review' data-author='Mirosław Witoś' data-innerhtml="<p>Table 1. omits measurement results below 100,136 rpm (a step change from 0 to 100,136 with a further very slow step change in speed), even though the eddy current sensor allows measurement from zero speed. I suggest adding an explanation about the accepted maximum permissible time between pulses.</p></p>" >
</div>

<p>We note two observations:</p>
<ul>
<li>The first two rows have <code>n</code> values of -1. This means the first two ToAs were recorded <em>before</em> the first zero-crossing time. We can therefore not calculate the AoAs for these ToAs. You'll find a couple of these values at the end of the DataFrame as well.</li>
<li>The <code>AoA</code> values repeat themselves every 5 rows. This is because the rotor has 5 blades.</li>
</ul>
<p>We drop the ToAs we could not convert to AoAs. These values are identified where <code>n</code> equals -1.</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="n">df_AoA</span> <span class="o">=</span> <span class="n">df_AoA</span><span class="p">[</span><span class="n">df_AoA</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="n">df_AoA</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#(1)!</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>Because we dropped the first two rows of data, the DataFrame's index starts at 2. It's always best to reset the index after dropping rows, unless the index contains important information.</li>
</ol>
<p>In <a href="#figure_04">Figure 4</a> below, we present a plot of the AoAs for the first blade over all revolutions. We also plot the angular velocity on a secondary y-axis.</p>
<script src="blade_1_aoas.js" > </script>
<div>
    <div>
        <canvas id="ch03_blade_1_aoas"'></canvas>
    </div>
    <script>
        async function render_chart_blade_1_aoas() {
            const ctx = document.getElementById('ch03_blade_1_aoas');
            // If this is a mobile device, set the canvas height to 400
            if (window.innerWidth < 500) {
                ctx.height = 400;
            }
            while (typeof Chart == "undefined") {
                await new Promise(r => setTimeout(r, 1000));
            }
            Chart.defaults.font.family = "Literata, -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif";
            window.fig_blade_1_aoas = new Chart(ctx, window.blade_1_aoas);
            window.fig_blade_1_aoas_reset = function resetZoomFig2() {
                    window.fig_blade_1_aoas.resetZoom();
                }
            }
        render_chart_blade_1_aoas();
    </script>
    <a onclick="window.fig_blade_1_aoas_reset()" class='md-button'>Reset Zoom</a>
</div>
<figure>
<figcaption><strong><a name='figure_04'>Figure 4</a></strong>: The AoAs of the first blade at the first proximity probe. </figcaption>
</figure>
<p>In <a href="#figure_04">Figure 4</a> above, the AoAs are not constant. Why not? In a sense, the entire discipline of BTT is about understanding what causes the AoAs to change.</p>
<p>We briefly discuss six topics that may be responsible for the AoAs to change:</p>
<h2 id="discussion">Discussion</h2>
<h3 id="sensor-limited-bandwidth-noise">Sensor limited bandwidth noise</h3>
<p>The drift in <a href="#figure_04">Figure 4</a> appears to be correlated to the rotor's angular velocity. In other words, as the shaft speeds up, the AoAs increase proportionally to the rotational speed. The moment the rotor starts to run down, the AoAs decrease. </p>
<p>This is <em>not</em> related to blade vibration. This is related to the bandwidth of the sensor you are using. Any sensor has a limited frequency response. As the tips move faster, their presence inside your sensor's field of view become shorter. This causes the input function experienced by the sensor to contain more energy at higher frequencies.</p>
<p>If your sensor's bandwidth is limited, it cuts out these high frequency components. This results in lower amplitude pulses. A lower amplitude pulse will manifest itself as delayed ToA triggering, and hence a larger AoA value.</p>
<p>This is not a problem, though, because our resonance events occur at higher frequencies than this phenomenon. In later chapters, we remove this noise with a detrending algorithm.</p>
<h3 id="blade-vibration">Blade vibration</h3>
<p>There are four clear resonance events in this signal. They occur at 7.5, 17.83, 24.3, and 34.5 seconds respectively. We delve into the theory of resonance in Chapter 7. For now, we highlight there are just <em>two unique</em> resonances. The two resonances occur at 1087 RPM and 1275 RPM on both the run-up and the run-down.</p>
<h3 id="high-frequency-noise">High frequency noise</h3>
<p>The signal also contains high-frequency random noise. It has many possible causes such as electrical noise, shaft torsional vibration, casing vibration, or higher frequency blade vibration. This noise may be filtered out. You can also construct your inference algorithms to handle them. </p>
<h3 id="non-constant-shaft-speed">Non-Constant shaft speed</h3>
<p>In <a href="#equation_01">Equation 1</a> we assumed the rotor's speed was constant within a revolution. This assumption, though not strictly correct, simplifies our processing and often incurs acceptably small errors. If you're interested in the effect of non-constant shaft speed on the AoAs, you can read about it here (Diamond et al., 2019)<sup id="fnref:diamond2019improved"><a class="footnote-ref" href="#fn:diamond2019improved">2</a></sup>.</p>
<h3 id="untwist-and-centrifugal-stiffening">Untwist and centrifugal stiffening</h3>
<p>As the rotor speeds up, the blades are subjected to increased centrifugal force. Most blade designs react to the centrifugal force by twisting. The twisting of the blade causes the AoA to change, because the blade's tip is now in a different static position.</p>
<p>You need to understand your blade's design to understand how it reacts to centrifugal forces.</p>
<h3 id="increased-pressure-on-blades">Increased pressure on blades</h3>
<p>Increased rotor speed will cause increased fluid pressure on the blades. This will result in a static deflection of the blade. This deflection will cause the AoA to change. How much the AoA changes depends on the blade's stiffness and the fluid pressure.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In this chapter, we have converted ToAs to AoAs. We are now firmly positioned in the distance domain, where we can reason about deflection, not time. At this stage we have not used any information about the rotor's characteristics. In the next chapter, we start to make the analysis specific to our rotor. We use the blade count to allocate the AoAs to the correct blades. </p>
<div class="admonition success">
<p class="admonition-title">Outcomes</p>
<p><span class="twemoji checkbox-success heart"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10 17-5-5 1.41-1.42L10 14.17l7.59-7.59L19 8m0-5H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"/></svg></span> Understand we use a shaft encoder to calculate the shaft speed, <span class="arithmatex">\(\Omega\)</span>, and the start and end of each revolution. </p>
<p><span class="twemoji checkbox-success heart"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10 17-5-5 1.41-1.42L10 14.17l7.59-7.59L19 8m0-5H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"/></svg></span> Understand we need to find the revolution in which each ToA occurs.</p>
<p><span class="twemoji checkbox-success heart"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10 17-5-5 1.41-1.42L10 14.17l7.59-7.59L19 8m0-5H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"/></svg></span> Understand each ToA is used to calculate the precise shaft circumferential displacement in said revolution. This is the AoA of each ToA.</p>
<p><span class="twemoji checkbox-success heart"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10 17-5-5 1.41-1.42L10 14.17l7.59-7.59L19 8m0-5H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"/></svg></span> Write a function that calculates a matrix of AoAs from the shaft encoder zero-crossing times and the ToAs.</p>
</div>
<mark class="critic block">
<p>I present coding exercises 👇 to solidify your the concepts covered in this chapter. </p>
</mark>
<h2 id="acknowledgements">Acknowledgements</h2>
<p>Thanks to <a href="https://www.linkedin.com/in/justin-s-507338116/" target="_blank">Justin Smith</a> and <a href="https://www.linkedin.com/in/alex-brocco-70218b25b/" target="_blank">Alex Brocco</a> for reviewing this chapter and providing feedback.</p>
<p>A special thanks to <a href="https://www.researchgate.net/profile/Miroslaw-Witos-2" target="_blank">Mirosław Witoś</a> for his detailed review of this chapter.</p>
<div style='display:flex'>
    <div>
        <a target="_blank" href="https://www.bladesight.com" class="" title="Dawie Diamond" style="border-radius:100%;"> 
            <img src="https://github.com/Bladesight.png?size=300" alt="Dawie Diamond" style="
            border-radius: 100%;
            width: 4.0rem;
        ">
        </a>
    </div>
    <div style='margin-left:2rem'>
        <p>
            <strong>Dawie Diamond</strong>
        </p>
        <p>
            <span class="md-icon blog-timestamp-span" title="Created"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>2024-02-13</span>

            <span class="md-icon blog-timestamp-span" title="Last update"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>2025-02-17
            </span>
        </p>
    </div>
</div>

<h2 id="coding-exercises"><span class="twemoji checkbox-success"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 5c-1.11 0-2 .89-2 2s.89 2 2 2 2-.89 2-2-.89-2-2-2m10-4v5h-2V4H4v2H2V1h2v2h16V1zm-7 10.26V23h-2v-5h-2v5H9V11.26C6.93 10.17 5.5 8 5.5 5.5V5h2v.5C7.5 8 9.5 10 12 10s4.5-2 4.5-4.5V5h2v.5c0 2.5-1.43 4.67-3.5 5.76"/></svg></span> Coding Exercises</h2>
<p>Here are some coding exercises to solidify the concepts we've covered in this chapter.</p>
<h3 id="problem-1">Problem 1 <img alt="🥱" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f971.svg" title=":yawning_face:" /></h3>
<p>In this chapter, we've written the <code>calculate_aoa</code> function. This function receives and returns Numpy arrays, though we work with Pandas DataFrames natively. We therefore needed to use the <code>.to_numpy()</code> method to convert the Pandas objects to numpy arrays. We also needed to cast the resulting matrix into a Pandas DataFrame, and drop the ToAs we could not convert to AoAs. </p>
<p>In future, we do not want to do this every time we call the function.</p>
<mark class="critic block">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.1 9 .9.9L5.9 19H5v-.9zm3.6-6c-.2 0-.5.1-.7.3l-1.8 1.8 3.7 3.8L20.7 7c.4-.4.4-1 0-1.4l-2.3-2.3c-.2-.2-.5-.3-.7-.3m-3.6 3.2L3 17.2V21h3.8l11-11.1zM7 2v3h3v2H7v3H5V7H2V5h3V2z"/></svg></span> Write a new function, called <code>transform_ToAs_to_AoAs</code>, accepting Pandas DataFrames as inputs and returning a Pandas DataFrame as output. The function should call the <code>calculate_aoa</code> function to do the actual work.</p>
</mark>
<details class="example">
<summary>Reveal answer (Please try it yourself before revealing the solution)</summary>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span>
<span class="normal"><a href="#__codelineno-16-22">22</a></span>
<span class="normal"><a href="#__codelineno-16-23">23</a></span>
<span class="normal"><a href="#__codelineno-16-24">24</a></span>
<span class="normal"><a href="#__codelineno-16-25">25</a></span>
<span class="normal"><a href="#__codelineno-16-26">26</a></span>
<span class="normal"><a href="#__codelineno-16-27">27</a></span>
<span class="normal"><a href="#__codelineno-16-28">28</a></span>
<span class="normal"><a href="#__codelineno-16-29">29</a></span>
<span class="normal"><a href="#__codelineno-16-30">30</a></span>
<span class="normal"><a href="#__codelineno-16-31">31</a></span>
<span class="normal"><a href="#__codelineno-16-32">32</a></span>
<span class="normal"><a href="#__codelineno-16-33">33</a></span>
<span class="normal"><a href="#__codelineno-16-34">34</a></span>
<span class="normal"><a href="#__codelineno-16-35">35</a></span>
<span class="normal"><a href="#__codelineno-16-36">36</a></span>
<span class="normal"><a href="#__codelineno-16-37">37</a></span>
<span class="normal"><a href="#__codelineno-16-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">transform_ToAs_to_AoAs</span><span class="p">(</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a>    <span class="n">df_opr_zero_crossings</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3"></a>    <span class="n">df_probe_toas</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; This function transforms the ToA values to AoA values for a </span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="sd">    single probe, given the OPR zero-crossing times and the proximity</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="sd">    probe&#39;s ToA values.</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8"></a>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="sd">    The timestamps are assumed to reside in the first column of</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="sd">    each DataFrame.</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11"></a>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="sd">    Args:</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="sd">        df_opr_zero_crossings (pd.DataFrame): A DataFrame with the </span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="sd">            OPR zero-crossing times.</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="sd">        df_probe_toas (pd.DataFrame): A DataFrame with the probe&#39;s </span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="sd">            ToA values.</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17"></a>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="sd">    Returns:</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="sd">        pd.DataFrame: A DataFrame with the AoA values.</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21"></a>    <span class="n">AoA_matrix</span> <span class="o">=</span> <span class="n">calculate_aoa</span><span class="p">(</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22"></a>        <span class="n">df_opr_zero_crossings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="c1">#(1)!</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23"></a>        <span class="n">df_probe_toas</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24"></a>    <span class="p">)</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25"></a>    <span class="n">df_AoA</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26"></a>        <span class="n">AoA_matrix</span><span class="p">,</span> 
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27"></a>        <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28"></a>            <span class="s2">&quot;n&quot;</span><span class="p">,</span>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29"></a>            <span class="s2">&quot;n_start_time&quot;</span><span class="p">,</span>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30"></a>            <span class="s2">&quot;n_end_time&quot;</span><span class="p">,</span>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31"></a>            <span class="s2">&quot;Omega&quot;</span><span class="p">,</span>
</span><span id="__span-16-32"><a id="__codelineno-16-32" name="__codelineno-16-32"></a>            <span class="s2">&quot;ToA&quot;</span><span class="p">,</span>
</span><span id="__span-16-33"><a id="__codelineno-16-33" name="__codelineno-16-33"></a>            <span class="s2">&quot;AoA&quot;</span>
</span><span id="__span-16-34"><a id="__codelineno-16-34" name="__codelineno-16-34"></a>        <span class="p">]</span>
</span><span id="__span-16-35"><a id="__codelineno-16-35" name="__codelineno-16-35"></a>    <span class="p">)</span>
</span><span id="__span-16-36"><a id="__codelineno-16-36" name="__codelineno-16-36"></a>    <span class="n">df_AoA</span> <span class="o">=</span> <span class="n">df_AoA</span><span class="p">[</span><span class="n">df_AoA</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-16-37"><a id="__codelineno-16-37" name="__codelineno-16-37"></a>    <span class="n">df_AoA</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-16-38"><a id="__codelineno-16-38" name="__codelineno-16-38"></a>    <span class="k">return</span> <span class="n">df_AoA</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>We may want to pass in DataFrames with different column names than the ones we used in the example. We therefore use the <code>.iloc</code> method to get the first column of each DataFrame, regardless of what it is called.</li>
</ol>
<p>Example usage:
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span>
<span class="normal"><a href="#__codelineno-17-5">5</a></span>
<span class="normal"><a href="#__codelineno-17-6">6</a></span>
<span class="normal"><a href="#__codelineno-17-7">7</a></span>
<span class="normal"><a href="#__codelineno-17-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">Datasets</span><span class="p">[</span><span class="s2">&quot;data/intro_to_btt/intro_to_btt_ch03&quot;</span><span class="p">]</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">df_opr_zero_crossings</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;table/du_toit_2017_test_1_opr_zero_crossings&#39;</span><span class="p">]</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">df_probe_toas</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;table/du_toit_2017_test_1_prox_1_toas&#39;</span><span class="p">]</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">df_AoA</span> <span class="o">=</span> <span class="n">transform_ToAs_to_AoAs</span><span class="p">(</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6"></a>    <span class="n">df_opr_zero_crossings</span><span class="p">,</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7"></a>    <span class="n">df_probe_toas</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div></p>
</details>
<h3 id="problem-2">Problem 2 <img alt="😐" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f610.svg" title=":neutral_face:" /></h3>
<p>Because our Python functions are converted to C, one is tempted to treat code inefficiencies with a wink and a wry smile, as one does with a child that does something naughty you are secretly proud of.</p>
<p>We must, however, resist this temptation. We must always strive to write efficient code. </p>
<mark class="critic block">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.1 9 .9.9L5.9 19H5v-.9zm3.6-6c-.2 0-.5.1-.7.3l-1.8 1.8 3.7 3.8L20.7 7c.4-.4.4-1 0-1.4l-2.3-2.3c-.2-.2-.5-.3-.7-.3m-3.6 3.2L3 17.2V21h3.8l11-11.1zM7 2v3h3v2H7v3H5V7H2V5h3V2z"/></svg></span> There are unnecessary calculations in the <code>calculate_aoa</code> function. Can you spot where? Rewrite the function to remove this inefficiency.</p>
</mark>
<details class="example">
<summary>Reveal answer (Please try it yourself before revealing the solution)</summary>
<p><div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span>
<span class="normal"><a href="#__codelineno-18-23">23</a></span>
<span class="normal"><a href="#__codelineno-18-24">24</a></span>
<span class="normal"><a href="#__codelineno-18-25">25</a></span>
<span class="normal"><a href="#__codelineno-18-26">26</a></span>
<span class="normal"><a href="#__codelineno-18-27">27</a></span>
<span class="normal"><a href="#__codelineno-18-28">28</a></span>
<span class="normal"><a href="#__codelineno-18-29">29</a></span>
<span class="normal"><a href="#__codelineno-18-30">30</a></span>
<span class="normal"><a href="#__codelineno-18-31">31</a></span>
<span class="normal"><a href="#__codelineno-18-32">32</a></span>
<span class="normal"><a href="#__codelineno-18-33">33</a></span>
<span class="normal"><a href="#__codelineno-18-34">34</a></span>
<span class="normal"><a href="#__codelineno-18-35">35</a></span>
<span class="normal"><a href="#__codelineno-18-36">36</a></span>
<span class="normal"><a href="#__codelineno-18-37">37</a></span>
<span class="normal"><a href="#__codelineno-18-38">38</a></span>
<span class="normal"><a href="#__codelineno-18-39">39</a></span>
<span class="normal"><a href="#__codelineno-18-40">40</a></span>
<span class="normal"><a href="#__codelineno-18-41">41</a></span>
<span class="normal"><a href="#__codelineno-18-42">42</a></span>
<span class="normal"><a href="#__codelineno-18-43">43</a></span>
<span class="normal"><a href="#__codelineno-18-44">44</a></span>
<span class="normal"><a href="#__codelineno-18-45">45</a></span>
<span class="normal"><a href="#__codelineno-18-46">46</a></span>
<span class="normal"><a href="#__codelineno-18-47">47</a></span>
<span class="normal"><a href="#__codelineno-18-48">48</a></span>
<span class="normal"><a href="#__codelineno-18-49">49</a></span>
<span class="normal"><a href="#__codelineno-18-50">50</a></span>
<span class="normal"><a href="#__codelineno-18-51">51</a></span>
<span class="normal"><a href="#__codelineno-18-52">52</a></span>
<span class="normal"><a href="#__codelineno-18-53">53</a></span>
<span class="normal"><a href="#__codelineno-18-54">54</a></span>
<span class="normal"><a href="#__codelineno-18-55">55</a></span>
<span class="normal"><a href="#__codelineno-18-56">56</a></span>
<span class="normal"><a href="#__codelineno-18-57">57</a></span>
<span class="normal"><a href="#__codelineno-18-58">58</a></span>
<span class="normal"><a href="#__codelineno-18-59">59</a></span>
<span class="normal"><a href="#__codelineno-18-60">60</a></span>
<span class="normal"><a href="#__codelineno-18-61">61</a></span>
<span class="normal"><a href="#__codelineno-18-62">62</a></span>
<span class="normal"><a href="#__codelineno-18-63">63</a></span>
<span class="normal"><a href="#__codelineno-18-64">64</a></span>
<span class="normal"><a href="#__codelineno-18-65">65</a></span>
<span class="normal"><a href="#__codelineno-18-66">66</a></span>
<span class="normal"><a href="#__codelineno-18-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="nd">@njit</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_aoa</span><span class="p">(</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a>    <span class="n">arr_opr_zero_crossing</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4"></a>    <span class="n">arr_probe_toas</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="p">):</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="sd">    This function calculates the angle of arrival of </span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="sd">    each ToA value relative to the revolution in </span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="sd">    which it occurs.</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10"></a>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="sd">    Args:</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="sd">        arr_opr_zero_crossing (np.array): An array of </span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="sd">            OPR zero-crossing times. </span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="sd">        arr_probe_toas (np.array): An array of </span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="sd">            ToA values.</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16"></a>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="sd">    Returns:</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18"></a><span class="sd">        np.array: A matrix of AoA values. Each row in the </span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19"></a><span class="sd">            matrix corresponds to a ToA value. The columns </span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20"></a><span class="sd">            are:</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21"></a><span class="sd">            0: The revolution number</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22"></a><span class="sd">            1: The zero-crossing time at the start of the revolution</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23"></a><span class="sd">            2: The zero-crossing time at the end of the revolution</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24"></a><span class="sd">            3: The angular velocity of the revolution</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25"></a><span class="sd">            4: The ToA</span>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26"></a><span class="sd">            5: The AoA of the ToA value</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28"></a>    <span class="n">num_toas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr_probe_toas</span><span class="p">)</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29"></a>    <span class="n">AoA_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">num_toas</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30"></a>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31"></a>    <span class="n">AoA_matrix</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32"></a>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33"></a>    <span class="n">current_revolution_start_time</span> <span class="o">=</span> <span class="n">arr_opr_zero_crossing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34"></a>    <span class="n">current_revolution_end_time</span> <span class="o">=</span> <span class="n">arr_opr_zero_crossing</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35"></a><span class="hll">    <span class="n">Omega</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span>
</span></span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36"></a><span class="hll">        <span class="n">current_revolution_end_time</span> 
</span></span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37"></a><span class="hll">        <span class="o">-</span> <span class="n">current_revolution_start_time</span>
</span></span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38"></a><span class="hll">    <span class="p">)</span>
</span></span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39"></a>    <span class="n">current_n</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40"></a>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">toa</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arr_probe_toas</span><span class="p">):</span>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42"></a>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43"></a>        <span class="k">while</span> <span class="n">toa</span> <span class="o">&gt;</span> <span class="n">current_revolution_end_time</span><span class="p">:</span>
</span><span id="__span-18-44"><a id="__codelineno-18-44" name="__codelineno-18-44"></a>            <span class="n">current_n</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-18-45"><a id="__codelineno-18-45" name="__codelineno-18-45"></a>            <span class="k">if</span> <span class="n">current_n</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_opr_zero_crossing</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="__span-18-46"><a id="__codelineno-18-46" name="__codelineno-18-46"></a>                <span class="k">break</span>
</span><span id="__span-18-47"><a id="__codelineno-18-47" name="__codelineno-18-47"></a>            <span class="n">current_revolution_start_time</span> <span class="o">=</span> <span class="n">arr_opr_zero_crossing</span><span class="p">[</span><span class="n">current_n</span><span class="p">]</span>
</span><span id="__span-18-48"><a id="__codelineno-18-48" name="__codelineno-18-48"></a>            <span class="n">current_revolution_end_time</span> <span class="o">=</span> <span class="n">arr_opr_zero_crossing</span><span class="p">[</span><span class="n">current_n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-18-49"><a id="__codelineno-18-49" name="__codelineno-18-49"></a><span class="hll">            <span class="n">Omega</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span>
</span></span><span id="__span-18-50"><a id="__codelineno-18-50" name="__codelineno-18-50"></a><span class="hll">                <span class="n">current_revolution_end_time</span> 
</span></span><span id="__span-18-51"><a id="__codelineno-18-51" name="__codelineno-18-51"></a><span class="hll">                <span class="o">-</span> <span class="n">current_revolution_start_time</span>
</span></span><span id="__span-18-52"><a id="__codelineno-18-52" name="__codelineno-18-52"></a><span class="hll">            <span class="p">)</span>
</span></span><span id="__span-18-53"><a id="__codelineno-18-53" name="__codelineno-18-53"></a>        <span class="k">if</span> <span class="n">current_n</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_opr_zero_crossing</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="__span-18-54"><a id="__codelineno-18-54" name="__codelineno-18-54"></a>            <span class="k">break</span>
</span><span id="__span-18-55"><a id="__codelineno-18-55" name="__codelineno-18-55"></a>        <span class="c1">#</span>
</span><span id="__span-18-56"><a id="__codelineno-18-56" name="__codelineno-18-56"></a>        <span class="k">if</span> <span class="n">toa</span> <span class="o">&gt;</span> <span class="n">current_revolution_start_time</span><span class="p">:</span>
</span><span id="__span-18-57"><a id="__codelineno-18-57" name="__codelineno-18-57"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_n</span>
</span><span id="__span-18-58"><a id="__codelineno-18-58" name="__codelineno-18-58"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_revolution_start_time</span>
</span><span id="__span-18-59"><a id="__codelineno-18-59" name="__codelineno-18-59"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_revolution_end_time</span>
</span><span id="__span-18-60"><a id="__codelineno-18-60" name="__codelineno-18-60"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Omega</span>
</span><span id="__span-18-61"><a id="__codelineno-18-61" name="__codelineno-18-61"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">toa</span>
</span><span id="__span-18-62"><a id="__codelineno-18-62" name="__codelineno-18-62"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">Omega</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="__span-18-63"><a id="__codelineno-18-63" name="__codelineno-18-63"></a>                <span class="n">toa</span> 
</span><span id="__span-18-64"><a id="__codelineno-18-64" name="__codelineno-18-64"></a>                <span class="o">-</span> <span class="n">current_revolution_start_time</span>
</span><span id="__span-18-65"><a id="__codelineno-18-65" name="__codelineno-18-65"></a>            <span class="p">)</span>
</span><span id="__span-18-66"><a id="__codelineno-18-66" name="__codelineno-18-66"></a>
</span><span id="__span-18-67"><a id="__codelineno-18-67" name="__codelineno-18-67"></a>    <span class="k">return</span> <span class="n">AoA_matrix</span>
</span></code></pre></div></td></tr></table></div>
We have moved the calculation of <span class="arithmatex">\(\Omega\)</span> to the while loop from the if statement at the bottom. Now, every time we update the zero-crossing times, we calculate the rotor's speed only once. The previous method calculated the shaft speed once for every ToA.</p>
</details>
<h3 id="problem-3">Problem 3 <img alt="🤔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f914.svg" title=":thinking:" /></h3>
<p>The dataset we used in this chapter also has MPR zero-crossing times we did not use. These values can be loaded with this command:</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">df_mpr_zero_crossings</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;table/du_toit_2017_test_1_mpr_zero_crossings&#39;</span><span class="p">]</span>
</span></code></pre></div>
<p>The MPR encoder used for this measurement has 79 sections. You can therefore assume each encoder section represents <span class="arithmatex">\(\frac{1}{79}\)</span>th of a rotation.</p>
<mark class="critic block">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.1 9 .9.9L5.9 19H5v-.9zm3.6-6c-.2 0-.5.1-.7.3l-1.8 1.8 3.7 3.8L20.7 7c.4-.4.4-1 0-1.4l-2.3-2.3c-.2-.2-.5-.3-.7-.3m-3.6 3.2L3 17.2V21h3.8l11-11.1zM7 2v3h3v2H7v3H5V7H2V5h3V2z"/></svg></span> Write a new function, <code>calculate_aoa_from_mpr</code>, accepting the MPR timestamps, the number of sections in the MPR, and the ToAs as inputs. The function should return a DataFrame with the AoAs. The resulting AoA matrix should also include the MPR section number within which each ToA occurs.</p>
</mark>
<script src="blade_5_aoas_using_mpr.js" > </script>
<div>
    <script>
        async function render_chart_blade_5_aoas_using_mpr() {
            const ctx = document.getElementById('ch03_blade_5_aoas_using_mpr');
            // If this is a mobile device, set the canvas height to 400
            if (window.innerWidth <500) {
                ctx.height = 400;
            }
            while (typeof Chart == "undefined") {
                await new Promise(r => setTimeout(r, 1000));
            }
            Chart.defaults.font.family = "Literata, -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif";
            window.fig_blade_5_aoas_using_mpr = new Chart(ctx, window.blade_5_aoas_using_mpr);
            window.fig_blade_5_aoas_using_mpr_reset = function resetZoomFig3() {
                    window.fig_blade_5_aoas_using_mpr.resetZoom();
                }
            }
    </script>
</div>

<details class="example">
<summary>Reveal answer (Please try it yourself before revealing the solution)</summary>
<p><div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">  1</a></span>
<span class="normal"><a href="#__codelineno-20-2">  2</a></span>
<span class="normal"><a href="#__codelineno-20-3">  3</a></span>
<span class="normal"><a href="#__codelineno-20-4">  4</a></span>
<span class="normal"><a href="#__codelineno-20-5">  5</a></span>
<span class="normal"><a href="#__codelineno-20-6">  6</a></span>
<span class="normal"><a href="#__codelineno-20-7">  7</a></span>
<span class="normal"><a href="#__codelineno-20-8">  8</a></span>
<span class="normal"><a href="#__codelineno-20-9">  9</a></span>
<span class="normal"><a href="#__codelineno-20-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-20-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-20-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-20-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-20-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-20-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-20-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-20-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-20-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-20-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-20-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-20-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-20-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-20-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-20-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-20-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-20-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-20-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-20-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-20-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-20-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-20-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-20-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-20-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-20-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-20-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-20-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-20-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-20-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-20-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-20-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-20-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-20-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-20-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-20-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-20-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-20-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-20-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-20-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-20-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-20-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-20-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-20-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-20-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-20-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-20-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-20-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-20-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-20-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-20-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-20-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-20-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-20-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-20-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-20-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-20-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-20-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-20-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-20-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-20-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-20-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-20-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-20-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-20-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-20-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-20-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-20-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-20-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-20-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-20-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-20-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-20-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-20-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-20-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-20-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-20-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-20-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-20-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-20-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-20-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-20-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-20-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-20-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-20-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-20-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-20-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-20-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-20-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-20-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-20-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-20-100">100</a></span>
<span class="normal"><a href="#__codelineno-20-101">101</a></span>
<span class="normal"><a href="#__codelineno-20-102">102</a></span>
<span class="normal"><a href="#__codelineno-20-103">103</a></span>
<span class="normal"><a href="#__codelineno-20-104">104</a></span>
<span class="normal"><a href="#__codelineno-20-105">105</a></span>
<span class="normal"><a href="#__codelineno-20-106">106</a></span>
<span class="normal"><a href="#__codelineno-20-107">107</a></span>
<span class="normal"><a href="#__codelineno-20-108">108</a></span>
<span class="normal"><a href="#__codelineno-20-109">109</a></span>
<span class="normal"><a href="#__codelineno-20-110">110</a></span>
<span class="normal"><a href="#__codelineno-20-111">111</a></span>
<span class="normal"><a href="#__codelineno-20-112">112</a></span>
<span class="normal"><a href="#__codelineno-20-113">113</a></span>
<span class="normal"><a href="#__codelineno-20-114">114</a></span>
<span class="normal"><a href="#__codelineno-20-115">115</a></span>
<span class="normal"><a href="#__codelineno-20-116">116</a></span>
<span class="normal"><a href="#__codelineno-20-117">117</a></span>
<span class="normal"><a href="#__codelineno-20-118">118</a></span>
<span class="normal"><a href="#__codelineno-20-119">119</a></span>
<span class="normal"><a href="#__codelineno-20-120">120</a></span>
<span class="normal"><a href="#__codelineno-20-121">121</a></span>
<span class="normal"><a href="#__codelineno-20-122">122</a></span>
<span class="normal"><a href="#__codelineno-20-123">123</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_aoa_from_mpr</span><span class="p">(</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2"></a>    <span class="n">arr_mpr_zero_crossing</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3"></a>    <span class="n">arr_probe_toas</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4"></a>    <span class="n">mpr_sections</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; This function calculates the angle of arrival of</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="sd">    each ToA value relative to the section and revolution in</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="sd">    which it occurs when using an MPR encoder.</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9"></a>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="sd">    Args:</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="sd">        arr_mpr_zero_crossing (np.ndarray): An array of MPR</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="sd">            zero-crossing times.</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="sd">        arr_probe_toas (np.ndarray): An array of ToA values.</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="sd">        mpr_sections (int, optional): The number of sections</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="sd">            in the MPR encoder. Defaults to 1, in this case,</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="sd">            this function will be treated as an OPR encoder.</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17"></a>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="sd">    Returns:</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="sd">        np.ndarray: A matrix of AoA values. Each row in the</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="sd">            matrix corresponds to a ToA value. The columns</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="sd">            are:</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="sd">            0: The revolution number</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="sd">            1: The section number</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24"></a><span class="sd">            2: The zero-crossing time at the start of the revolution</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25"></a><span class="sd">            3: The zero-crossing time at the end of the revolution</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26"></a><span class="sd">            4: The angular velocity of the revolution</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27"></a><span class="sd">            5: The ToA</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28"></a><span class="sd">            6: The AoA of the ToA value</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30"></a>    <span class="n">num_toas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr_probe_toas</span><span class="p">)</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31"></a>    <span class="n">AoA_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_toas</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32"></a>    <span class="n">rad_per_section</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">mpr_sections</span>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33"></a>    <span class="n">AoA_matrix</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34"></a>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35"></a>    <span class="n">current_revolution_start_time</span> <span class="o">=</span> <span class="n">arr_mpr_zero_crossing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36"></a>    <span class="n">current_revolution_end_time</span> <span class="o">=</span> <span class="n">arr_mpr_zero_crossing</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37"></a>    <span class="n">Omega</span> <span class="o">=</span> <span class="n">rad_per_section</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38"></a>        <span class="n">current_revolution_end_time</span> 
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39"></a>        <span class="o">-</span> <span class="n">current_revolution_start_time</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40"></a>    <span class="p">)</span>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41"></a>    <span class="n">current_n</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42"></a>    <span class="n">current_revo</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-20-43"><a id="__codelineno-20-43" name="__codelineno-20-43"></a>    <span class="n">current_section</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-20-44"><a id="__codelineno-20-44" name="__codelineno-20-44"></a>
</span><span id="__span-20-45"><a id="__codelineno-20-45" name="__codelineno-20-45"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">toa</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arr_probe_toas</span><span class="p">):</span>
</span><span id="__span-20-46"><a id="__codelineno-20-46" name="__codelineno-20-46"></a>
</span><span id="__span-20-47"><a id="__codelineno-20-47" name="__codelineno-20-47"></a>        <span class="k">while</span> <span class="n">toa</span> <span class="o">&gt;</span> <span class="n">current_revolution_end_time</span><span class="p">:</span>
</span><span id="__span-20-48"><a id="__codelineno-20-48" name="__codelineno-20-48"></a>            <span class="n">current_n</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-20-49"><a id="__codelineno-20-49" name="__codelineno-20-49"></a>            <span class="k">if</span> <span class="n">current_n</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_mpr_zero_crossing</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="__span-20-50"><a id="__codelineno-20-50" name="__codelineno-20-50"></a>                <span class="k">break</span>
</span><span id="__span-20-51"><a id="__codelineno-20-51" name="__codelineno-20-51"></a>            <span class="n">current_revolution_start_time</span> <span class="o">=</span> <span class="n">arr_mpr_zero_crossing</span><span class="p">[</span><span class="n">current_n</span><span class="p">]</span>
</span><span id="__span-20-52"><a id="__codelineno-20-52" name="__codelineno-20-52"></a>            <span class="n">current_revolution_end_time</span> <span class="o">=</span> <span class="n">arr_mpr_zero_crossing</span><span class="p">[</span><span class="n">current_n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-20-53"><a id="__codelineno-20-53" name="__codelineno-20-53"></a>            <span class="n">Omega</span> <span class="o">=</span> <span class="n">rad_per_section</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="__span-20-54"><a id="__codelineno-20-54" name="__codelineno-20-54"></a>                <span class="n">current_revolution_end_time</span> 
</span><span id="__span-20-55"><a id="__codelineno-20-55" name="__codelineno-20-55"></a>                <span class="o">-</span> <span class="n">current_revolution_start_time</span>
</span><span id="__span-20-56"><a id="__codelineno-20-56" name="__codelineno-20-56"></a>            <span class="p">)</span>
</span><span id="__span-20-57"><a id="__codelineno-20-57" name="__codelineno-20-57"></a>            <span class="n">current_section</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-20-58"><a id="__codelineno-20-58" name="__codelineno-20-58"></a>            <span class="k">if</span> <span class="n">current_section</span> <span class="o">==</span> <span class="n">mpr_sections</span><span class="p">:</span>
</span><span id="__span-20-59"><a id="__codelineno-20-59" name="__codelineno-20-59"></a>                <span class="n">current_section</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-20-60"><a id="__codelineno-20-60" name="__codelineno-20-60"></a>                <span class="n">current_revo</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-20-61"><a id="__codelineno-20-61" name="__codelineno-20-61"></a>
</span><span id="__span-20-62"><a id="__codelineno-20-62" name="__codelineno-20-62"></a>
</span><span id="__span-20-63"><a id="__codelineno-20-63" name="__codelineno-20-63"></a>        <span class="k">if</span> <span class="n">current_n</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_mpr_zero_crossing</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="__span-20-64"><a id="__codelineno-20-64" name="__codelineno-20-64"></a>            <span class="k">break</span>
</span><span id="__span-20-65"><a id="__codelineno-20-65" name="__codelineno-20-65"></a>
</span><span id="__span-20-66"><a id="__codelineno-20-66" name="__codelineno-20-66"></a>        <span class="k">if</span> <span class="n">toa</span> <span class="o">&gt;</span> <span class="n">current_revolution_start_time</span><span class="p">:</span>
</span><span id="__span-20-67"><a id="__codelineno-20-67" name="__codelineno-20-67"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_revo</span>
</span><span id="__span-20-68"><a id="__codelineno-20-68" name="__codelineno-20-68"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_section</span>
</span><span id="__span-20-69"><a id="__codelineno-20-69" name="__codelineno-20-69"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_revolution_start_time</span>
</span><span id="__span-20-70"><a id="__codelineno-20-70" name="__codelineno-20-70"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_revolution_end_time</span>
</span><span id="__span-20-71"><a id="__codelineno-20-71" name="__codelineno-20-71"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">Omega</span>
</span><span id="__span-20-72"><a id="__codelineno-20-72" name="__codelineno-20-72"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">toa</span>
</span><span id="__span-20-73"><a id="__codelineno-20-73" name="__codelineno-20-73"></a>            <span class="n">AoA_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">Omega</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="__span-20-74"><a id="__codelineno-20-74" name="__codelineno-20-74"></a>                <span class="n">toa</span>
</span><span id="__span-20-75"><a id="__codelineno-20-75" name="__codelineno-20-75"></a>                <span class="o">-</span> <span class="n">current_revolution_start_time</span>
</span><span id="__span-20-76"><a id="__codelineno-20-76" name="__codelineno-20-76"></a>            <span class="p">)</span> <span class="o">+</span> <span class="n">current_section</span> <span class="o">*</span> <span class="n">rad_per_section</span>
</span><span id="__span-20-77"><a id="__codelineno-20-77" name="__codelineno-20-77"></a>
</span><span id="__span-20-78"><a id="__codelineno-20-78" name="__codelineno-20-78"></a>    <span class="k">return</span> <span class="n">AoA_matrix</span>
</span><span id="__span-20-79"><a id="__codelineno-20-79" name="__codelineno-20-79"></a>
</span><span id="__span-20-80"><a id="__codelineno-20-80" name="__codelineno-20-80"></a><span class="k">def</span><span class="w"> </span><span class="nf">transform_ToAs_to_AoAs_mpr</span><span class="p">(</span>
</span><span id="__span-20-81"><a id="__codelineno-20-81" name="__codelineno-20-81"></a>    <span class="n">df_mpr_zero_crossings</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="__span-20-82"><a id="__codelineno-20-82" name="__codelineno-20-82"></a>    <span class="n">df_probe_toas</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="__span-20-83"><a id="__codelineno-20-83" name="__codelineno-20-83"></a>    <span class="n">mpr_sections</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="__span-20-84"><a id="__codelineno-20-84" name="__codelineno-20-84"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-20-85"><a id="__codelineno-20-85" name="__codelineno-20-85"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; This function transforms the ToA values to AoA values for a </span>
</span><span id="__span-20-86"><a id="__codelineno-20-86" name="__codelineno-20-86"></a><span class="sd">    single probe, given the MPR zero-crossing times and the proximity</span>
</span><span id="__span-20-87"><a id="__codelineno-20-87" name="__codelineno-20-87"></a><span class="sd">    probe&#39;s ToA values.</span>
</span><span id="__span-20-88"><a id="__codelineno-20-88" name="__codelineno-20-88"></a>
</span><span id="__span-20-89"><a id="__codelineno-20-89" name="__codelineno-20-89"></a><span class="sd">    The timestamps are assumed to reside in the first column of</span>
</span><span id="__span-20-90"><a id="__codelineno-20-90" name="__codelineno-20-90"></a><span class="sd">    each DataFrame.</span>
</span><span id="__span-20-91"><a id="__codelineno-20-91" name="__codelineno-20-91"></a>
</span><span id="__span-20-92"><a id="__codelineno-20-92" name="__codelineno-20-92"></a><span class="sd">    Args:</span>
</span><span id="__span-20-93"><a id="__codelineno-20-93" name="__codelineno-20-93"></a><span class="sd">        df_opr_zero_crossings (pd.DataFrame): A DataFrame with the </span>
</span><span id="__span-20-94"><a id="__codelineno-20-94" name="__codelineno-20-94"></a><span class="sd">            OPR zero-crossing times.</span>
</span><span id="__span-20-95"><a id="__codelineno-20-95" name="__codelineno-20-95"></a><span class="sd">        df_probe_toas (pd.DataFrame): A DataFrame with the probe&#39;s </span>
</span><span id="__span-20-96"><a id="__codelineno-20-96" name="__codelineno-20-96"></a><span class="sd">            ToA values.</span>
</span><span id="__span-20-97"><a id="__codelineno-20-97" name="__codelineno-20-97"></a><span class="sd">        mpr_sections (int, optional): The number of sections</span>
</span><span id="__span-20-98"><a id="__codelineno-20-98" name="__codelineno-20-98"></a><span class="sd">            in the MPR encoder. Defaults to 1, in this case,</span>
</span><span id="__span-20-99"><a id="__codelineno-20-99" name="__codelineno-20-99"></a><span class="sd">            this function will be treated as an OPR encoder.</span>
</span><span id="__span-20-100"><a id="__codelineno-20-100" name="__codelineno-20-100"></a>
</span><span id="__span-20-101"><a id="__codelineno-20-101" name="__codelineno-20-101"></a><span class="sd">    Returns:</span>
</span><span id="__span-20-102"><a id="__codelineno-20-102" name="__codelineno-20-102"></a><span class="sd">        pd.DataFrame: A DataFrame with the AoA values.</span>
</span><span id="__span-20-103"><a id="__codelineno-20-103" name="__codelineno-20-103"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-20-104"><a id="__codelineno-20-104" name="__codelineno-20-104"></a>    <span class="n">AoA_matrix</span> <span class="o">=</span> <span class="n">calculate_aoa_from_mpr</span><span class="p">(</span>
</span><span id="__span-20-105"><a id="__codelineno-20-105" name="__codelineno-20-105"></a>        <span class="n">df_mpr_zero_crossings</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
</span><span id="__span-20-106"><a id="__codelineno-20-106" name="__codelineno-20-106"></a>        <span class="n">df_probe_toas</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
</span><span id="__span-20-107"><a id="__codelineno-20-107" name="__codelineno-20-107"></a>        <span class="n">mpr_sections</span>
</span><span id="__span-20-108"><a id="__codelineno-20-108" name="__codelineno-20-108"></a>    <span class="p">)</span>
</span><span id="__span-20-109"><a id="__codelineno-20-109" name="__codelineno-20-109"></a>    <span class="n">df_AoA</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="__span-20-110"><a id="__codelineno-20-110" name="__codelineno-20-110"></a>        <span class="n">AoA_matrix</span><span class="p">,</span> 
</span><span id="__span-20-111"><a id="__codelineno-20-111" name="__codelineno-20-111"></a>        <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-20-112"><a id="__codelineno-20-112" name="__codelineno-20-112"></a>            <span class="s2">&quot;n&quot;</span><span class="p">,</span>
</span><span id="__span-20-113"><a id="__codelineno-20-113" name="__codelineno-20-113"></a>            <span class="s2">&quot;mpr_section&quot;</span><span class="p">,</span>
</span><span id="__span-20-114"><a id="__codelineno-20-114" name="__codelineno-20-114"></a>            <span class="s2">&quot;section_start_time&quot;</span><span class="p">,</span>
</span><span id="__span-20-115"><a id="__codelineno-20-115" name="__codelineno-20-115"></a>            <span class="s2">&quot;section_end_time&quot;</span><span class="p">,</span>
</span><span id="__span-20-116"><a id="__codelineno-20-116" name="__codelineno-20-116"></a>            <span class="s2">&quot;Omega&quot;</span><span class="p">,</span>
</span><span id="__span-20-117"><a id="__codelineno-20-117" name="__codelineno-20-117"></a>            <span class="s2">&quot;ToA&quot;</span><span class="p">,</span>
</span><span id="__span-20-118"><a id="__codelineno-20-118" name="__codelineno-20-118"></a>            <span class="s2">&quot;AoA&quot;</span>
</span><span id="__span-20-119"><a id="__codelineno-20-119" name="__codelineno-20-119"></a>        <span class="p">]</span>
</span><span id="__span-20-120"><a id="__codelineno-20-120" name="__codelineno-20-120"></a>    <span class="p">)</span>
</span><span id="__span-20-121"><a id="__codelineno-20-121" name="__codelineno-20-121"></a>    <span class="n">df_AoA</span> <span class="o">=</span> <span class="n">df_AoA</span><span class="p">[</span><span class="n">df_AoA</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-20-122"><a id="__codelineno-20-122" name="__codelineno-20-122"></a>    <span class="n">df_AoA</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-20-123"><a id="__codelineno-20-123" name="__codelineno-20-123"></a>    <span class="k">return</span> <span class="n">df_AoA</span>
</span></code></pre></div></td></tr></table></div>
<!-- Add note stating that this is not the best way to do MPR analysis--></p>
<div class="admonition warning">
<p class="admonition-title">Note</p>
<p>MPR encoder signal processing is, however, nontrivial. For instance, we have assumed here all encoder sections have the same circumferential width. This is almost never the case. I have recently added a correct MPR approach to Bladesight. I'll write a short tutorial on how to use it soon.</p>
</div>
<p>The function <code>calculate_aoa_from_mpr</code> increments each section, instead of each revolution. The function can, however, transform the ToAs with an OPR encoder if you set <code>mpr_sections</code> to 1.</p>
<p>In <a href="#figure_05">Figure 5</a> below, we show the AoAs calculated from the MPR encoder vs the same values calculated from the OPR encoder. The AoAs from the MPR algorithm appear less noisy than the AoAs from the OPR algorithm. 
<div>
    <div>
        <canvas id="ch03_blade_5_aoas_using_mpr"'></canvas>
    </div>
    <a onclick="window.fig_blade_5_aoas_using_mpr_reset()" class='md-button'>Reset Zoom</a>
</div>
<script> render_chart_blade_5_aoas_using_mpr(); </script>
<figure markdown>
  <figcaption><strong><a name='figure_05'>Figure 5</a></strong>: The AoAs of the fifth blade at the first proximity probe. The AoAs were calculated with both the MPR encoder and the OPR encoder. </figcaption>
</figure></p>
<p>MPR encoders will always produce more accurate BTT results than OPR encoders. One reason for this is because MPR encoders capture high frequency shaft torsional vibration. This allows us to remove it from the AoAs. An OPR encoder cannot capture this torsional vibration. High frequency shaft torsional vibration therefore <em>appears</em> as high-frequency content in our AoAs when we use OPR encoders.</p>
</details>
<div class="footnote">
<hr />
<ol>
<li id="fn:du2019stochastic">
<p>Du Toit, R., Diamond, D., Heyns, P.S., 2019. A stochastic hybrid blade tip timing approach for the identification and classification of turbomachine blade damage. Mechanical Systems and Signal Processing 121, 389--411.&#160;<a class="footnote-backref" href="#fnref:du2019stochastic" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:diamond2019improved">
<p>Diamond, D., Heyns, P.S., Oberholster, A., 2019. Improved blade tip timing measurements during transient conditions using a state space model. Mechanical Systems and Signal Processing 122, 555--579.&#160;<a class="footnote-backref" href="#fnref:diamond2019improved" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>







  
  



  


  



                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../ch2/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 2. Time of Arrival (ToA)">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                2. Time of Arrival (ToA)
              </div>
            </div>
          </a>
        
        
          
          <a href="../ch4/" class="md-footer__link md-footer__link--next" aria-label="Next: 4. Allocating AoAs to blades">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                4. Allocating AoAs to blades
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Bladesight
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://twitter.com/DawieDiamond" target="_blank" rel="noopener" title="Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/Bladesight" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linkedin.com/in/dawie-diamond-51089676/" target="_blank" rel="noopener" title="LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.researchgate.net/profile/Dawie-Diamond-2" target="_blank" rel="noopener" title="ResearchGate" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M0 32v448h448V32zm262.2 334.4c-6.6 3-33.2 6-50-14.2-9.2-10.6-25.3-33.3-42.2-63.6-8.9 0-14.7 0-21.4-.6v46.4c0 23.5 6 21.2 25.8 23.9v8.1c-6.9-.3-23.1-.8-35.6-.8-13.1 0-26.1.6-33.6.8v-8.1c15.5-2.9 22-1.3 22-23.9V225c0-22.6-6.4-21-22-23.9V193c25.8 1 53.1-.6 70.9-.6 31.7 0 55.9 14.4 55.9 45.6 0 21.1-16.7 42.2-39.2 47.5 13.6 24.2 30 45.6 42.2 58.9 7.2 7.8 17.2 14.7 27.2 14.7zm22.9-135c-23.3 0-32.2-15.7-32.2-32.2V167c0-12.2 8.8-30.4 34-30.4s30.4 17.9 30.4 17.9l-10.7 7.2s-5.5-12.5-19.7-12.5c-7.9 0-19.7 7.3-19.7 19.7v26.8c0 13.4 6.6 23.3 17.9 23.3 14.1 0 21.5-10.9 21.5-26.8h-17.9v-10.7h30.4c0 20.5 4.7 49.9-34 49.9m-116.5 44.7c-9.4 0-13.6-.3-20-.8v-69.7c6.4-.6 15-.6 22.5-.6 23.3 0 37.2 12.2 37.2 34.5 0 21.9-15 36.6-39.7 36.6"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
    
      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tracking", "navigation.instant", "navigation.path", "navigation.footer", "content.code.copy", "content.code.select", "content.code.annotate", "content.tabs.link", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="../../../javascripts/reviews.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
      
    
  </body>
</html>