
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This chapter explains how to allocate AoAs to specific blades.">
      
      
      
      
        <link rel="prev" href="../ch3/">
      
      
        <link rel="next" href="../ch5/">
      
      
      <link rel="icon" href="../../../images/fab.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>4. Allocating AoAs to blades - Bladesight Learning Centre</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M576%2048c0-11.1-5.7-21.4-15.2-27.2s-21.2-6.4-31.1-1.4L413.5%2077.5%20234.1%2017.6c-8.1-2.7-16.8-2.1-24.4%201.7l-128%2064C70.8%2088.8%2064%2099.9%2064%20112v352c0%2011.1%205.7%2021.4%2015.2%2027.2s21.2%206.4%2031.1%201.4l116.1-58.1%20173.3%2057.8c-4.3-6.4-8.5-13.1-12.6-19.9-11-18.3-21.9-39.3-30-61.8l-101.2-33.7V92.4l128%2042.7v99.3c31-35.8%2077-58.4%20128-58.4%2022.6%200%2044.2%204.4%2064%2012.5zM392%20341.9c0%2068.9%2064.1%20150.4%2098.6%20189.3%2011.6%2013%2031.3%2013%2042.9%200%2034.5-38.9%2098.6-120.4%2098.6-189.3%200-65.1-53.7-117.9-120-117.9S392%20276.8%20392%20341.9%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Literata:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Literata";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-6B961HRVZP"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-6B961HRVZP",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-6B961HRVZP",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    

<meta name="keywords" content="Blade Tip Timing, BTT, Non Intrusive Stress Measurement, NSMS, Turbine blade,Mechanical Vibration">


<meta property="og:title" content="Intro to BTT Ch4 - Identifying the blades" />
<meta property="og:description" content="This chapter explains how to allocate AoAs to specific blades." />
<meta property="og:image" content="https://intro-to-btt-using-python-assets.s3.amazonaws.com/social_card_source_ch4.png" />
<meta property="og:url" content="https://docs.bladesight.com/intro-to-bttch4/" />
<meta property="og:image:height" content="1362" />
<meta property="og:image:width" content="1970" />


<meta name="twitter:site" content="@bladesight" />
<meta name="twitter:creator" content="@dawiediamond" />

<meta name="twitter:title" content="Intro to BTT Ch4 - Identifying the blades"/>
<meta name="twitter:image" content="https://intro-to-btt-using-python-assets.s3.amazonaws.com/social_card_source_ch4.png"/>
<meta name="twitter:url" content="https://docs.bladesight.com/intro-to-bttch4/"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:description" content="This chapter explains how to allocate AoAs to specific blades."/>


<meta name="robots" content="index, follow, Blade Tip Timing, BTT, Non Intrusive Stress Measurement, NSMS, Time of Arrival, Turbine blade,Mechanical Vibration" />
  


  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="bladesight" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#allocating-aoas-to-blades" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Bladesight Learning Centre" class="md-header__button md-logo" aria-label="Bladesight Learning Centre" data-md-component="logo">
      
  <img src="../../../assets/horizontal_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Bladesight Learning Centre
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              4. Allocating AoAs to blades
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="bladesight" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Bladesight Learning Centre

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ch1/" class="md-tabs__link">
          
  
  
  Introduction to Blade Tip Timing

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../datasets/diamond_et_al_2024_vary_ramp_rates_45" class="md-tabs__link">
          
  
  
  Datasets

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../reference/dataset_handler/" class="md-tabs__link">
          
  
  
  User Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!--
  Copyright (c) 2016-2024 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Determine classes -->


  



<!-- Navigation -->
<nav
  class="md-nav md-nav--primary md-nav--lifted"
  aria-label="Navigation"
  data-md-level="0"
>

  <!-- Site title -->
  <label class="md-nav__title" for="__drawer">
    <a
      href="../../.."
      title="Bladesight Learning Centre"
      class="md-nav__button md-logo"
      aria-label="Bladesight Learning Centre"
      data-md-component="logo"
    >
      
  <img src="../../../assets/horizontal_white.png" alt="logo">

    </a>
    Bladesight Learning Centre
  </label>

  <!-- Repository information -->
  

  <!-- Navigation list -->
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bladesight Learning Centre
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Introduction to Blade Tip Timing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction to Blade Tip Timing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Blade Tip Timing's fundamental principle
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2. Time of Arrival (ToA)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3. Angle of Arrival (AoA)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    4. Allocating AoAs to blades
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    4. Allocating AoAs to blades
    
  </span>
  

      </a>
      
        
  
  <nav class="md-nav md-nav--secondary" aria-label="Table of contents">
    
    
    
      
    
    
<div id="mc_embed_shell">
    <link href="//cdn-images.mailchimp.com/embedcode/classic-061523.css" rel="stylesheet" type="text/css">
<style type="text/css">
      #mc_embed_signup{background:#fff; false;clear:left; font:14px Helvetica,Arial,sans-serif; width: 200px;}
      /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<!-- <div id="mc_embed_signup">
  <form action="https://bladesight.us8.list-manage.com/subscribe/post?u=d61691d2e27bf9fdb772ac2d6&amp;id=5c2250604e&amp;f_id=006109e0f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" style="margin:0px 0px 0px 1rem;">
      <div id="mc_embed_signup_scroll"><h4>Subscribe to Bladesight's newsletterüëá</h4>
          <div class="mc-field-group"><label for="mce-EMAIL">Email Address <span class="asterisk">*</span></label><input type="email" name="EMAIL" class="required email" id="mce-EMAIL" required="" value=""><span id="mce-EMAIL-HELPERTEXT" class="helper_text"></span></div>
      <div id="mce-responses" class="clear foot">
          <div class="response" id="mce-error-response" style="display: none;"></div>
          <div class="response" id="mce-success-response" style="display: none;"></div>
      </div>
  <div aria-hidden="true" style="position: absolute; left: -5000px;">
      /* real people should not fill this in and expect good things - do not remove this or risk form bot signups */
      <input type="text" name="b_d61691d2e27bf9fdb772ac2d6_5c2250604e" tabindex="-1" value="">
  </div>
      <div class="optionalParent">
          <div class="clear foot">
              <input type="submit" name="subscribe" id="mc-embedded-subscribe" class="button" value="Subscribe">
          </div>
      </div>
  </div>
</form>
</div> -->

<script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script></div>

      <label class="md-nav__title" for="__toc">
        <span class="md-nav__icon md-icon"></span>
        Table of contents
      </label>
      <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
        
          <li class="md-nav__item">
  <a href="#first-attempt" class="md-nav__link">
    <span class="md-ellipsis">
      First attempt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="First attempt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sequential-allocation" class="md-nav__link">
    <span class="md-ellipsis">
      Sequential allocation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binned-allocation" class="md-nav__link">
    <span class="md-ellipsis">
      Binned allocation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rotated-bin-allocation" class="md-nav__link">
    <span class="md-ellipsis">
      Rotated bin allocation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#follow-along" class="md-nav__link">
    <span class="md-ellipsis">
      Follow along
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-the-data" class="md-nav__link">
    <span class="md-ellipsis">
      Load the data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#our-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Our algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-example" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one-dataframe-per-blade" class="md-nav__link">
    <span class="md-ellipsis">
      One DataFrame per blade
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blade-wrap-around" class="md-nav__link">
    <span class="md-ellipsis">
      Blade wrap-around
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acknowledgements" class="md-nav__link">
    <span class="md-ellipsis">
      Acknowledgements
    </span>
  </a>
  
</li>
        
      </ul>
    
  </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5. Working with multiple probes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6. Data Zeroing and Filtering
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7. Synchronous Vibration and Sampling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8. Single Degree of Freedom (SDoF) Method
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    9. Circumferential Fourier Fit (CFF) Method
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../afterword/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Afterword
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/diamond_et_al_2024_vary_ramp_rates_45" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Varying ramp rates with 45 degree pipe
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            User Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/dataset_handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dataset handler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    btt
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            btt
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/btt/triggering_criteria/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Triggering criteria
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
  <br/>
  <br/>
  <br/>
  <a
    href="https://www.bladesight.com/"
    target="_blank"
    style="text-align: -webkit-center;"
  >
    <img src="https://intro-to-btt-using-python-assets.s3.amazonaws.com/kraken1.jpeg" 
    alt="Kraken" 
    style="width: 120px; display: flex; padding: 2px 0px; justify-content: center; align-items: center; border: 2px;">
    <p><strong>Unleash the Krakenüêô</strong></p>
    </a>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
  
  <nav class="md-nav md-nav--secondary" aria-label="Table of contents">
    
    
    
      
    
    
<div id="mc_embed_shell">
    <link href="//cdn-images.mailchimp.com/embedcode/classic-061523.css" rel="stylesheet" type="text/css">
<style type="text/css">
      #mc_embed_signup{background:#fff; false;clear:left; font:14px Helvetica,Arial,sans-serif; width: 200px;}
      /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<!-- <div id="mc_embed_signup">
  <form action="https://bladesight.us8.list-manage.com/subscribe/post?u=d61691d2e27bf9fdb772ac2d6&amp;id=5c2250604e&amp;f_id=006109e0f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" style="margin:0px 0px 0px 1rem;">
      <div id="mc_embed_signup_scroll"><h4>Subscribe to Bladesight's newsletterüëá</h4>
          <div class="mc-field-group"><label for="mce-EMAIL">Email Address <span class="asterisk">*</span></label><input type="email" name="EMAIL" class="required email" id="mce-EMAIL" required="" value=""><span id="mce-EMAIL-HELPERTEXT" class="helper_text"></span></div>
      <div id="mce-responses" class="clear foot">
          <div class="response" id="mce-error-response" style="display: none;"></div>
          <div class="response" id="mce-success-response" style="display: none;"></div>
      </div>
  <div aria-hidden="true" style="position: absolute; left: -5000px;">
      /* real people should not fill this in and expect good things - do not remove this or risk form bot signups */
      <input type="text" name="b_d61691d2e27bf9fdb772ac2d6_5c2250604e" tabindex="-1" value="">
  </div>
      <div class="optionalParent">
          <div class="clear foot">
              <input type="submit" name="subscribe" id="mc-embedded-subscribe" class="button" value="Subscribe">
          </div>
      </div>
  </div>
</form>
</div> -->

<script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script></div>

      <label class="md-nav__title" for="__toc">
        <span class="md-nav__icon md-icon"></span>
        Table of contents
      </label>
      <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
        
          <li class="md-nav__item">
  <a href="#first-attempt" class="md-nav__link">
    <span class="md-ellipsis">
      First attempt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="First attempt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sequential-allocation" class="md-nav__link">
    <span class="md-ellipsis">
      Sequential allocation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binned-allocation" class="md-nav__link">
    <span class="md-ellipsis">
      Binned allocation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rotated-bin-allocation" class="md-nav__link">
    <span class="md-ellipsis">
      Rotated bin allocation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#follow-along" class="md-nav__link">
    <span class="md-ellipsis">
      Follow along
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-the-data" class="md-nav__link">
    <span class="md-ellipsis">
      Load the data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#our-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Our algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-example" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one-dataframe-per-blade" class="md-nav__link">
    <span class="md-ellipsis">
      One DataFrame per blade
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blade-wrap-around" class="md-nav__link">
    <span class="md-ellipsis">
      Blade wrap-around
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acknowledgements" class="md-nav__link">
    <span class="md-ellipsis">
      Acknowledgements
    </span>
  </a>
  
</li>
        
      </ul>
    
  </nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  


  <nav class="md-tags" hidden>
    
      
      
      
        <span class="md-tag">BTT</span>
      
    
      
      
      
        <span class="md-tag">Blade Tip Timing</span>
      
    
      
      
      
        <span class="md-tag">Mechanical Vibration</span>
      
    
      
      
      
        <span class="md-tag">NSMS</span>
      
    
      
      
      
        <span class="md-tag">Non Intrusive Stress Measurement</span>
      
    
      
      
      
        <span class="md-tag">Time of Arrival</span>
      
    
      
      
      
        <span class="md-tag">Turbine blade</span>
      
    
  </nav>



<details class="abstract">
<summary>You are here</summary>
<p><figure markdown>
<img alt="BTT Tutorial Roadmap" src="BTT_Tutorial_Outline_Ch4.svg" width="500" />
</figure></p>
</details>
<style>
:root {
  --md-tooltip-width: 600px;
}
</style>

<h1 id="allocating-aoas-to-blades">Allocating AoAs to blades</h1>
<p>Taxonomy is the discipline of classifying entities. It is usually associated with the biological sciences. It is, however, a useful concept in many fields.</p>
<p>This chapter deals with the taxonomy of AoA values. What exactly needs to be classified? We need to classify the AoAs into bins, such that each bin contains the AoAs of a single blade.</p>
<p>Here's an illustration of what we've covered so far, and what we're about to cover:</p>
<figure>
<p><img alt="Blade Taxonomy" src="Ch4_taxonomy.svg" width="700" />
    <figcaption><strong><a name='figure_01'>Figure 1</a></strong>: 
        An illustration of this chapter's theme. We have one proximity probe and one One Pulse per Revolution (OPR) sensor. In Chapter 3, we converted the ToAs into an array of AoAs. This chapter takes the next logical step: allocating the AoAs to specific blades.
    </figcaption></p>
</figure>
<p><a href="#figure_01">Figure 1</a> restates that we converted ToAs into AoAs in the previous chapter. We still only have a large, unstructured array of AoAs. In this chapter, for the first time, we use information specific to the rotor: the number of blades.</p>
<p>It may seem overly redundant to dedicate an entire chapter to identify which AoAs belong to which blades. Is it not obvious that the second blade arrives after the first? This may sometimes be the case, but it is too simplistic an approach. It's the kind of solution a Large Language Model(LLM) like ChatGPT would give. Real engineering problems do not bend to the whims of LLMs.</p>
<p>This chapter develops a robust methodology to assign AoAs to specific blades. Giving yourself permission to study the fundamentals will pay dividends in the future.</p>
<h2 id="first-attempt">First attempt</h2>
<p>Let's generate example data to help us explore the problem space. I've generated AoAs for a 5 blade rotor using the code below. Do not get bogged down in the details of this code. The important thing is that we have 5 blades and one sensor. This produces a vector of AoAs. </p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">blade_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">([</span><span class="mi">72</span><span class="p">,</span> <span class="mi">144</span><span class="o">+</span><span class="n">delta</span><span class="p">,</span> <span class="mi">216</span><span class="o">+</span><span class="n">delta</span><span class="p">,</span> <span class="mi">288</span><span class="o">+</span><span class="n">delta</span><span class="p">,</span> <span class="mi">360</span><span class="o">+</span><span class="n">delta</span><span class="p">])</span><span class="c1">#(1)!</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">aoa_values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="n">BLADE_COUNT</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1"># Set random seed for reproducibility</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="c1">#(2)!</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span><span class="c1">#(3)!</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">r</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">/</span><span class="mi">50</span> <span class="o">*</span> <span class="n">n</span><span class="c1">#(4)!</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BLADE_COUNT</span><span class="p">):</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>        <span class="n">aoa_current</span> <span class="o">=</span> <span class="n">blade_means</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.07</span><span class="p">)</span><span class="c1">#(5)!</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>        <span class="c1"># Reject values with probability &lt; 0.05</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span><span class="c1">#(6)!</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>            <span class="n">aoa_values</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>                <span class="s2">&quot;n&quot;</span> <span class="p">:</span> <span class="n">n</span><span class="p">,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>                <span class="s2">&quot;aoa&quot;</span> <span class="p">:</span> <span class="n">aoa_current</span><span class="p">,</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>                <span class="s2">&quot;plot_r&quot;</span> <span class="p">:</span> <span class="n">r</span><span class="p">,</span><span class="c1">#(7)!</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>            <span class="p">})</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="n">df_aoas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">aoa_values</span><span class="p">)</span>
</span></code></pre></div>
<ol>
<li>
<p>We specify the mean AoA for each blade. We also specify a <code>delta</code> value that we use to shift the mean AoA for blades 2 through 5. </p>
<p>This is to simulate the effect of blades that are not perfectly equidistant from one another. Our example shifts all except the first blade by 20 degrees. This is an extreme amount to shift. In practice, the blades will be more-or-less equidistant from one another. We use this <code>delta</code> to showcase the complexity introduced by non-equidistant blades.</p>
</li>
<li>
<p>We set the random seed to ensure reproducibility. It ensures that our random values are the same every time we run the code.</p>
</li>
<li>We generate data for 50 shaft revolutions. Why 50? It's an arbitrary number that helps us make our point.</li>
<li>This <code>radius</code> value has <strong>no physical meaning</strong>. It is simply a value that enables us to plot the AoAs on a polar plot. It is <strong>not</strong> related to the radius of the rotor.</li>
<li>We generate a random AoA value for each blade, as if it passed by the proximity sensor. We add a random value between <span class="arithmatex">\(-\pi \times 0.07\)</span> and <span class="arithmatex">\(\pi \times 0.07\)</span> to the mean AoA value. This is to simulate the effect of noise and vibration. Why <span class="arithmatex">\(-\pi \times 0.07\)</span> and <span class="arithmatex">\(\pi \times 0.07\)</span>? Once again, these values are arbitrary but sufficient to illustrate the point.</li>
<li>We reject 5% of the AoAs. This is to simulate the effect of 'missing pulses' in our data. Our BTT DAQ should, in theory, be able to capture all the pulses. In practice, however, this is often not the case. We need to develop an algorithm that can handle missing ToAs.</li>
<li>We reiterate that the <code>radius</code> value has no physical meaning. It is simply a value that enables us to plot the AoAs on a polar plot.</li>
</ol>
<p>The AoAs are plotted in <a href="#figure_02">Figure 2</a> below.</p>
<figure>
<p><img alt="Unallocated AoAs" src="preamble_unallocated_aoas.png" width="700" />
    <figcaption><strong><a name='figure_02'>Figure 2</a></strong>: The raw AoAs are shown on a polar plot. The radial dimension is not related to the blade's radius. We've spread our AoAs radially because it's simpler to visualize.<br />
    </figcaption></p>
</figure>
<p>In <a href="#figure_02">Figure 2</a> above, there are five distinct "groups" of AoAs. Intuitively, we expect each group to correspond to a blade. We now develop an algorithm to assign each AoA to a blade.</p>
<h3 id="sequential-allocation">Sequential allocation</h3>
<p>To help us reason through the first approach, the first 10 AoAs are presented in <a href="#table_01">Table 1</a> below:</p>
<figure>
<figcaption><strong><a name='table_01'>Table 1</a></strong>: The first 10 AoAs. </figcaption>
</figure>
<table>
<thead>
<tr>
<th style="text-align: right;">n</th>
<th style="text-align: right;">aoa</th>
<th style="text-align: right;">plot_r</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.27811</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.20941</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3.38727</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.65003</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.13805</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.38494</td>
<td style="text-align: right;">0.51</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.19414</td>
<td style="text-align: right;">0.51</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.23218</td>
<td style="text-align: right;">0.51</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4.46646</td>
<td style="text-align: right;">0.51</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.05646</td>
<td style="text-align: right;">0.51</td>
</tr>
</tbody>
</table>
<p>Humans excel at pattern recognition. From <a href="#table_01">Table 1</a> above, it's clear the AoAs arrive in a sequence. Each AoA in the table seems to increase by <span class="arithmatex">\(\frac{2 \pi}{5}\)</span> radians until the fifth value, after which the pattern repeats itself. It seems obvious that we should be able to allocate the AoAs sequentially. In other words, blade 1's AoA is located in row 1, then blade 2, and so on.</p>
<p>A reasonable strategy would be to assign every 5th AoA to the same blade:</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">df_aoa_sequential</span> <span class="o">=</span> <span class="n">df_aoas</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">df_aoa_sequential</span><span class="p">[</span><span class="s1">&#39;blade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">df_aoa_sequential</span><span class="o">.</span><span class="n">loc</span><span class="p">[::</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;blade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#(1)!</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">df_aoa_sequential</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;blade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="n">df_aoa_sequential</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;blade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">df_aoa_sequential</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;blade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="n">df_aoa_sequential</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">4</span><span class="p">::</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;blade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
</span></code></pre></div>
<ol>
<li><code>[::5]</code> is Python notation for "select every 5th value".</li>
</ol>
<p>Every AoA is now assigned. We can therefore use a different style marker to discern between the assigned groups. The results are displayed in <a href="#figure_03">Figure 3</a> below.</p>
<figure>
<p><img alt="Sequential allocation" src="preamble_sequential_allocation_aoas.png" width="700" />
    <figcaption><strong><a name='figure_03'>Figure 3</a></strong>: This plot indicates the results of sequential AoA allocation. In other words, we've grouped every 5th AoA value together. 
    </figcaption></p>
</figure>
<p><a href="#figure_03">Figure 3</a> is a disaster. <img alt="üò±" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f631.svg" title=":scream:" /></p>
<p>We would expect five distinct groups clustered around different circumferential areas. Rather, each AoA group has members spread out over the entire circumferential range from 0 to 360 degrees.</p>
<p>Why did this happen? Because we introduced "missing pulses" when we generated the AoAs. If only one pulse is missing, all of our AoAs will be incorrectly grouped. This is a common problem in BTT analysis. We must therefore develop a sequence-independent algorithm.</p>
<h3 id="binned-allocation">Binned allocation</h3>
<p>Let's rather group the AoAs into angular bins. We create five equally spaced bins and slice the AoA vector up into these bins. The first bin's edge starts at 0 degrees. Each bin is <span class="arithmatex">\(\frac{360}{5}\)</span> degrees wide. </p>
<p><div class="language-console highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="go">bin_left_edges  -&gt;  [0,  72,  144, 216, 288]</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="go">bin_right_edges -&gt; [72, 144, 216, 288, 360]</span>
</span></code></pre></div>
The allocation is performed below:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">df_aoa_binned</span> <span class="o">=</span> <span class="n">df_aoas</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">df_aoa_binned</span><span class="p">[</span><span class="s1">&#39;blade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">bin_edges</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">288</span><span class="p">]</span> <span class="c1">#(1)!</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="n">bin_edges_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">)</span> <span class="c1">#(2)!</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">bin_left_edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bin_edges_rad</span><span class="p">):</span> <span class="c1">#(3)!</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="n">bin_right_edge</span> <span class="o">=</span> <span class="n">bin_left_edge</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">5</span> <span class="c1">#(4)!</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="n">ix_in_bin</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>        <span class="p">(</span><span class="n">df_aoa_binned</span><span class="p">[</span><span class="s1">&#39;aoa&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bin_left_edge</span><span class="p">)</span> 
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_aoa_binned</span><span class="p">[</span><span class="s1">&#39;aoa&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bin_right_edge</span><span class="p">)</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    <span class="p">)</span> <span class="c1">#(5)!</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    <span class="n">df_aoa_binned</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ix_in_bin</span><span class="p">,</span> <span class="s1">&#39;blade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1">#(6)!</span>
</span></code></pre></div>
<ol>
<li>We specify the left edges of the bins. They are all equally wide.</li>
<li>We convert from degrees to radians to get them to the same unit as the AoAs.</li>
<li>The <code>enumerate</code> function returns the index and left edge of the bin we are currently considering.</li>
<li>We calculate the position of the right edge. It's always <span class="arithmatex">\(\frac{2 \pi}{5}\)</span> radians larger than the left edge.</li>
<li>We create a boolean mask to identify the AoAs that fall within the bin we are currently considering.</li>
<li>We use the mask to allocate the appropriate AoAs to its corresponding blade.</li>
</ol>
<p>The groups are plotted in <a href="#figure_04">Figure 4</a> below. The group edges have been added to the plot.</p>
<figure>
<p><img alt="Binned allocation" src="preamble_simple_bin_allocation_aoas.png" width="700" />
    <figcaption><strong><a name='figure_04'>Figure 4</a></strong>: The AoA groups as a consequence of binning. The AoA allocation is better, but not perfect. The AoAs from blades 1 and 2 are mixed.
    </figcaption></p>
</figure>
<p><a href="#figure_04">Figure 4</a> above is a significant improvement over <a href="#figure_03">Figure 3</a>. The groups seem more sensible.</p>
<p>However, some of blade 1's AoAs are grouped with blade 2. This is because the AoAs from blade 1 fall close to the first bin's edge. We cannot control where the AoAs fall. It is a function of the rotor's blade count and the location of our OPR sensor. Our algorithm should be able to adapt to this.</p>
<h3 id="rotated-bin-allocation">Rotated bin allocation</h3>
<p>Instead of the first bin starting at 0 degrees, we subtract an offset to each edge. Let's subtract an offset. We call the offset <code>d_theta</code>. Let's set <code>d_theta</code> equal to half the current bin width, 72¬∞/2 = 36¬∞, for this example. </p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="go">bin_left_edges  -&gt; [-36,36,  108, 180, 252]</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="go">bin_right_edges -&gt; [36, 108, 180, 252, 324]</span>
</span></code></pre></div>
<p>The code to perform the allocation is similar to the previous example. We need, however, to include a second mask to check for the AoAs close to the 0¬∞/360¬∞ boundary. We'll discuss this in more depth later in the chapter. </p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">df_aoa_rotated_binned</span> <span class="o">=</span> <span class="n">df_aoas</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="n">df_aoa_rotated_binned</span><span class="p">[</span><span class="s1">&#39;blade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="n">bin_edges_new</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">36</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">252</span><span class="p">]</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="n">bin_edges_new_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">bin_edges_new</span><span class="p">)</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">bin_left_edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bin_edges_new_rad</span><span class="p">):</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a>    <span class="n">bin_right_edge</span> <span class="o">=</span> <span class="n">bin_left_edge</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">5</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a>    <span class="n">ix_in_bin</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8"></a>        <span class="p">(</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9"></a>                <span class="p">(</span><span class="n">df_aoa_rotated_binned</span><span class="p">[</span><span class="s1">&#39;aoa&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bin_left_edge</span><span class="p">)</span> 
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10"></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_aoa_rotated_binned</span><span class="p">[</span><span class="s1">&#39;aoa&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bin_right_edge</span><span class="p">)</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11"></a>        <span class="p">)</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12"></a>        <span class="o">|</span> <span class="p">(</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="hll">                <span class="p">((</span><span class="n">df_aoa_rotated_binned</span><span class="p">[</span><span class="s1">&#39;aoa&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">bin_left_edge</span><span class="p">)</span> <span class="c1"># (1)!</span>
</span></span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="hll">                <span class="o">&amp;</span> <span class="p">((</span><span class="n">df_aoa_rotated_binned</span><span class="p">[</span><span class="s1">&#39;aoa&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">bin_right_edge</span><span class="p">)</span>
</span></span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15"></a>        <span class="p">)</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16"></a>    <span class="p">)</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17"></a>    <span class="n">df_aoa_rotated_binned</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ix_in_bin</span><span class="p">,</span> <span class="s1">&#39;blade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>The second mask to check for AoAs close to the 0¬∞/360¬∞ boundary.</li>
</ol>
<p>We plot the result in <a href="#figure_05">Figure 5</a> below.</p>
<figure>
<p><img alt="Rotated bin allocation" src="preamble_rotated_bin_allocation_aoas.png" width="700" />
    <figcaption><strong><a name='figure_05'>Figure 5</a></strong>: The grouping as a consequence of a <em>rotated</em> bin approach. Our groups are finally correct <img alt="üëè" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f44f.svg" title=":clap:" /> .
    </figcaption></p>
</figure>
<p>Finally our allocation is perfect. The AoAs from each blade are grouped together. This is the allocation we always want to achieve. </p>
<p>In this example, we've manually chosen the offset. We would rather use an algorithm to automate the process. </p>
<p>How can we determine the quality of the allocation? Intuitively, we expect the AoAs from each blade to occur in the middle of its bin. The closer it is to an edge, the higher the likelihood of misclassification.</p>
<p>This chapter therefore develops an algorithm to identify the optimal offset, <code>d_theta</code>. The optimal offset causes each bin's AoAs to be located in the middle of the bin.</p>
<div class="admonition question">
<p class="admonition-title">Outcomes</p>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5z"/></svg></span> Calculate the optimal <code>d_theta</code> to group the AoAs into blade bins by minimizing a quality factor <span class="arithmatex">\(Q\)</span>.</p>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5z"/></svg></span> Understand that the first blade may arrive close to the OPR zero-crossing time. This can make the blade appear either at the start <em>or</em> end of the revolution. We need to cater for this scenario.</p>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5z"/></svg></span> Write a function that determines the optimal blade bins for a set of AoAs, and split the proximity probe AoA DataFrames into several individual blade DataFrames.</p>
</div>
<h2 id="follow-along">Follow along</h2>
<p>The worksheet for this chapter can be downloaded here <a href="https://github.com/Bladesight/bladesight-worksheets/blob/master/intro_to_btt/ch_04_worksheet.ipynb" target="_blank"><img src="https://img.shields.io/badge/GitHub-100000?style=for-the-badge&logo=github&logoColor=white" alt="Open In Github"/></a>.</p>
<p>You can open a Google Colab session of the worksheet here: <a href="https://colab.research.google.com/github/Bladesight/bladesight-worksheets/blob/master/intro_to_btt/ch_04_worksheet.ipynb" target="_blank"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a>.</p>
<p>You need to use one of these Python versions to run the worksheet:
<img src="https://img.shields.io/badge/python-3.9-blue.svg">
<img src="https://img.shields.io/badge/python-3.10-blue.svg">
<img src="https://img.shields.io/badge/python-3.11-blue.svg">.</p>
<h2 id="load-the-data">Load the data</h2>
<p>We load the same dataset that we used for Chapter 3. We only get the AoAs from the first probe and store it in <code>df_prox_1</code>. </p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">bladesight</span><span class="w"> </span><span class="kn">import</span> <span class="n">Datasets</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">bladesight.btt.aoa</span><span class="w"> </span><span class="kn">import</span> <span class="n">transform_ToAs_to_AoAs</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="n">dataset</span> <span class="o">=</span> <span class="n">Datasets</span><span class="p">[</span><span class="s1">&#39;data/intro_to_btt/intro_to_btt_ch03&#39;</span><span class="p">]</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="n">df_opr_zero_crossings</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;table/du_toit_2017_test_1_opr_zero_crossings&quot;</span><span class="p">]</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="n">df_prox_1_toas</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;table/du_toit_2017_test_1_prox_1_toas&quot;</span><span class="p">]</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="n">df_prox_1</span> <span class="o">=</span> <span class="n">transform_ToAs_to_AoAs</span><span class="p">(</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a>    <span class="n">df_opr_zero_crossings</span><span class="p">,</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a>    <span class="n">df_prox_1_toas</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="our-algorithm">Our algorithm</h2>
<p>We've discussed that a "good" allocation is one where the AoAs from each blade occur close to the center of its bin. To quantify this intuitive approach, we create a quality factor, <span class="arithmatex">\(Q\)</span>.</p>
<p><span class="arithmatex">\(Q\)</span> is the sum of squared errors between the center of each bin and each AoA within it.</p>
<div class="arithmatex">\[\begin{equation}
Q = \sum_{b=1}^{B} \sum_{n=1}^{N_b} \left (\hat{AoA}_{b} (\delta \theta) - AoA_{b, n}\right)^2
\end{equation}\]</div>
<details class="info">
<summary>Symbols</summary>
<table>
<thead>
<tr>
<th style="text-align: center;">Symbol</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(Q\)</span></td>
<td style="text-align: left;">The blade bin quality factor</td>
</tr>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(\delta \theta\)</span></td>
<td style="text-align: left;"><code>d_theta</code>, the offset we apply to the bin edges</td>
</tr>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(b\)</span></td>
<td style="text-align: left;">The blade index</td>
</tr>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(B\)</span></td>
<td style="text-align: left;">The total number of blades</td>
</tr>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(n\)</span></td>
<td style="text-align: left;">The index of the AoA inside bin <span class="arithmatex">\(b\)</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(N\)</span></td>
<td style="text-align: left;">The total number of AoAs inside bin <span class="arithmatex">\(b\)</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(\hat{AoA}_{b}\)</span></td>
<td style="text-align: left;">The center AoA of bin <span class="arithmatex">\(b\)</span></td>
</tr>
<tr>
<td style="text-align: center;"><span class="arithmatex">\(AoA_{b, n}\)</span></td>
<td style="text-align: left;">The <span class="arithmatex">\(n\)</span>th AoA inside bin <span class="arithmatex">\(b\)</span></td>
</tr>
</tbody>
</table>
<p>Below, we show the domains of the variables for this example:</p>
<div class="arithmatex">\[
\begin{align}
    Q &amp;\in [0, \infty] \\
    b &amp;\in [0,1,2,3,4] \\
    B &amp;= 5 \\
    n &amp;\in [0, ..., N] \\
    N &amp;\rightarrow \textrm{computed for each bin} \\
    \hat{AoA}_{b} &amp;\in [0, 2 \pi] \\
    AoA_{b, n} &amp;\in [0, 2 \pi] \\
\end{align}
\]</div>
</details>
<p>The below function calculates Q for a given blade number and offset. I've added detailed comments that can be opened by clicking on the <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 13h-4v4h-2v-4H7v-2h4V7h2v4h4m-5-9A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2"/></svg></span> symbols. If they do not open, please refresh the page.</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_Q</span><span class="p">(</span> <span class="c1">#(1)!</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a>    <span class="n">arr_aoas</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a>    <span class="n">d_theta</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a>    <span class="n">N</span> <span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a>    <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">d_theta</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">d_theta</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a>    <span class="n">Q</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8"></a>    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span><span class="c1">#(2)!</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9"></a>        <span class="n">left_edge</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a>        <span class="n">right_edge</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a>        <span class="n">bin_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr_aoas</span> <span class="o">&gt;</span> <span class="n">left_edge</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">arr_aoas</span> <span class="o">&lt;=</span> <span class="n">right_edge</span><span class="p">)</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12"></a>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13"></a>        <span class="n">bin_centre</span> <span class="o">=</span> <span class="p">(</span><span class="n">left_edge</span> <span class="o">+</span> <span class="n">right_edge</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1">#(3)!</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14"></a>        <span class="n">Q</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15"></a>            <span class="p">(</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16"></a>                <span class="n">arr_aoas</span><span class="p">[</span><span class="n">bin_mask</span><span class="p">]</span> 
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17"></a>                <span class="o">-</span> <span class="n">bin_centre</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18"></a>            <span class="p">)</span><span class="o">**</span><span class="mi">2</span> 
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19"></a>        <span class="p">)</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">arr_aoas</span> <span class="o">&lt;</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span><span class="c1">#(4)!</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">bin_edges</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">arr_aoas</span> <span class="o">&gt;</span> <span class="n">bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">bin_edges</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24"></a>    <span class="k">return</span> <span class="n">Q</span><span class="p">,</span> <span class="n">bin_edges</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>
<p><h2> Initialization </h2></p>
<p><div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_Q</span><span class="p">(</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a>    <span class="n">arr_aoas</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a>    <span class="n">d_theta</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a>    <span class="n">N</span> <span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6"></a>    <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">d_theta</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">d_theta</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7"></a>    <span class="n">Q</span> <span class="o">=</span> <span class="mi">0</span>
</span></code></pre></div></td></tr></table></div>
In lines 1 - 4, the function name and input arguments are defined. <code>arr_aoas</code> is a numpy array of AoAs, in <em>radians</em>, <code>d_theta</code> is our guess for the shift to apply to the "standard" edges, and <code>N</code> is the number of blades. </p>
<p>In Line 5, we specify the function's return type. It's a tuple - a fancy word for an immutable list - with two values: <code>Q</code> and <code>bin_edges</code>. <code>Q</code> is the quality factor, and <code>bin_edges</code> are the edges caused by this choice of <code>d_theta</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You need to import the <code>Tuple</code> type from the <code>typing</code> library.</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span>
</span></code></pre></div>
</div>
<p>In Line 6, we calculate the <code>bin_edges</code> based on the choice of <code>d_theta</code>.</p>
<p>In Line 7, we initialize the quality factor to zero.</p>
</li>
<li>
<p><h2> Identify the AoAs inside each bin </h2></p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8"></a>    <span class="n">left_edge</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9"></a>    <span class="n">right_edge</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10"></a>    <span class="n">bin_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr_aoas</span> <span class="o">&gt;</span> <span class="n">left_edge</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">arr_aoas</span> <span class="o">&lt;=</span> <span class="n">right_edge</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>In Line 7, we enter our main loop, whereby we will consider each bin in turn.</p>
<p>In lines 8 and 9, we select the left and right edges of the current bin.</p>
<p>In Line 10, we determine which AoAs fall within the current bin. <code>bin_mask</code> is a boolean array, with the same length as <code>arr_aoas</code>. If the mask has a value of <code>True</code> at a given index, it means the corresponding AoA value falls within the current bin.</p>
</li>
<li>
<p><h2> Determine each bin's Q factor contribution</h2></p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="n">bin_centre</span> <span class="o">=</span> <span class="p">(</span><span class="n">left_edge</span> <span class="o">+</span> <span class="n">right_edge</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="n">Q</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14"></a>    <span class="p">(</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15"></a>        <span class="n">arr_aoas</span><span class="p">[</span><span class="n">bin_mask</span><span class="p">]</span> 
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16"></a>        <span class="o">-</span> <span class="n">bin_centre</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17"></a>    <span class="p">)</span><span class="o">**</span><span class="mi">2</span> 
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>In Line 12, the center of the bin is calculated. This is <span class="arithmatex">\(\hat{AoA}_{b}\)</span> in <a href="#equation_01">Equation 1</a>.</p>
<p>In lines 13 - 18, we calculate the squared difference between each AoA and its corresponding bin's center. We sum these squared differences and add it to <span class="arithmatex">\(Q\)</span>. If the centre is close to the AoAs, <span class="arithmatex">\(Q\)</span> will not increase much. If the centre is far from the AoAs, <span class="arithmatex">\(Q\)</span> will increase significantly.</p>
</li>
<li>
<p><h2>Sanity checks and return</h2></p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-20">20</a></span>
<span class="normal"><a href="#__codelineno-12-21">21</a></span>
<span class="normal"><a href="#__codelineno-12-22">22</a></span>
<span class="normal"><a href="#__codelineno-12-23">23</a></span>
<span class="normal"><a href="#__codelineno-12-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20"></a><span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">arr_aoas</span> <span class="o">&lt;</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">bin_edges</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22"></a><span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">arr_aoas</span> <span class="o">&gt;</span> <span class="n">bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">bin_edges</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24"></a><span class="k">return</span> <span class="n">Q</span><span class="p">,</span> <span class="n">bin_edges</span>
</span></code></pre></div></td></tr></table></div>
<p>We've added sanity checks to the function. Why is it necessary to add sanity checks? Our code in lines 8 to 19 only consider AoAs between the left and right edges of the current bin. The offset <code>d_theta</code> will shift the edges such that some AoAs do not fall within any bin.</p>
<p>For instance, if <code>d_theta</code> is -10¬∞, the last bin's right edge will be at 350¬∞. If the final blade is clustered around 355¬∞, our algorithm will not consider it in the <span class="arithmatex">\(Q\)</span> factor because every value in our <code>bin_mask</code> will be <code>False</code> for anything above 350¬∞.</p>
<p>We therefore check, in lines 20 and 22, if <code>d_theta</code> is valid. <code>d_theta</code> is invalid if any AoAs occur outside the far left or right bin edges. We return <code>np.nan</code> for <code>Q</code> to indicate <code>dtheta</code> is invalid.</p>
<p>Finally, in Line 24, we return <code>Q</code> and <code>bin_edges</code>.</p>
</li>
</ol>
<h2 id="implementation-example">Implementation example</h2>
<p>We can now calculated <span class="arithmatex">\(Q\)</span> for a range of possible <code>d_theta</code>s. We perform the calculation for <code>d_theta</code>s between <span class="arithmatex">\(-\frac{\pi}{5}\)</span> and <span class="arithmatex">\(\frac{\pi}{5}\)</span>. This shifts the "standard" bins left and right by a maximum of 72¬∞. </p>
<p>The <span class="arithmatex">\(Q\)</span> factor for each <code>d_theta</code> is calculated below.</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="n">B</span> <span class="o">=</span> <span class="mi">5</span><span class="c1">#(1)!</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="n">d_thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="c1">#(2)!</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="n">arr_aoas</span> <span class="o">=</span> <span class="n">df_prox_1</span><span class="p">[</span><span class="s2">&quot;AoA&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="c1">#(3)!</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="n">Qs</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#(4)!</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="n">optimal_Q</span><span class="p">,</span> <span class="n">optimal_bin_edges</span><span class="p">,</span> <span class="n">optimal_d_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="c1">#(5)!</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="k">for</span> <span class="n">d_theta</span> <span class="ow">in</span> <span class="n">d_thetas</span><span class="p">:</span><span class="c1">#(6)!</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7"></a>    <span class="n">Q</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">calculate_Q</span><span class="p">(</span><span class="n">arr_aoas</span><span class="p">,</span> <span class="n">d_theta</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8"></a>    <span class="k">if</span> <span class="n">Q</span> <span class="o">&lt;</span> <span class="n">optimal_Q</span><span class="p">:</span><span class="c1">#(7)!</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9"></a>        <span class="n">optimal_Q</span> <span class="o">=</span> <span class="n">Q</span><span class="o">*</span><span class="mi">1</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10"></a>        <span class="n">optimal_bin_edges</span> <span class="o">=</span> <span class="n">bin_edges</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11"></a>        <span class="n">optimal_d_theta</span> <span class="o">=</span> <span class="n">d_theta</span><span class="o">*</span><span class="mi">1</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12"></a>    <span class="n">Qs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span><span class="c1">#(8)!</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>The number of blades.</li>
<li>We specify the range of offsets to consider. We'll consider 200 offsets between <span class="arithmatex">\(-\frac{\pi}{5}\)</span> and <span class="arithmatex">\(\frac{\pi}{5}\)</span>.</li>
<li>We convert the AoA DataFrame into a Numpy array because our function does not work with a Pandas series.</li>
<li>We initialize an empty list to store the quality factors.</li>
<li>We initialize the optimal Q value to infinity. This is a trick to ensure the first value we calculate is always the optimal value. It can be unseated by a better value later.</li>
<li>We iterate over the range of offsets to consider.</li>
<li>If the quality factor we just calculated is less than the best value so far, we update all the "optimal" values.</li>
<li>We append the quality factor to a list. This will be used to plot the quality factor as a function of the offset.</li>
</ol>
<p>The <code>Q</code> factor for each <code>d_theta</code> is plotted in <a href="#figure_06">Figure 6</a> below.</p>
<script src="q_factor_plot.js" > </script>
<div>
    <div>
        <canvas id="ch03_q_factor_plot"'></canvas>
    </div>
    <script>
        async function render_chart_q_factor_plot() {
            const ctx = document.getElementById('ch03_q_factor_plot');
            // If this is a mobile device, set the canvas height to 400
            if (window.innerWidth < 500) {
                ctx.height = 400;
            }
            while (typeof Chart == "undefined") {
                await new Promise(r => setTimeout(r, 1000));
            }
            Chart.defaults.font.family = "Literata, -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif";
            window.fig_q_factor_plot = new Chart(ctx, window.q_factor_plot);
            window.fig_q_factor_plot_reset = function resetZoomFig2() {
                    window.fig_q_factor_plot.resetZoom();
                }
            }
        render_chart_q_factor_plot();
    </script>
    <a onclick="window.fig_q_factor_plot_reset()" class='md-button'>Reset Zoom</a>
</div>
<figure>
<figcaption><strong><a name='figure_06'>Figure 6</a></strong>: 
    The quality factor, Q, as a function of the offset, d_theta. The optimal offset is -20.08¬∞.
  </figcaption>
</figure>
<p>And voila! The optimal offset is -20.08 degrees.</p>
<details class="note">
<summary>How to choose the offset count</summary>
<p>I've selected 200 values between <span class="arithmatex">\(-\frac{\pi}{5}\)</span> and <span class="arithmatex">\(\frac{\pi}{5}\)</span> to search through. The choice of 200 is arbitrary, you can choose your own value. You need to ensure, however, your grid is fine enough to capture the optimal offset. If you choose too few values, you may miss the optimal offset. If you choose too many values, you may waste time.</p>
</details>
<details class="note">
<summary>The effects of non-equidistant probe spacing</summary>
<p>At this stage it may be unclear how probe spacing affects our analysis. Especially, how non-equidistant probe spacing affects our analysis.</p>
<p>I cannot stress this enough: The algorithm we've developed here is only applied to AoAs from one probe. Multiple probes are combined using a different approach, which we discuss in the next chapter.</p>
</details>
<details class="note">
<summary>Why not use an optimization algorithm</summary>
<p>To find the optimum <code>d_theta</code>, we've resorted to a simple one dimensional grid-search algorithm. This is because the problem is simple. </p>
<p>We could use a more sophisticated optimization algorithm, but it would be overkill for this problem.</p>
</details>
<h2 id="one-dataframe-per-blade">One DataFrame per blade</h2>
<p>Now that we have the optimal bin edges, we cut the proximity probe AoA DataFrame into separate DataFrames for each blade:</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span>
<span class="normal"><a href="#__codelineno-14-7">7</a></span>
<span class="normal"><a href="#__codelineno-14-8">8</a></span>
<span class="normal"><a href="#__codelineno-14-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="n">blade_dfs</span> <span class="o">=</span> <span class="p">[]</span><span class="c1">#(1)!</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">):</span><span class="c1">#(2)!</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3"></a>    <span class="n">ix_bin</span> <span class="o">=</span> <span class="p">(</span><span class="c1">#(3)!</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4"></a>        <span class="p">(</span><span class="n">df_prox_1</span><span class="p">[</span><span class="s2">&quot;AoA&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">optimal_bin_edges</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5"></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_prox_1</span><span class="p">[</span><span class="s2">&quot;AoA&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">optimal_bin_edges</span><span class="p">[</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6"></a>    <span class="p">)</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7"></a>    <span class="n">blade_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8"></a>        <span class="n">df_prox_1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ix_bin</span><span class="p">]</span> <span class="c1">#(4)!</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9"></a>    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>We initialize an empty list to store the DataFrames for each blade.</li>
<li>The for loop allows us to consider each blade in turn.</li>
<li><code>ix_bin</code> is our boolean mask which indicates if the AoAs fall inside bin number <code>b</code>.</li>
<li>We use the <code>.loc</code> method to only select the values inside bin <code>b</code>.</li>
</ol>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Blade </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> mean: </span><span class="si">{</span><span class="n">blade_dfs</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="s1">&#39;AoA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s2">, std: </span><span class="si">{</span><span class="n">blade_dfs</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="s1">&#39;AoA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-console highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="go">Blade 0 mean: 0.280844143512115, std: 0.0014568064245125216</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="go">Blade 1 mean: 1.5390655934492143, std: 0.001784799129959647</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="go">Blade 2 mean: 2.788312464321002, std: 0.0015687549238434136</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="go">Blade 3 mean: 4.045575640802255, std: 0.0017088093157144036</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="go">Blade 4 mean: 5.305095908129366, std: 0.0014525709531342695</span>
</span></code></pre></div>
<p>Finally, we have 5 DataFrames, one for each blade. </p>
<details class="note">
<summary>Why report the mean and standard deviation?</summary>
<p>I use the mean and standard deviation as a check for the quality of the allocation. The mean of each blade's dataframe should correspond to the bin center. The standard deviation should be small, because all AoAs should be close to the center.</p>
<p>If, for some reason, your alignment is off, the standard deviations will shoot through the roof.</p>
</details>
<h2 id="blade-wrap-around">Blade wrap-around</h2>
<p>Let's shift the AoAs from their original position to illustrate an extreme case. This shift is artificial. It is, however, equivalent to what would happen if we positioned the proximity probe or the OPR sensor at a different circumferential location. In short, a constant shift of the AoAs don't objectively change anything about them. We should be able to find the same <span class="arithmatex">\(Q\)</span> value as we did in the previous section.</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="n">df_prox_1_shifted</span> <span class="o">=</span> <span class="n">df_prox_1</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#(1)!</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="n">df_prox_1_shifted</span><span class="p">[</span><span class="s1">&#39;AoA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_prox_1_shifted</span><span class="p">[</span><span class="s1">&#39;AoA&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.280844143512115</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="hll"><span class="n">df_prox_1_shifted</span><span class="p">[</span><span class="s1">&#39;AoA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_prox_1_shifted</span><span class="p">[</span><span class="s1">&#39;AoA&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="c1">#(2)!</span>
</span></span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="n">B</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="n">d_thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">B</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="n">arr_aoas</span> <span class="o">=</span> <span class="n">df_prox_1_shifted</span><span class="p">[</span><span class="s2">&quot;AoA&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="n">Qs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="n">optimal_Q</span><span class="p">,</span> <span class="n">optimal_bin_edges</span><span class="p">,</span> <span class="n">optimal_d_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="k">for</span> <span class="n">d_theta</span> <span class="ow">in</span> <span class="n">d_thetas</span><span class="p">:</span> <span class="c1">#(3)!</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11"></a>    <span class="n">Q</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">calculate_Q</span><span class="p">(</span><span class="n">arr_aoas</span><span class="p">,</span> <span class="n">d_theta</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12"></a>    <span class="k">if</span> <span class="n">Q</span> <span class="o">&lt;</span> <span class="n">optimal_Q</span><span class="p">:</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13"></a>        <span class="n">optimal_Q</span> <span class="o">=</span> <span class="n">Q</span><span class="o">*</span><span class="mi">1</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14"></a>        <span class="n">optimal_bin_edges</span> <span class="o">=</span> <span class="n">bin_edges</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15"></a>        <span class="n">optimal_d_theta</span> <span class="o">=</span> <span class="n">d_theta</span><span class="o">*</span><span class="mi">1</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16"></a>    <span class="n">Qs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>We create a copy of our original DataFrame. In Line 2, we shift the AoAs by blade 1's mean AoA value as calculated in the previous section. </li>
<li>
<p>We've highlighted Line 3 because it is important. Our artificially constructed <code>df_prox_1_shifted</code> DataFrame from Line 2 will contain some <code>AoA</code> values that are negative. </p>
<p>In practice our BTT system will always produce positive AoAs. These artificially shifted values should therefore appear <em>at the end of the next revolution</em>. To simulate this effect, we wrap the AoAs to the range <span class="arithmatex">\([0, 2 \pi]\)</span> in Line 3.</p>
</li>
<li>
<p>From Line 5 onward, we repeat the same process as before to find the optimal bin edges. The only difference is we use the <code>df_prox_1_shifted</code> DataFrame instead of the <code>df_prox_1</code> DataFrame.</p>
</li>
</ol>
<p>We print the optimal <span class="arithmatex">\(Q\)</span> value below.</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">optimal_Q</span><span class="p">)</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">optimal_bin_edges</span><span class="p">)</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="n">inf</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="kc">None</span>
</span></code></pre></div></td></tr></table></div>
<p>The optimal <span class="arithmatex">\(Q\)</span> is infinity and the optimal edges equals <code>None</code> <img alt="üò±" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f631.svg" title=":scream:" /> !</p>
<p>We plot a histogram of the AoAs in <a href="#figure_07">Figure 7</a> below to investigate what went wrong.</p>
<script src="wrapped_aoa_histogram.js" > </script>
<div>
    <div>
        <canvas id="ch03_wrapped_aoa_histogram"'></canvas>
    </div>
    <script>
        async function render_wrapped_aoa_histogram() {
            const ctx = document.getElementById('ch03_wrapped_aoa_histogram');
            // If this is a mobile device, set the canvas height to 400
            if (window.innerWidth < 500) {
                ctx.height = 400;
            }
            while (typeof Chart == "undefined") {
                await new Promise(r => setTimeout(r, 1000));
            }
            Chart.defaults.font.family = "Literata, -apple-system, BlinkMacSystemFont, Helvetica, Arial, sans-serif";
            window.fig_wrapped_aoa_histogram = new Chart(ctx, window.wrapped_aoa_histogram);
            window.fig_wrapped_aoa_histogram_reset = function resetZoomFigWrappedAoAs() {
                    window.fig_wrapped_aoa_histogram.resetZoom();
                }
            }
        render_wrapped_aoa_histogram();
    </script>
    <a onclick="window.fig_wrapped_aoa_histogram_reset()" class='md-button'>Reset Zoom</a>
</div>
<figure>
<figcaption><strong><a name='figure_07'>Figure 7</a></strong>: 
    A histogram of our artificially shifted AoAs. We see that the first blade appears both at the start and end of the revolution.
  </figcaption>
</figure>
<p>This is what happens when a blade arrives at the proximity probe at approximately the same time that the OPR triggers a zero-crossing time. Some of the AoAs will appear at the end of the previous revolution, and some will appear at the beginning of the current revolution.</p>
<p>The algorithm we've developed will fail for such cases, because some values fall before or after the far left and right edges.</p>
<p>We should change <code>calculate_Q</code> to handle blade wrap-around.</p>
<p>I'll leave it to you to make this change as an exercise üëá.</p>
<mark class="critic block">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.1 9 .9.9L5.9 19H5v-.9zm3.6-6c-.2 0-.5.1-.7.3l-1.8 1.8 3.7 3.8L20.7 7c.4-.4.4-1 0-1.4l-2.3-2.3c-.2-.2-.5-.3-.7-.3m-3.6 3.2L3 17.2V21h3.8l11-11.1zM7 2v3h3v2H7v3H5V7H2V5h3V2z"/></svg></span> Currently, <code>calculate_Q</code> returns <code>nan</code> when some blades are outside the furthest bin edges. Blade wrap-around will always trigger this response.  Write an updated <code>calculate_Q</code> function that handles AoAs outside of the bin edges.</p>
</mark>
<details class="example">
<summary>Reveal answer (Please try it yourself before revealing the solution)</summary>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span>
<span class="normal"><a href="#__codelineno-19-22">22</a></span>
<span class="normal"><a href="#__codelineno-19-23">23</a></span>
<span class="normal"><a href="#__codelineno-19-24">24</a></span>
<span class="normal"><a href="#__codelineno-19-25">25</a></span>
<span class="normal"><a href="#__codelineno-19-26">26</a></span>
<span class="normal"><a href="#__codelineno-19-27">27</a></span>
<span class="normal"><a href="#__codelineno-19-28">28</a></span>
<span class="normal"><a href="#__codelineno-19-29">29</a></span>
<span class="normal"><a href="#__codelineno-19-30">30</a></span>
<span class="normal"><a href="#__codelineno-19-31">31</a></span>
<span class="normal"><a href="#__codelineno-19-32">32</a></span>
<span class="normal"><a href="#__codelineno-19-33">33</a></span>
<span class="normal"><a href="#__codelineno-19-34">34</a></span>
<span class="normal"><a href="#__codelineno-19-35">35</a></span>
<span class="normal"><a href="#__codelineno-19-36">36</a></span>
<span class="normal"><a href="#__codelineno-19-37">37</a></span>
<span class="normal"><a href="#__codelineno-19-38">38</a></span>
<span class="normal"><a href="#__codelineno-19-39">39</a></span>
<span class="normal"><a href="#__codelineno-19-40">40</a></span>
<span class="normal"><a href="#__codelineno-19-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_Q</span><span class="p">(</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a>    <span class="n">arr_aoas</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a>    <span class="n">d_theta</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4"></a>    <span class="n">N</span> <span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6"></a>    <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">d_theta</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">d_theta</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7"></a>    <span class="n">Q</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8"></a>    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9"></a>        <span class="n">left_edge</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10"></a>        <span class="n">right_edge</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11"></a>        <span class="n">bin_centre</span> <span class="o">=</span> <span class="p">(</span><span class="n">left_edge</span> <span class="o">+</span> <span class="n">right_edge</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12"></a>        <span class="n">bin_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr_aoas</span> <span class="o">&gt;</span> <span class="n">left_edge</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">arr_aoas</span> <span class="o">&lt;=</span> <span class="n">right_edge</span><span class="p">)</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13"></a>        <span class="n">Q</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14"></a>            <span class="p">(</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15"></a>                <span class="n">arr_aoas</span><span class="p">[</span><span class="n">bin_mask</span><span class="p">]</span> 
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16"></a>                <span class="o">-</span> <span class="n">bin_centre</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17"></a>            <span class="p">)</span><span class="o">**</span><span class="mi">2</span> 
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18"></a>        <span class="p">)</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">arr_aoas</span> <span class="o">&lt;</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="hll">        <span class="n">left_edge_last</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21"></a><span class="hll">        <span class="n">right_edge_last</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">N</span><span class="p">]</span>
</span></span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22"></a><span class="hll">        <span class="n">bin_centre_last</span> <span class="o">=</span> <span class="p">(</span><span class="n">left_edge_last</span> <span class="o">+</span> <span class="n">right_edge_last</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span></span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23"></a><span class="hll">        <span class="n">bin_mask</span> <span class="o">=</span> <span class="n">arr_aoas</span> <span class="o">&lt;=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24"></a><span class="hll">        <span class="n">Q</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span></span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25"></a><span class="hll">            <span class="p">(</span>
</span></span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26"></a><span class="hll">                <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">arr_aoas</span><span class="p">[</span><span class="n">bin_mask</span><span class="p">])</span> 
</span></span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27"></a><span class="hll">                <span class="o">-</span> <span class="n">bin_centre_last</span>
</span></span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28"></a><span class="hll">            <span class="p">)</span><span class="o">**</span><span class="mi">2</span> 
</span></span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29"></a><span class="hll">        <span class="p">)</span>
</span></span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">arr_aoas</span> <span class="o">&gt;</span> <span class="n">bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31"></a><span class="hll">        <span class="n">left_edge_first</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32"></a><span class="hll">        <span class="n">right_edge_first</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33"></a><span class="hll">        <span class="n">bin_centre_first</span> <span class="o">=</span> <span class="p">(</span><span class="n">left_edge_first</span> <span class="o">+</span> <span class="n">right_edge_first</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span></span><span id="__span-19-34"><a id="__codelineno-19-34" name="__codelineno-19-34"></a><span class="hll">        <span class="n">bin_mask</span> <span class="o">=</span> <span class="n">arr_aoas</span> <span class="o">&gt;</span> <span class="n">bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span id="__span-19-35"><a id="__codelineno-19-35" name="__codelineno-19-35"></a><span class="hll">        <span class="n">Q</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span></span><span id="__span-19-36"><a id="__codelineno-19-36" name="__codelineno-19-36"></a><span class="hll">            <span class="p">(</span>
</span></span><span id="__span-19-37"><a id="__codelineno-19-37" name="__codelineno-19-37"></a><span class="hll">                <span class="p">(</span><span class="n">arr_aoas</span><span class="p">[</span><span class="n">bin_mask</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> 
</span></span><span id="__span-19-38"><a id="__codelineno-19-38" name="__codelineno-19-38"></a><span class="hll">                <span class="o">-</span> <span class="n">bin_centre_first</span>
</span></span><span id="__span-19-39"><a id="__codelineno-19-39" name="__codelineno-19-39"></a><span class="hll">            <span class="p">)</span><span class="o">**</span><span class="mi">2</span> 
</span></span><span id="__span-19-40"><a id="__codelineno-19-40" name="__codelineno-19-40"></a><span class="hll">        <span class="p">)</span>
</span></span><span id="__span-19-41"><a id="__codelineno-19-41" name="__codelineno-19-41"></a>    <span class="k">return</span> <span class="n">Q</span><span class="p">,</span> <span class="n">bin_edges</span>
</span></code></pre></div></td></tr></table></div>
<p>In <code>calculate_Q</code> above, we've added lines of code in the 'sanity check' sections to handle AoAs outside the bin edges.</p>
<p>In lines 20 - 29, we check for AoAs occurring before the left most bin edge. These values are therefore treated as if they occur in the last bin.</p>
<p>In lines 31 - 40, we check for AoAs occurring after the right most bin edge. These values are therefore treated as if they occur in the first bin.</p>
</details>
<mark class="critic block">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.1 9 .9.9L5.9 19H5v-.9zm3.6-6c-.2 0-.5.1-.7.3l-1.8 1.8 3.7 3.8L20.7 7c.4-.4.4-1 0-1.4l-2.3-2.3c-.2-.2-.5-.3-.7-.3m-3.6 3.2L3 17.2V21h3.8l11-11.1zM7 2v3h3v2H7v3H5V7H2V5h3V2z"/></svg></span> After you've completed the function above, create a new function performing everything this chapter covered automatically. Call the function <code>transform_prox_AoAs_to_blade_AoAs</code>. </p>
<p>This function should receive the proximity probe AoA DataFrame and the number of blades on the rotor, and return a list of DataFrames, one for each blade. </p>
</mark>
<details class="example">
<summary>Reveal answer (Please try it yourself before revealing the solution)</summary>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span>
<span class="normal"><a href="#__codelineno-20-27">27</a></span>
<span class="normal"><a href="#__codelineno-20-28">28</a></span>
<span class="normal"><a href="#__codelineno-20-29">29</a></span>
<span class="normal"><a href="#__codelineno-20-30">30</a></span>
<span class="normal"><a href="#__codelineno-20-31">31</a></span>
<span class="normal"><a href="#__codelineno-20-32">32</a></span>
<span class="normal"><a href="#__codelineno-20-33">33</a></span>
<span class="normal"><a href="#__codelineno-20-34">34</a></span>
<span class="normal"><a href="#__codelineno-20-35">35</a></span>
<span class="normal"><a href="#__codelineno-20-36">36</a></span>
<span class="normal"><a href="#__codelineno-20-37">37</a></span>
<span class="normal"><a href="#__codelineno-20-38">38</a></span>
<span class="normal"><a href="#__codelineno-20-39">39</a></span>
<span class="normal"><a href="#__codelineno-20-40">40</a></span>
<span class="normal"><a href="#__codelineno-20-41">41</a></span>
<span class="normal"><a href="#__codelineno-20-42">42</a></span>
<span class="normal"><a href="#__codelineno-20-43">43</a></span>
<span class="normal"><a href="#__codelineno-20-44">44</a></span>
<span class="normal"><a href="#__codelineno-20-45">45</a></span>
<span class="normal"><a href="#__codelineno-20-46">46</a></span>
<span class="normal"><a href="#__codelineno-20-47">47</a></span>
<span class="normal"><a href="#__codelineno-20-48">48</a></span>
<span class="normal"><a href="#__codelineno-20-49">49</a></span>
<span class="normal"><a href="#__codelineno-20-50">50</a></span>
<span class="normal"><a href="#__codelineno-20-51">51</a></span>
<span class="normal"><a href="#__codelineno-20-52">52</a></span>
<span class="normal"><a href="#__codelineno-20-53">53</a></span>
<span class="normal"><a href="#__codelineno-20-54">54</a></span>
<span class="normal"><a href="#__codelineno-20-55">55</a></span>
<span class="normal"><a href="#__codelineno-20-56">56</a></span>
<span class="normal"><a href="#__codelineno-20-57">57</a></span>
<span class="normal"><a href="#__codelineno-20-58">58</a></span>
<span class="normal"><a href="#__codelineno-20-59">59</a></span>
<span class="normal"><a href="#__codelineno-20-60">60</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">transform_prox_AoAs_to_blade_AoAs</span><span class="p">(</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2"></a>    <span class="n">df_prox</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3"></a>    <span class="n">B</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4"></a>    <span class="n">d_theta_increments</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This function takes a DataFrame containing the AoAs of a proximity probe,</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="sd">    and returns a list of DataFrame, each containing the AoAs of a single blade.</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8"></a>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="sd">    Args:</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="sd">        df_prox (pd.DataFrame): The dataframe containing the AoAs</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="sd">            of the proximity probe.</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="sd">        B (int): The number of blades.</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="sd">        d_theta_increments (int, optional): The number of increments</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14"></a>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="sd">    Returns:</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="sd">        List[pd.DataFrame]: A list of dataframes, each containing the AoA</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="sd">        values of a single blade.</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19"></a>    <span class="n">d_thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">B</span><span class="p">,</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">B</span><span class="p">,</span> <span class="n">d_theta_increments</span><span class="p">)</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20"></a>    <span class="n">arr_aoas</span> <span class="o">=</span> <span class="n">df_prox</span><span class="p">[</span><span class="s2">&quot;AoA&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21"></a>    <span class="n">Qs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22"></a>    <span class="n">optimal_Q</span><span class="p">,</span> <span class="n">optimal_bin_edges</span><span class="p">,</span> <span class="n">optimal_d_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23"></a>    <span class="k">for</span> <span class="n">d_theta</span> <span class="ow">in</span> <span class="n">d_thetas</span><span class="p">:</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24"></a>        <span class="n">Q</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">calculate_Q</span><span class="p">(</span><span class="n">arr_aoas</span><span class="p">,</span> <span class="n">d_theta</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25"></a>        <span class="k">if</span> <span class="n">Q</span> <span class="o">&lt;</span> <span class="n">optimal_Q</span><span class="p">:</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26"></a>            <span class="n">optimal_Q</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">*</span> <span class="mi">1</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27"></a>            <span class="n">optimal_bin_edges</span> <span class="o">=</span> <span class="n">bin_edges</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28"></a>            <span class="n">optimal_d_theta</span> <span class="o">=</span> <span class="n">d_theta</span> <span class="o">*</span> <span class="mi">1</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29"></a>        <span class="n">Qs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30"></a>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31"></a>    <span class="n">blade_dfs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32"></a>    <span class="n">blade_median_AoAs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33"></a>    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34"></a>        <span class="n">ix_bin</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_prox</span><span class="p">[</span><span class="s2">&quot;AoA&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">optimal_bin_edges</span><span class="p">[</span><span class="n">b</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35"></a>            <span class="n">df_prox</span><span class="p">[</span><span class="s2">&quot;AoA&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">optimal_bin_edges</span><span class="p">[</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36"></a>        <span class="p">)</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37"></a>        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38"></a>            <span class="n">ix_bin</span> <span class="o">=</span> <span class="n">ix_bin</span> <span class="o">|</span> <span class="p">(</span><span class="n">df_prox</span><span class="p">[</span><span class="s2">&quot;AoA&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">optimal_bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39"></a>            <span class="n">df_bin</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40"></a>                <span class="n">df_prox</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ix_bin</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;ToA&quot;</span><span class="p">)</span>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41"></a>            <span class="p">)</span>
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42"></a>
</span><span id="__span-20-43"><a id="__codelineno-20-43" name="__codelineno-20-43"></a>            <span class="n">ix_wrap</span> <span class="o">=</span> <span class="n">df_bin</span><span class="p">[</span><span class="s2">&quot;AoA&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">optimal_bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-20-44"><a id="__codelineno-20-44" name="__codelineno-20-44"></a>            <span class="n">df_bin</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ix_wrap</span><span class="p">,</span> <span class="s2">&quot;AoA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_bin</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ix_wrap</span><span class="p">,</span> <span class="s2">&quot;AoA&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</span><span id="__span-20-45"><a id="__codelineno-20-45" name="__codelineno-20-45"></a>        <span class="k">elif</span> <span class="n">b</span> <span class="o">==</span> <span class="n">B</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-20-46"><a id="__codelineno-20-46" name="__codelineno-20-46"></a>            <span class="n">ix_bin</span> <span class="o">=</span> <span class="n">ix_bin</span> <span class="o">|</span> <span class="p">(</span><span class="n">df_prox</span><span class="p">[</span><span class="s2">&quot;AoA&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">optimal_bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-20-47"><a id="__codelineno-20-47" name="__codelineno-20-47"></a>            <span class="n">df_bin</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-20-48"><a id="__codelineno-20-48" name="__codelineno-20-48"></a>                <span class="n">df_prox</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ix_bin</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;ToA&quot;</span><span class="p">)</span>
</span><span id="__span-20-49"><a id="__codelineno-20-49" name="__codelineno-20-49"></a>            <span class="p">)</span>
</span><span id="__span-20-50"><a id="__codelineno-20-50" name="__codelineno-20-50"></a>
</span><span id="__span-20-51"><a id="__codelineno-20-51" name="__codelineno-20-51"></a>            <span class="n">ix_wrap</span> <span class="o">=</span> <span class="n">df_bin</span><span class="p">[</span><span class="s2">&quot;AoA&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">optimal_bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-20-52"><a id="__codelineno-20-52" name="__codelineno-20-52"></a>            <span class="n">df_bin</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ix_wrap</span><span class="p">,</span> <span class="s2">&quot;AoA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">df_bin</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ix_wrap</span><span class="p">,</span> <span class="s2">&quot;AoA&quot;</span><span class="p">]</span>
</span><span id="__span-20-53"><a id="__codelineno-20-53" name="__codelineno-20-53"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-20-54"><a id="__codelineno-20-54" name="__codelineno-20-54"></a>            <span class="n">df_bin</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-20-55"><a id="__codelineno-20-55" name="__codelineno-20-55"></a>                <span class="n">df_prox</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ix_bin</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;ToA&quot;</span><span class="p">)</span>
</span><span id="__span-20-56"><a id="__codelineno-20-56" name="__codelineno-20-56"></a>            <span class="p">)</span>
</span><span id="__span-20-57"><a id="__codelineno-20-57" name="__codelineno-20-57"></a>        <span class="n">blade_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_bin</span><span class="p">)</span>
</span><span id="__span-20-58"><a id="__codelineno-20-58" name="__codelineno-20-58"></a>        <span class="n">blade_median_AoAs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">df_bin</span><span class="p">[</span><span class="s2">&quot;AoA&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>  <span class="p">)</span>
</span><span id="__span-20-59"><a id="__codelineno-20-59" name="__codelineno-20-59"></a>    <span class="n">blade_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">blade_median_AoAs</span><span class="p">)</span>
</span><span id="__span-20-60"><a id="__codelineno-20-60" name="__codelineno-20-60"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">blade_dfs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">blade_order</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
<p>We've decided to only search for the optimal <code>d_theta</code> value between <span class="arithmatex">\(-\frac{2\pi}{B}\)</span> and 0. This is simply a matter of preference, because I want the first blade to occur as close as possible to 0 degrees. If you allow <code>d_theta</code> to be positive, it may result in the first blade being classified as the last blade. This is not a problem, but it is a matter of preference.</p>
</details>
<h2 id="conclusion">Conclusion</h2>
<p>Blade alignment is like parallel parking - it seems so simple, but you can make a proper mess of it if you're not careful.</p>
<p>I've promised that, by the end of this tutorial, you'll be able to infer parameters for vibration frequency, amplitude and phase for every blade. In this chapter we've enabled the "for every blade" part. Before this chapter, we just had a massive array of AoAs with no structure to it. We now have one AoA DataFrame for every blade. </p>
<p>This chapter involves <em>only a single proximity probe</em>. BTT systems normally use multiple proximity probes. </p>
<p>In the next chapter, we'll combine information from multiple probes together. We'll also investigate a nice visual way to check if we've done our alignment properly: <em>the stack plot</em>.</p>
<div class="admonition question">
<p class="admonition-title">Outcomes</p>
<p><span class="twemoji checkbox-success heart"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10 17-5-5 1.41-1.42L10 14.17l7.59-7.59L19 8m0-5H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"/></svg></span> Calculate the optimal <code>d_theta</code> to group the AoAs into blade bins by minimizing a quality factor <span class="arithmatex">\(Q\)</span>.</p>
<p><span class="twemoji checkbox-success heart"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10 17-5-5 1.41-1.42L10 14.17l7.59-7.59L19 8m0-5H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"/></svg></span> Understand that the first blade may arrive close to the OPR zero-crossing time. This can make the blade appear either at the start <em>or</em> end of the revolution. We need to cater for this scenario.</p>
<p><span class="twemoji checkbox-success heart"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10 17-5-5 1.41-1.42L10 14.17l7.59-7.59L19 8m0-5H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"/></svg></span> Write a function that determines the optimal blade bins for a set of AoAs, and split the proximity probe AoA DataFrames into several individual blade DataFrames.</p>
</div>
<h2 id="acknowledgements">Acknowledgements</h2>
<p>Thanks to <a href="https://www.linkedin.com/in/justin-s-507338116/" target="_blank">Justin Smith</a> and <a href="https://www.linkedin.com/in/alex-brocco-70218b25b/" target="_blank">Alex Brocco</a> for reviewing this chapter and providing feedback.</p>
<div style='display:flex'>
    <div>
        <a target="_blank" href="https://www.bladesight.com" class="" title="Dawie Diamond" style="border-radius:100%;"> 
            <img src="https://github.com/Bladesight.png?size=300" alt="Dawie Diamond" style="
            border-radius: 100%;
            width: 4.0rem;
        ">
        </a>
    </div>
    <div style='margin-left:2rem'>
        <p>
            <strong>Dawie Diamond</strong>
        </p>
        <p>
            2024-02-20
        </p>
    </div>
</div>







  
  



  


  



                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../ch3/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 3. Angle of Arrival (AoA)">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                3. Angle of Arrival (AoA)
              </div>
            </div>
          </a>
        
        
          
          <a href="../ch5/" class="md-footer__link md-footer__link--next" aria-label="Next: 5. Working with multiple probes">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                5. Working with multiple probes
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Bladesight
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://twitter.com/DawieDiamond" target="_blank" rel="noopener" title="Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/Bladesight" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linkedin.com/in/dawie-diamond-51089676/" target="_blank" rel="noopener" title="LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.researchgate.net/profile/Dawie-Diamond-2" target="_blank" rel="noopener" title="ResearchGate" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M0 32v448h448V32zm262.2 334.4c-6.6 3-33.2 6-50-14.2-9.2-10.6-25.3-33.3-42.2-63.6-8.9 0-14.7 0-21.4-.6v46.4c0 23.5 6 21.2 25.8 23.9v8.1c-6.9-.3-23.1-.8-35.6-.8-13.1 0-26.1.6-33.6.8v-8.1c15.5-2.9 22-1.3 22-23.9V225c0-22.6-6.4-21-22-23.9V193c25.8 1 53.1-.6 70.9-.6 31.7 0 55.9 14.4 55.9 45.6 0 21.1-16.7 42.2-39.2 47.5 13.6 24.2 30 45.6 42.2 58.9 7.2 7.8 17.2 14.7 27.2 14.7zm22.9-135c-23.3 0-32.2-15.7-32.2-32.2V167c0-12.2 8.8-30.4 34-30.4s30.4 17.9 30.4 17.9l-10.7 7.2s-5.5-12.5-19.7-12.5c-7.9 0-19.7 7.3-19.7 19.7v26.8c0 13.4 6.6 23.3 17.9 23.3 14.1 0 21.5-10.9 21.5-26.8h-17.9v-10.7h30.4c0 20.5 4.7 49.9-34 49.9m-116.5 44.7c-9.4 0-13.6-.3-20-.8v-69.7c6.4-.6 15-.6 22.5-.6 23.3 0 37.2 12.2 37.2 34.5 0 21.9-15 36.6-39.7 36.6"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
    
      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tracking", "navigation.instant", "navigation.path", "navigation.footer", "content.code.copy", "content.code.select", "content.code.annotate", "content.tabs.link", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="../../../javascripts/reviews.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
      
    
  </body>
</html>